# Test Case: M1 Auth & Profile â€” class-diagram-analyst

> **Purpose**: Kiá»ƒm tra skill hoáº¡t Ä‘á»™ng Ä‘Ãºng vá»›i Module M1
> **Source**: design.md Â§3 loop/test-cases/, Appendix A, Appendix B

---

## Input

```
User: "Váº½ class diagram M1"
```

---

## Expected Phase Execution

### Phase 0 â€” Input Resolution (skip IP0)
- Input type: "Module rÃµ rÃ ng (M1)"
- Action: Cháº¡y tháº³ng Phase A
- Module: **M1 â€” Auth & Profile**

### Phase A â€” Extract Entities
**Expected entity list tá»« module-map.yaml**:
- `users` â€” aggregate_root: true

**Expected fields tá»« er-diagram.md** (tá»‘i thiá»ƒu):
```
users:
  - email (email type, required, unique)
  - username (text type, required, unique)
  - password_hash (text type, required, private visibility)
  - role (select type: user/admin/moderator)
  - status (select type: active/inactive/banned)
  - follower_count (number, computed)
  - following_count (number, computed)
  - created_at (date type)
  - updated_at (date type)
```

### Phase B â€” Cross-Reference
**Expected behaviors**:
- `beforeChange`: sanitize_input (tá»« activity-diagrams/m1-a1-registration.md)
- `afterChange`: update follower_count (tá»« connections logic)

**Expected access_control**:
- create: ["anyone"] (USC01 â€” Ä‘Äƒng kÃ½)
- read: ["owner", "admin"]
- update: ["owner", "admin"]
- delete: ["admin"]
- source: UseCase/use-case-m1-auth-profile.md#UC01

### Phase C â€” Classify
- `users`: **AGGREGATE ROOT** (âœ… Q1: posts, comments, likes trá» vÃ o + Q2: timestamps)

### IP1 â€” Expected presentation

```
ğŸ“‹ Module M1 â€” Auth & Profile
Entity List Ä‘á» xuáº¥t:

| Entity | Stereotype | Fields (preview) | Behaviors | Access (summary) |
|--------|-----------|-----------------|-----------|-----------------|
| users  | <<Collection>> | email, username, role, status, followerCount... | beforeChange: sanitize | create: anyone, read: owner/admin |

âš ï¸ KhÃ´ng cÃ³ Assumptions Ä‘áº·c biá»‡t cho M1.

â“ XÃ¡c nháº­n danh sÃ¡ch trÃªn Ä‘á»ƒ táº¡o class-m1-auth-profile.md?
```

---

## Expected Mermaid Output (class-m1-auth-profile.md)

```mermaid
classDiagram
    class User {
        <<Collection>>
        +String email
        +String username
        -String passwordHash
        +Boolean verified
        +String role
        +String status
        +Number followerCount
        +Number followingCount
        +DateTime createdAt
        +DateTime updatedAt
        +void beforeChange()
        +Boolean validateEmail(String email)
    }
```

---

## Expected Traceability Table

| Entity | Field | Source | Assumption? |
|--------|-------|--------|------------|
| `users` | `email` | `er-diagram.md#USERS.email` | âŒ |
| `users` | `username` | `er-diagram.md#USERS.username` | âŒ |
| `users` | `passwordHash` | `er-diagram.md#USERS.password_hash` | âŒ |
| `users` | `role` | `er-diagram.md#USERS.role` | âŒ |
| `users` | `status` | `er-diagram.md#USERS.status` | âŒ |
| `users` | `followerCount` | `er-diagram.md#USERS.follower_count` | âŒ |
| `users` | `followingCount` | `er-diagram.md#USERS.following_count` | âŒ |
| `users` | `createdAt` | `er-diagram.md#USERS.created_at` | âŒ |
| `users` | `updatedAt` | `er-diagram.md#USERS.updated_at` | âŒ |

---

## Expected YAML Contract Snippet (class-m1-auth-profile.yaml)

```yaml
# âš ï¸ LOCKED CONTRACT â€” DO NOT EDIT MANUALLY.
# Generated by Skill 2.5 (class-diagram-analyst).

meta:
  module: "M1"
  module_name: "Auth & Profile"
  skill_version: "2.5"
  sources_consumed:
    - "Docs/life-2/diagrams/er-diagram.md"
    - "Docs/life-2/diagrams/UseCase/use-case-m1-auth-profile.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a1-registration.md"

entities:
  - slug: "users"
    display_name: "User"
    payload_collection: "users"
    aggregate_root: true
    fields:
      - name: "email"
        type: "email"
        required: true
        unique: true
        indexed: true
        source: "er-diagram.md#USERS.email"

      - name: "username"
        type: "text"
        required: true
        unique: true
        indexed: true
        constraints:
          minLength: 3
          maxLength: 50
        source: "er-diagram.md#USERS.username"

      - name: "passwordHash"
        type: "text"
        required: true
        source: "er-diagram.md#USERS.password_hash"

      - name: "role"
        type: "select"
        required: true
        options: ["user", "admin", "moderator"]
        defaultValue: "user"
        source: "er-diagram.md#USERS.role"

      - name: "followerCount"
        type: "number"
        required: false
        defaultValue: 0
        admin:
          readOnly: true
        source: "er-diagram.md#USERS.follower_count"
        pattern: "Computed Pattern"

    behaviors:
      - lifecycle: "beforeChange"
        trigger: "sanitize_input"
        source: "activity-diagrams/m1-a1-registration.md"

    access_control:
      create: ["anyone"]
      read: ["owner", "admin"]
      update: ["owner", "admin"]
      delete: ["admin"]
      source: "UseCase/use-case-m1-auth-profile.md#UC01"

    assumptions: []

validation_report:
  total_fields: 9
  fields_with_source: 9
  fields_as_assumption: 0
  unresolved: []
```

---

## Expected Validation Result

```
âœ… PASS â€” Contract há»£p lá»‡
   Total entities: 1
   Total fields: 9
   With source: 9
   Assumptions: 0
```

---

## Pass Criteria

- [ ] Skill nháº­n "Váº½ class diagram M1" â†’ cháº¡y Phase A ngay (khÃ´ng há»i thÃªm)
- [ ] Entity `users` Ä‘Æ°á»£c extract vá»›i Ä‘á»§ fields tá»« ER
- [ ] `passwordHash` cÃ³ visibility `-` (private) trong Mermaid
- [ ] `followerCount` cÃ³ `pattern: "Computed Pattern"` trong YAML
- [ ] Má»i fields cÃ³ source citation format `er-diagram.md#ENTITY.field`
- [ ] validate_contract.py â†’ PASS
- [ ] IP1, IP2, IP3 Ä‘Æ°á»£c kÃ­ch hoáº¡t Ä‘Ãºng thá»© tá»±
