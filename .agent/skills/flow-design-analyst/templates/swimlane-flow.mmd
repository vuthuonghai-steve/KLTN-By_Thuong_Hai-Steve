%%{init: {"flowchart": {"defaultRenderer": "elk"}} }%%
flowchart TD
  %% ============================================================
  %% SWIMLANE TEMPLATE ‚Äî 3-Lane Business Process Flow
  %% ============================================================
  %% Instructions:
  %%   1. Replace %%BUSINESS_FUNCTION%% with kebab-case function name
  %%   2. Replace %%UC_ID%% with UC-ID (e.g., UC01, UC19)
  %%   3. Replace %%DATE%% with YYYY-MM-DD
  %%   4. For each node: choose shape from mermaid-flowchart-guide.md ¬ß1
  %%   5. For User Lane: click, input, submit, view actions
  %%   6. For System Lane: validate, process, call API, respond
  %%   7. For DB Lane: SELECT, INSERT, UPDATE, DELETE operations
  %% ============================================================
  %% Business Function: %%BUSINESS_FUNCTION%%
  %% UC-ID: %%UC_ID%%
  %% Generated: %%DATE%%
  %% ============================================================

  subgraph User ["üë§ User"]
    direction TB
    U_start(["‚ñ∂ %%TRIGGER_ACTION%%"])
    U_input["%%USER_INPUT_ACTION%%"]
    U_submit["%%USER_SUBMIT_ACTION%%"]
    U_success["‚úÖ %%SUCCESS_MESSAGE%%"]
    U_error["‚ùå %%ERROR_MESSAGE%%"]
  end

  subgraph System ["‚öôÔ∏è System"]
    direction TB
    S_receive["%%RECEIVE_REQUEST%%"]
    S_validate{"%%VALIDATION_CHECK%%?"}
    S_process["%%BUSINESS_LOGIC%%"]
    S_respond_ok["%%SUCCESS_RESPONSE%%"]
    S_respond_err["%%ERROR_RESPONSE%%"]
  end

  subgraph DB ["üóÑÔ∏è Database"]
    direction TB
    D_query[("%%DB_READ_OPERATION%%")]
    D_write[("%%DB_WRITE_OPERATION%%")]
  end

  %% ============================================================
  %% CONNECTIONS (define after all subgraphs)
  %% ============================================================
  U_start --> U_input --> U_submit
  U_submit --> S_receive

  S_receive --> S_validate

  %% Exception Path
  S_validate -- "%%INVALID_CONDITION%%" --> S_respond_err --> U_error

  %% Happy Path continues
  S_validate -- "%%VALID_CONDITION%%" --> D_query

  D_query -- "%%SUCCESS_CONDITION%%" --> S_process --> D_write --> S_respond_ok --> U_success

  %% ============================================================
  %% PLACEHOLDER SUMMARY (remove before finalizing):
  %% %%BUSINESS_FUNCTION%%   ‚Äî e.g., "user-registration", "bookmark-save"
  %% %%UC_ID%%               ‚Äî e.g., "UC01", "UC19"
  %% %%DATE%%                ‚Äî e.g., "2026-02-20"
  %% %%TRIGGER_ACTION%%      ‚Äî e.g., "Truy c·∫≠p trang Register"
  %% %%USER_INPUT_ACTION%%   ‚Äî e.g., "ƒêi·ªÅn form ƒëƒÉng k√Ω"
  %% %%USER_SUBMIT_ACTION%%  ‚Äî e.g., "Nh·∫•n Submit"
  %% %%SUCCESS_MESSAGE%%     ‚Äî e.g., "Redirect v·ªÅ trang Login"
  %% %%ERROR_MESSAGE%%       ‚Äî e.g., "Hi·ªÉn th·ªã l·ªói: Email ƒë√£ t·ªìn t·∫°i"
  %% %%RECEIVE_REQUEST%%     ‚Äî e.g., "Nh·∫≠n POST /api/users/register"
  %% %%VALIDATION_CHECK%%    ‚Äî e.g., "Schema h·ª£p l·ªá"
  %% %%BUSINESS_LOGIC%%      ‚Äî e.g., "Hash password (bcrypt)"
  %% %%SUCCESS_RESPONSE%%    ‚Äî e.g., "Tr·∫£ 201 Created"
  %% %%ERROR_RESPONSE%%      ‚Äî e.g., "Tr·∫£ 400 Validation Error"
  %% %%DB_READ_OPERATION%%   ‚Äî e.g., "SELECT users WHERE email=?"
  %% %%DB_WRITE_OPERATION%%  ‚Äî e.g., "INSERT user record"
  %% %%INVALID_CONDITION%%   ‚Äî e.g., "Kh√¥ng h·ª£p l·ªá"
  %% %%VALID_CONDITION%%     ‚Äî e.g., "H·ª£p l·ªá"
  %% %%SUCCESS_CONDITION%%   ‚Äî e.g., "Email ch∆∞a t·ªìn t·∫°i" / "T√¨m th·∫•y"
  %% ============================================================
