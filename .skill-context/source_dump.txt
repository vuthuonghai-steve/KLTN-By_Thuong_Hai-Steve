# ==================================================
# Path: /home/steve/Documents/KLTN/.skill-context
# Detected tech: python
# ==================================================

## DIRECTORY STRUCTURE
```
.skill-context/
â”œâ”€â”€ activity-diagram-design-analyst/
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ rules.yaml
â”‚   â”‚   â””â”€â”€ severity-matrix.yaml
â”‚   â”œâ”€â”€ loop/
â”‚   â”‚   â””â”€â”€ rule-severity-loop-checklist.md
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ activity-diagram-research.md
â”‚   â”‚   â”œâ”€â”€ clean-architecture-notes.md
â”‚   â”‚   â””â”€â”€ refactor-risk-patterns.md
â”‚   â”œâ”€â”€ build-log.md
â”‚   â”œâ”€â”€ design.md
â”‚   â””â”€â”€ todo.md
â”œâ”€â”€ flow-design-analyst/
â”‚   â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ build-log.md
â”‚   â”œâ”€â”€ design.md
â”‚   â””â”€â”€ todo.md
â”œâ”€â”€ sequence-design-analyst/
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ context1.md
â”‚   â”‚   â”œâ”€â”€ project-patterns.md
â”‚   â”‚   â””â”€â”€ uml-rules.md
â”‚   â”œâ”€â”€ build-log.md
â”‚   â”œâ”€â”€ design.md
â”‚   â””â”€â”€ todo.md
â”œâ”€â”€ skill-builder/
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ test-fixtures/
â”‚   â”‚   â”‚   â”œâ”€â”€ fail-pd-links/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ scripts/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ orphan.py
â”‚   â”‚   â”‚   â”œâ”€â”€ fail-placeholders/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ knowledge/
â”‚   â”‚   â”‚   â”œâ”€â”€ fail-structure/
â”‚   â”‚   â”‚   â””â”€â”€ valid-skill/
â”‚   â”‚   â”‚       â”œâ”€â”€ knowledge/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ doc.md
â”‚   â”‚   â”‚       â”œâ”€â”€ loop/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ check.md
â”‚   â”‚   â”‚       â””â”€â”€ scripts/
â”‚   â”‚   â”‚           â””â”€â”€ tool.py
â”‚   â”‚   â””â”€â”€ validation-logic.md
â”‚   â”œâ”€â”€ build-log.md
â”‚   â”œâ”€â”€ design.md
â”‚   â””â”€â”€ todo.md
â”œâ”€â”€ skill-planner/
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â””â”€â”€ architect.md
â”‚   â”œâ”€â”€ build-log.md
â”‚   â”œâ”€â”€ design.md
â”‚   â””â”€â”€ todo.md
â””â”€â”€ DESIGN.md
```

## FILE CONTENTS

### DESIGN.md
```md
# MASTER SKILL SUITE â€” DESIGN DOCUMENT

> **Má»¥c Ä‘Ã­ch**: Bá»™ nhá»› ngoÃ i lÆ°u trá»¯ toÃ n bá»™ tháº£o luáº­n vÃ  quyáº¿t Ä‘á»‹nh thiáº¿t káº¿
> trong quÃ¡ trÃ¬nh xÃ¢y dá»±ng bá»™ 3 Agent Skill.
>
> **NgÃ y táº¡o**: 2026-02-13
> **TÃ¡c giáº£**: Steve + AI Agent
> **Tráº¡ng thÃ¡i**: ğŸŸ¢ HOÃ€N THÃ€NH THIáº¾T Káº¾ (Bá»™ 3 Skill)

---

## 1. Bá»I Cáº¢NH & QUYáº¾T Äá»ŠNH ÄÃƒ XÃC NHáº¬N

### 1.1 Bá»™ Master Skill lÃ  gÃ¬?

Bá»™ Master Skill gá»“m **3 Agent Skill Ä‘á»™c láº­p**, hoáº¡t Ä‘á»™ng theo cÃ¹ng má»™t workflow
tuáº§n tá»±, chia sáº» context qua má»™t thÆ° má»¥c tÃ i liá»‡u chung táº¡i root dá»± Ã¡n.

Má»¥c tiÃªu: GiÃºp ngÆ°á»i dÃ¹ng Ä‘i tá»« **Ã½ tÆ°á»Ÿng mÆ¡ há»“** â†’ **báº£n thiáº¿t káº¿ kiáº¿n trÃºc**
â†’ **káº¿ hoáº¡ch triá»ƒn khai** â†’ **skill hoÃ n chá»‰nh**.

### 1.2 Ba Skill vÃ  vai trÃ²

| # | TÃªn Skill | Vai trÃ² | Input | Output |
|---|-----------|---------|-------|--------|
| 1 | **Skill Architect** | Thu tháº­p, phÃ¢n tÃ­ch, thiáº¿t káº¿ kiáº¿n trÃºc | Ã tÆ°á»Ÿng + tÃ i liá»‡u tham kháº£o | `design.md` (kiáº¿n trÃºc skill) |
| 2 | **Skill Planner** | Liá»‡t kÃª bÆ°á»›c triá»ƒn khai, tÃ i liá»‡u & kiáº¿n thá»©c cáº§n chuáº©n bá»‹ | `design.md` tá»« Skill #1 | `todo.md` (káº¿ hoáº¡ch chi tiáº¿t) |
| 3 | **Skill Builder** | Tá»•ng há»£p tÃ i liá»‡u + triá»ƒn khai xÃ¢y dá»±ng | `design.md` + `todo.md` + tÃ i liá»‡u user | Skill package hoÃ n chá»‰nh |

### 1.3 Quyáº¿t Ä‘á»‹nh Ä‘Ã£ xÃ¡c nháº­n (Confirmed Decisions)

| # | Quyáº¿t Ä‘á»‹nh | NgÃ y | LÃ½ do |
|---|-----------|------|-------|
| D1 | Bá»™ 3 skill lÃ  **Má»šI HOÃ€N TOÃ€N**, khÃ´ng thay tháº¿ master-skill cÅ© | 2026-02-13 | TÃ¡ch biá»‡t, khÃ´ng áº£nh hÆ°á»Ÿng codebase hiá»‡n táº¡i |
| D2 | Context directory táº¡i **root dá»± Ã¡n**: `.skill-context/` (Option A) | 2026-02-13 | RÃµ rÃ ng, dá»… truy cáº­p |
| D3 | Má»—i skill lÃ  **agent skill Ä‘á»™c láº­p** (cÃ³ SKILL.md riÃªng) nhÆ°ng lÃ m viá»‡c chung workflow | 2026-02-13 | Modularity + má»—i skill cÃ³ thá»ƒ dÃ¹ng Ä‘á»™c láº­p |
| D4 | Ná»n táº£ng thiáº¿t káº¿ dá»±a trÃªn `architect.md` (7-Zone, Meta-Skill Framework) | 2026-02-13 | Chuáº©n kiáº¿n trÃºc Ä‘Ã£ cÃ³ sáºµn |
| D5 | Thá»© tá»± xÃ¢y dá»±ng: Skill #1 â†’ Skill #2 â†’ Skill #3 | 2026-02-13 | Dependency chain tuyáº¿n tÃ­nh |
| D6 | Má»—i skill cáº§n xÃ¢y dá»±ng cÃ³ **sub-folder riÃªng** trong `.skill-context/` | 2026-02-13 | Quáº£n lÃ½ nhiá»u skill, há»— trá»£ update/workflow tÆ°Æ¡ng lai |
| D7 | Cáº§n **init script** táº¡o cáº¥u trÃºc thÆ° má»¥c + file template tá»± Ä‘á»™ng | 2026-02-13 | Chuáº©n hÃ³a, trÃ¡nh thiáº¿u file, trÃ¡nh lá»—i tay |
| D8 | Naming: `skill-architect`, `skill-planner`, `skill-builder` (khÃ´ng prefix) | 2026-02-13 | ÄÆ¡n giáº£n, rÃµ nghÄ©a |
| D9 | `init_context.py` detect project root báº±ng cÃ¡ch **tÃ¬m thÆ° má»¥c `.agent/`** | 2026-02-13 | Chuáº©n xÃ¡c, skill luÃ´n náº±m trong `.agent/skills/` |
| D10 | **KhÃ´ng cáº§n `.gitignore`** trong `.skill-context/` | 2026-02-13 | Giá»¯ Ä‘Æ¡n giáº£n |

---

## 2. KIáº¾N TRÃšC Tá»”NG THá»‚

### 2.1 SÆ¡ Ä‘á»“ quan há»‡ giá»¯a 3 Skill

```
  USER (Y tuong + Tai lieu)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SKILL #1        â”‚
â”‚  Architect       â”‚     Tao & ghi vao
â”‚  (.agent/skills/ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .skill-context/
â”‚   skill-architectâ”‚                      â”œâ”€â”€ design.md  â—€â”€â”€ Skill #1 output
â”‚   /SKILL.md)     â”‚                      â”œâ”€â”€ todo.md    â—€â”€â”€ Skill #2 output
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”œâ”€â”€ build-log.md â—€â”€â”€ Skill #3 output
       â”‚                                  â””â”€â”€ resources/ â—€â”€â”€ User cung cap
       â”‚ "Thiet ke xong"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SKILL #2        â”‚     Doc design.md
â”‚  Planner         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ .skill-context/
â”‚  (.agent/skills/ â”‚     Ghi todo.md
â”‚   skill-planner  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .skill-context/
â”‚   /SKILL.md)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ "Ke hoach xong"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SKILL #3        â”‚     Doc design.md + todo.md
â”‚  Builder         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ .skill-context/
â”‚  (.agent/skills/ â”‚     Trien khai xay dung
â”‚   skill-builder  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ .agent/skills/{new-skill}/
â”‚   /SKILL.md)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Context Directory (`.skill-context/`) â€” MÃ´ hÃ¬nh Sub-folder

ThÆ° má»¥c gá»‘c `.skill-context/` chá»©a tÃ i liá»‡u chung cho bá»™ Master Skill.
Má»—i skill cáº§n xÃ¢y dá»±ng sáº½ cÃ³ **sub-folder riÃªng** Ä‘á»ƒ quáº£n lÃ½ context Ä‘á»™c láº­p.

```
{project_root}/.skill-context/
â”œâ”€â”€ DESIGN.md                   # Tháº£o luáº­n thiáº¿t káº¿ bá»™ Master Skill (file nÃ y)
â”‚
â”œâ”€â”€ {skill-name-1}/             # Sub-folder cho skill Ä‘ang xÃ¢y dá»±ng
â”‚   â”œâ”€â”€ design.md               # Output Skill #1 - Kiáº¿n trÃºc skill
â”‚   â”œâ”€â”€ todo.md                 # Output Skill #2 - Káº¿ hoáº¡ch triá»ƒn khai
â”‚   â”œâ”€â”€ build-log.md            # Output Skill #3 - Nháº­t kÃ½ xÃ¢y dá»±ng
â”‚   â””â”€â”€ resources/              # TÃ i liá»‡u user cung cáº¥p bá»• trá»£
â”‚       â””â”€â”€ (files...)
â”‚
â”œâ”€â”€ {skill-name-2}/             # Sub-folder cho skill khÃ¡c
â”‚   â”œâ”€â”€ design.md
â”‚   â”œâ”€â”€ todo.md
â”‚   â”œâ”€â”€ build-log.md
â”‚   â””â”€â”€ resources/
â”‚
â””â”€â”€ ...                         # Má»—i skill má»™t sub-folder
```

**Quy táº¯c**:
- Skill #1 (Architect) táº¡o root `.skill-context/` náº¿u chÆ°a cÃ³
- Skill #1 táº¡o sub-folder `{skill-name}/` khi báº¯t Ä‘áº§u session má»›i
- Skill #2, #3 Ä‘á»c/ghi vÃ o sub-folder Ä‘Ã£ táº¡o bá»Ÿi Skill #1
- TÃªn sub-folder = tÃªn skill Ä‘ang xÃ¢y dá»±ng (kebab-case)

### 2.3 Vá»‹ trÃ­ cÃ i Ä‘áº·t 3 Skill

```
.agent/skills/
â”œâ”€â”€ skill-architect/    # Skill #1
â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”œâ”€â”€ knowledge/
â”‚   â”‚   â””â”€â”€ architect.md   # Copy chuáº©n tá»« root
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ loop/
â”œâ”€â”€ skill-planner/      # Skill #2
â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”œâ”€â”€ knowledge/
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ loop/
â””â”€â”€ skill-builder/      # Skill #3
    â”œâ”€â”€ SKILL.md
    â”œâ”€â”€ knowledge/
    â”œâ”€â”€ scripts/
    â”œâ”€â”€ templates/
    â””â”€â”€ loop/
```

---

## 3. SKILL #1: ARCHITECT â€” THIáº¾T Káº¾ CHI TIáº¾T

> **Tráº¡ng thÃ¡i**: ğŸ”µ Äang thiáº¿t káº¿ (focus hiá»‡n táº¡i)

### 3.1 Sá»© má»‡nh (Mission)

Skill Architect lÃ  "Senior Architect" chuyÃªn **thu tháº­p Ã½ tÆ°á»Ÿng** tá»« ngÆ°á»i dÃ¹ng,
**phÃ¢n tÃ­ch yÃªu cáº§u** dá»±a trÃªn framework kiáº¿n trÃºc `architect.md`, vÃ  **xuáº¥t ra
báº£n thiáº¿t káº¿ kiáº¿n trÃºc** hoÃ n chá»‰nh cho skill má»›i cáº§n xÃ¢y dá»±ng.

### 3.2 Persona

- Vai trÃ²: **Senior Skill Architect**
- Phong cÃ¡ch: Há»i Ä‘Ãºng trá»ng tÃ¢m, váº½ sÆ¡ Ä‘á»“ trá»±c quan, khÃ´ng code
- NguyÃªn táº¯c: Dá»±a trÃªn 3 Trá»¥ cá»™t (Knowledge, Process, Guardrails) tá»« architect.md

### 3.3 Workflow (Phases)

```
Phase 1: THU THAP         Phase 2: PHAN TICH         Phase 3: THIET KE
(Collect)                  (Analyze)                  (Design & Output)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - Hoi y tuong   â”‚       â”‚ - Ap vao 3 Tru  â”‚        â”‚ - Ve Mindmap    â”‚
â”‚ - Xac dinh      â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚   cot (architect â”‚â”€â”€â”€â”€â”€â”€â–¶ â”‚   cau truc      â”‚
â”‚   pain points   â”‚       â”‚   .md)           â”‚        â”‚ - Ve Sequence   â”‚
â”‚ - Xac dinh      â”‚       â”‚ - Map vao Zones  â”‚        â”‚   flow          â”‚
â”‚   input/output  â”‚       â”‚ - Tim diem mu    â”‚        â”‚ - Ghi design.md â”‚
â”‚ - Doc tai lieu   â”‚       â”‚   cua AI         â”‚        â”‚   vao context   â”‚
â”‚   tham khao     â”‚       â”‚ - Xac dinh tools â”‚        â”‚ - Gate check    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚                          â”‚
       â–¼                          â–¼                          â–¼
  [Interaction]             [Interaction]              [Output Gate]
  Hoi neu thieu            Trinh bay phan tich         Confirm design
  thong tin                cho user confirm            truoc khi luu
```

### 3.4 Chi tiáº¿t tá»«ng Phase

#### Phase 1: Thu tháº­p (Collect)
- Äá»c input tá»« user (Ã½ tÆ°á»Ÿng, mÃ´ táº£, tÃ i liá»‡u tham kháº£o)
- Há»i tá»‘i Ä‘a 3 cÃ¢u há»i ngáº¯n náº¿u thiáº¿u thÃ´ng tin:
  1. Skill nÃ y giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬? (Pain point)
  2. Ai dÃ¹ng vÃ  dÃ¹ng trong ngá»¯ cáº£nh nÃ o? (User & Context)
  3. Äáº§u ra mong muá»‘n lÃ  gÃ¬? (Expected output)
- Náº¿u user cung cáº¥p tÃ i liá»‡u tham kháº£o â†’ lÆ°u vÃ o `.skill-context/resources/`
- Táº¡o thÆ° má»¥c `.skill-context/` náº¿u chÆ°a tá»“n táº¡i

#### Phase 2: PhÃ¢n tÃ­ch (Analyze)
- Äá»c `knowledge/architect.md` (báº£n copy trong skill)
- Ãp framework 3 Trá»¥ cá»™t:
  - **Trá»¥ 1 - Tri thá»©c (Knowledge)**: Skill má»›i cáº§n knowledge gÃ¬?
  - **Trá»¥ 2 - Quy trÃ¬nh (Process)**: Workflow logic ra sao?
  - **Trá»¥ 3 - Kiá»ƒm soÃ¡t (Guardrails)**: Cáº§n loop/verify gÃ¬?
- Map vÃ o 7 Zones: Core, Knowledge, Scripts, Templates, Data, Loop, Assets
- XÃ¡c Ä‘á»‹nh tools mÃ  AI sáº½ cáº§n (Terminal, Browser, File system...)
- TÃ¬m "Ä‘iá»ƒm mÃ¹" tiá»m áº©n (AI thÆ°á»ng sai á»Ÿ Ä‘Ã¢u vá»›i loáº¡i cÃ´ng viá»‡c nÃ y?)
- **Interaction Point**: TrÃ¬nh bÃ y báº£n phÃ¢n tÃ­ch, chá» user confirm

#### Phase 3: Thiáº¿t káº¿ & Output (Design)
- Váº½ sÆ¡ Ä‘á»“ cáº¥u trÃºc thÆ° má»¥c (Mermaid Mindmap)
- Váº½ sÆ¡ Ä‘á»“ luá»“ng hoáº¡t Ä‘á»™ng (Mermaid Sequence/Flowchart)
- Táº¡o Capability Map
- XÃ¡c Ä‘á»‹nh Risks & Open Questions
- Ghi toÃ n bá»™ vÃ o `.skill-context/design.md`
- **Output Gate**: Há»i user xÃ¡c nháº­n báº£n thiáº¿t káº¿ trÆ°á»›c khi hoÃ n táº¥t

### 3.5 Input/Output

| | Chi tiáº¿t |
|---|---------|
| **Input** | Ã tÆ°á»Ÿng mÃ´ táº£ báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn + tÃ i liá»‡u tham kháº£o (optional) |
| **Output** | File `.skill-context/design.md` chá»©a kiáº¿n trÃºc cá»§a skill má»›i |
| **Side Effect** | Táº¡o `.skill-context/` directory náº¿u chÆ°a cÃ³ |

### 3.6 Ná»™i dung `design.md` (Output Format)

Báº£n design.md mÃ  Skill Architect táº¡o ra sáº½ tuÃ¢n theo cáº¥u trÃºc:

```markdown
# {TÃªn Skill} â€” Architecture Design

## 1. Problem Statement
## 2. Capability Map (3 Trá»¥ cá»™t)
## 3. Zone Mapping (7 Zones)
## 4. Folder Structure (Mermaid Mindmap)
## 5. Execution Flow (Mermaid Sequence)
## 6. Interaction Points
## 7. Progressive Disclosure Plan
## 8. Risks & Blind Spots
## 9. Open Questions
## 10. Metadata
```

### 3.7 Cáº¥u trÃºc thÆ° má»¥c Skill Architect

```
.agent/skills/skill-architect/
â”œâ”€â”€ SKILL.md                    # Core: Persona + Phases + Rules
â”œâ”€â”€ knowledge/
â”‚   â””â”€â”€ architect.md            # Copy chuáº©n cá»§a framework kiáº¿n trÃºc
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init_context.py         # Script táº¡o cáº¥u trÃºc .skill-context/{name}/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ design.md.template      # Template cho output design.md
â”‚   â”œâ”€â”€ todo.md.template        # Khung sáºµn cho Skill #2 ghi vÃ o
â”‚   â””â”€â”€ build-log.md.template   # Khung sáºµn cho Skill #3 ghi vÃ o
â””â”€â”€ loop/
    â””â”€â”€ design-checklist.md     # Checklist kiá»ƒm tra báº£n thiáº¿t káº¿ Ä‘á»§ cháº¥t lÆ°á»£ng
```

### 3.8 Script `init_context.py` â€” Thiáº¿t káº¿ chi tiáº¿t

**Chá»©c nÄƒng**: Táº¡o cáº¥u trÃºc thÆ° má»¥c `.skill-context/` vÃ  sub-folder cho skill
má»›i, kÃ¨m theo cÃ¡c file context vá»›i khung heading sáºµn.

**CÃ¡ch gá»i**:
```bash
python .agent/skills/skill-architect/scripts/init_context.py <skill-name>
# VÃ­ dá»¥:
python .agent/skills/skill-architect/scripts/init_context.py my-api-analyzer
```

**Logic**:
```
1. Nháº­n argument: skill_name (kebab-case)
2. XÃ¡c Ä‘á»‹nh project_root (thÆ° má»¥c chá»©a .agent/ hoáº·c cwd)
3. Táº¡o .skill-context/ náº¿u chÆ°a cÃ³
4. Táº¡o .skill-context/{skill_name}/ náº¿u chÆ°a cÃ³
5. Táº¡o cÃ¡c file tá»« template (chá»‰ khi file chÆ°a tá»“n táº¡i):
   - design.md      â† tá»« design.md.template
   - todo.md         â† tá»« todo.md.template
   - build-log.md    â† tá»« build-log.md.template
6. Táº¡o resources/ sub-directory
7. In káº¿t quáº£: files created / already existed
```

**NguyÃªn táº¯c an toÃ n**:
- KHÃ”NG ghi Ä‘Ã¨ file Ä‘Ã£ tá»“n táº¡i (trÃ¡nh máº¥t context cÅ©)
- KHÃ”NG xÃ³a báº¥t ká»³ thá»© gÃ¬
- Chá»‰ táº¡o má»›i

### 3.9 File Templates â€” Khung heading

#### `design.md.template`
```markdown
# {skill_name} â€” Architecture Design

> Generated by Skill Architect | Date: {date}
> Status: ğŸ”µ IN PROGRESS

## 1. Problem Statement
<!-- Skill nay giai quyet van de gi? -->

## 2. Capability Map
### 2.1 Tri thuc (Knowledge)
### 2.2 Quy trinh (Process)
### 2.3 Kiem soat (Guardrails)

## 3. Zone Mapping
| Zone | Noi dung | Bat buoc? |
|------|----------|----------|
| Core (SKILL.md) | | âœ… |
| Knowledge | | |
| Scripts | | |
| Templates | | |
| Data | | |
| Loop | | |
| Assets | | |

## 4. Folder Structure
<!-- Mermaid Mindmap -->

## 5. Execution Flow
<!-- Mermaid Sequence/Flowchart -->

## 6. Interaction Points
<!-- Khi nao AI phai dung lai hoi user? -->

## 7. Progressive Disclosure Plan
<!-- Tang 1 bat buoc doc gi? Tang 2 tu quyet dinh? -->

## 8. Risks & Blind Spots
<!-- AI thuong sai o dau voi loai cong viec nay? -->

## 9. Open Questions
| # | Cau hoi | Trang thai |
|---|---------|------------|

## 10. Metadata
- Created: {date}
- Author: {author}
- Based on: architect.md v2.0
```

#### `todo.md.template`
```markdown
# {skill_name} â€” Implementation Plan

> Generated by Skill Planner | Date: {date}
> Status: âšª PENDING

## 1. Pre-requisites
<!-- Tai lieu & kien thuc can chuan bi truoc -->

## 2. Phase Breakdown
### Phase 1: Foundation
- [ ] Task 1.1
- [ ] Task 1.2

### Phase 2: Core Logic
- [ ] Task 2.1
- [ ] Task 2.2

### Phase 3: Quality
- [ ] Task 3.1
- [ ] Task 3.2

## 3. Knowledge & Resources Needed
| # | Tai lieu | Muc dich | Trang thai |
|---|---------|---------|------------|

## 4. Definition of Done
- [ ] Criterion 1
- [ ] Criterion 2

## 5. Notes
```

#### `build-log.md.template`
```markdown
# {skill_name} â€” Build Log

> Generated by Skill Builder | Date: {date}
> Status: âšª PENDING

## 1. Build Session Log
<!-- Nhat ky tung buoc xay dung -->

## 2. Files Created
| # | File | Muc dich |
|---|------|----------|

## 3. Decisions Made During Build
| # | Quyet dinh | Ly do |
|---|-----------|-------|

## 4. Issues Encountered
| # | Van de | Cach xu ly |
|---|--------|------------|

## 5. Final Status
- [ ] Skill package created
- [ ] Structure validated
- [ ] Ready for use
```

### 3.10 Guardrails

| Rule | MÃ´ táº£ |
|------|--------|
| KhÃ´ng code | Skill Architect CHá»ˆ thiáº¿t káº¿, KHÃ”NG viáº¿t code |
| KhÃ´ng tá»± Ä‘oÃ¡n | Há»i khi thiáº¿u thÃ´ng tin, tá»‘i Ä‘a 3 cÃ¢u |
| Pháº£i cÃ³ Mermaid | Output báº¯t buá»™c cÃ³ Ã­t nháº¥t 2 sÆ¡ Ä‘á»“ Mermaid |
| Pháº£i qua Gate | Má»—i phase káº¿t thÃºc báº±ng interaction point |
| Dá»±a trÃªn architect.md | Má»i thiáº¿t káº¿ pháº£i map Ä‘Æ°á»£c vá» 3 Trá»¥ + 7 Zones |
| Cháº¡y init script | Báº¯t buá»™c cháº¡y `init_context.py` trÆ°á»›c khi output |

---

## 4. SKILL #2: PLANNER â€” PHÃC THáº¢O

> **Tráº¡ng thÃ¡i**: âšª ChÆ°a báº¯t Ä‘áº§u (Ä‘á»£i Skill #1 xong)

### 4.1 Ã tÆ°á»Ÿng sÆ¡ bá»™
- Äá»c `design.md` tá»« `.skill-context/`
- PhÃ¢n rÃ£ tá»«ng Zone thÃ nh cÃ¡c bÆ°á»›c triá»ƒn khai cá»¥ thá»ƒ
- Liá»‡t kÃª tÃ i liá»‡u vÃ  kiáº¿n thá»©c ngÆ°á»i dÃ¹ng cáº§n chuáº©n bá»‹
- Output: `todo.md` - danh sÃ¡ch bÆ°á»›c vá»›i checklist `[ ]`

---

## 5. SKILL #3: BUILDER â€” THIáº¾T Káº¾ CHI TIáº¾T

> **Tráº¡ng thÃ¡i**: ğŸŸ¢ HOÃ€N THÃ€NH THIáº¾T Káº¾ (Sáºµn sÃ ng triá»ƒn khai)

### 5.1 Ã tÆ°á»Ÿng sÆ¡ bá»™
- Äá»c `design.md` + `todo.md` tá»« `.skill-context/`
- Tá»•ng há»£p tÃ i liá»‡u user cung cáº¥p trong `resources/`
- Thá»±c thi xÃ¢y dá»±ng skill theo káº¿ hoáº¡ch
- Output: Skill package hoÃ n chá»‰nh táº¡i `.agent/skills/{skill-name}/`

---

## 6. OPEN QUESTIONS

| # | CÃ¢u há»i | Tráº¡ng thÃ¡i |
|---|---------|-----------|
| Q1 | ~~Khi user muá»‘n xÃ¢y dá»±ng skill má»›i khÃ¡c, `.skill-context/` cÃ³ bá»‹ xÃ³a Ä‘i táº¡o láº¡i khÃ´ng?~~ | âœ… Resolved â†’ D6: Sub-folder riÃªng |
| Q2 | ~~Skill #1 cÃ³ cáº§n script tá»± Ä‘á»™ng (Python) hay chá»‰ dÃ¹ng logic trong SKILL.md?~~ | âœ… Resolved â†’ D7: CÃ³ init script |
| Q3 | ~~3 Skill cÃ³ naming convention chung khÃ´ng?~~ | âœ… Resolved â†’ D8: KhÃ´ng prefix |
| Q4 | ~~Script `init_context.py` nÃªn detect project root báº±ng cÃ¡ch nÃ o?~~ | âœ… Resolved â†’ D9: TÃ¬m `.agent/` |
| Q5 | ~~CÃ³ cáº§n `.gitignore` trong `.skill-context/` khÃ´ng?~~ | âœ… Resolved â†’ D10: KhÃ´ng cáº§n |

---

## 7. CHANGELOG

| NgÃ y | Thay Ä‘á»•i |
|------|----------|
| 2026-02-13 | Khá»Ÿi táº¡o DESIGN.md, xÃ¡c nháº­n 5 decisions (D1-D5) |
| 2026-02-13 | Thiáº¿t káº¿ chi tiáº¿t Skill #1 (Architect): Phases, I/O, Folder, Guardrails |
| 2026-02-13 | PhÃ¡c tháº£o sÆ¡ bá»™ Skill #2 (Planner) vÃ  Skill #3 (Builder) |
| 2026-02-13 | Confirm D6 (sub-folder), D7 (init script), D8 (naming). Resolve Q1-Q3 |
| 2026-02-13 | Thiáº¿t káº¿ chi tiáº¿t: init_context.py, 3 file templates (design/todo/build-log) |
| 2026-02-13 | Cáº­p nháº­t cáº¥u trÃºc context directory theo mÃ´ hÃ¬nh sub-folder |
| 2026-02-13 | Confirm D9 (root detection via .agent/), D10 (no .gitignore). Resolve Q4-Q5 |

```

### flow-design-analyst/design.md
```md
# flow-design-analyst â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-19
> Status: ğŸ”µ IN PROGRESS

---

## 1. Problem Statement
### 1.1. Pain Points
- Viá»‡c chuyá»ƒn Ä‘á»•i thá»§ cÃ´ng tá»« Äáº·c táº£ nghiá»‡p vá»¥ (Specs) sang SÆ¡ Ä‘á»“ luá»“ng (Flow Diagram) tá»‘n nhiá»u thá»i gian vÃ  dá»… sai sÃ³t logic.
- KhÃ³ duy trÃ¬ tÃ­nh Ä‘á»“ng nháº¥t giá»¯a tÃ i liá»‡u vÄƒn báº£n vÃ  sÆ¡ Ä‘á»“ khi cÃ³ sá»± thay Ä‘á»•i (Change Request).
- Thiáº¿u tÃ­nh trá»±c quan trong viá»‡c trÃ¬nh bÃ y cÃ¡c Ä‘iá»ƒm ráº½ nhÃ¡nh (Decision Points) vÃ  luá»“ng dá»¯ liá»‡u cá»§a há»‡ thá»‘ng.

### 1.2. User & Context
- **User**: Steve (Láº­p trÃ¬nh viÃªn/Architect) vÃ  cÃ¡c AI Agent tham gia phÃ¡t hiá»‡n logic/coding.
- **Context**: Dá»± Ã¡n KLTN giai Ä‘oáº¡n `life-2`, cáº§n hoÃ n thiá»‡n cÃ¡c sÆ¡ Ä‘á»“ luá»“ng cho Module M2 (Posts), M3 (News Feed), M9 (Moderation).

### 1.3. Expected Outcomes
- Tá»± Ä‘á»™ng hÃ³a viá»‡c táº¡o sÆ¡ Ä‘á»“ luá»“ng chuáº©n Mermaid tá»« cÃ¡c tÃ i liá»‡u nghiá»‡p vá»¥ cÃ³ sáºµn.
- Äáº£m báº£o tÃ­nh traceability: Má»i thÃ nh pháº§n trÃªn sÆ¡ Ä‘á»“ pháº£i tÆ°Æ¡ng á»©ng vá»›i Ã­t nháº¥t má»™t Functional Requirement (FR).
- Káº¿t quáº£ Ä‘áº§u ra lÃ  file Markdown chá»©a Mermaid code Ä‘áº·t táº¡i `Docs/life-2/diagrams/flow-diagram/`.

## 2. Capability Map

### 2.1 Tri thuc (Knowledge)
- **Mermaid Flowchart Syntax**: Tháº¥u hiá»ƒu cÃº phÃ¡p `flowchart TD/LR`, subgraphs, vÃ  styling.
- **Business Spec Literacy**: Kháº£ nÄƒng Ä‘á»c hiá»ƒu SRS, User Stories vÃ  trÃ­ch xuáº¥t logic flow.
- **Traceability Rules**: Quy táº¯c Ã¡nh xáº¡ logic vá» Functional Requirements (FR-IDs).

### 2.2 Quy trinh (Process)
1. **Module Identification**: QuÃ©t `Docs/life-2/index.md` Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c thÃ nh pháº§n cáº§n váº½ flow.
2. **Logic Extraction**: Truy xuáº¥t tÃ i liá»‡u nguá»“n (`Docs/life-1/`) Ä‘á»ƒ láº¥y Actors, Actions, States vÃ  Conditions.
3. **Diagram Synthesis**: Chuyá»ƒn Ä‘á»•i logic thÃ´ thÃ nh cáº¥u trÃºc sÆ¡ Ä‘á»“ Mermaid trá»±c quan.
4. **Validation Loop**: Kiá»ƒm tra tÃ­nh toÃ n váº¹n cá»§a logic ráº½ nhÃ¡nh vÃ  mÃ£ FR.

### 2.3 Kiem soat (Guardrails)
- **Decision Integrity**: Má»i node ráº½ nhÃ¡nh pháº£i cÃ³ Ä‘áº§y Ä‘á»§ cÃ¡c luá»“ng káº¿t thÃºc hoáº·c tiáº¿p diá»…n (nghiÃªm cáº¥m luá»“ng treo).
- **Naming Standard**: File Ä‘áº§u ra pháº£i tuÃ¢n thá»§ format `flow-{module-slug}.md`.
- **FR Constraint**: Má»—i hÃ nh Ä‘á»™ng xá»­ lÃ½ chÃ­nh pháº£i gáº¯n kÃ¨m Ã­t nháº¥t má»™t mÃ£ FR tÆ°Æ¡ng á»©ng.

## 3. Zone Mapping

| Zone | Noi dung | Bat buoc? |
|------|----------|----------|
| Core (SKILL.md) | Persona: Senior BA Analyst, workflow Scan-Draw-Verify | âœ… |
| Knowledge | `mermaid-standards.md`: Quy chuáº©n váº½ sÆ¡ Ä‘á»“ flow Ä‘áº¹p vÃ  chuáº©n | âœ… |
| Templates | `flow-template.mmd`: Khung máº«u Mermaid Flowchart | âœ… |
| Data | `fr-mapping.yaml`: Danh sÃ¡ch mÃ£ FR theo module | âœ… |
| Loop | `flow-checklist.md`: Danh sÃ¡ch kiá»ƒm tra logic vÃ  traceability | âœ… |
| Scripts | `flow_validator.py`: Script kiá»ƒm tra cÃº phÃ¡p Mermaid | ğŸŸ¡ |

## 4. Folder Structure

```mermaid
mindmap
  root((flow-design-analyst))
    SKILL.md
    knowledge
      mermaid-standards.md
      business-logic-patterns.md
    scripts
      flow_validator.py
    templates
      flow-diagram.mmd
    data
      fr-mapping.yaml
    loop
      checklist.md
      decision-verify.md
```
**
## 5. Execution Fl**ow

```mermaid
sequenceDiagram
    participant U as User (Steve)
    participant A as Agent (Flow Skill)
    participant K as Knowledge (Specs)
    participant L as Loop (Checklist)

    U->>A: YÃªu cáº§u váº½ flow cho module [M]
    A->>K: Äá»c spec module [M] trong Docs/life-1
    A->>A: TrÃ­ch xuáº¥t Actors & Logic ráº½ nhÃ¡nh
    A->>A: Táº¡o mÃ£ Mermaid Flowchart
    A->>L: Äá»‘i soÃ¡t vá»›i Checklist (State/FR)
    alt Logic chuáº©n
        A->>A: Gáº¯n mÃ£ FR vÃ o node nhÃ£n
        A->>U: LÆ°u file flow-module.md
    else Thiáº¿u logic
        A->>U: YÃªu cáº§u Steve bá»• sung Assumptions
    end
```

## 6. Interaction Points

| # | Thá»i Ä‘iá»ƒm | LÃ½ do |
|---|-----------|-------|
| 1 | TrÆ°á»›c khi trÃ­ch xuáº¥t | XÃ¡c nháº­n file specs nguá»“n (`Docs/life-1/`) cÃ³ Ä‘Ãºng khÃ´ng. |
| 2 | Khi logic bá»‹ má»/thiáº¿u ráº½ nhÃ¡nh | YÃªu cáº§u Steve cung cáº¥p logic "Happy Path" hoáº·c "Edge Case". |
| 3 | TrÆ°á»›c khi ghi file | TrÃ¬nh bÃ y báº£n nhÃ¡p Mermaid Ä‘á»ƒ Steve xem qua tháº©m má»¹. |

## 7. Progressive Disclosure Plan

### Táº§ng 1: Báº¯t buá»™c Ä‘á»c (Mandatory)
- `SKILL.md`: Persona vÃ  quy trÃ¬nh chÃ­nh.
- `knowledge/mermaid-standards.md`: CÃ¡ch Ä‘áº·t tÃªn node vÃ  style mÃ u sáº¯c.
- `loop/checklist.md`: 5 Ä‘iá»ƒm kiá»ƒm tra logic báº¯t buá»™c.

### Táº§ng 2: Tá»± quyáº¿t Ä‘á»‹nh (Conditional)
- `data/fr-mapping.yaml`: Chá»‰ Ä‘á»c khi cáº§n gáº¯n mÃ£ FR.
- `scripts/flow_validator.py`: Cháº¡y khi sÆ¡ Ä‘á»“ cÃ³ trÃªn 15 nodes.

## 8. Risks & Blind Spots

### 8.1 Technical Risks
| # | Risk | Mitigation |
|---|------|------------|
| 1 | AI bá» qua cÃ¡c Edge Cases khÃ´ng Ä‘Æ°á»£c mÃ´ táº£ rÃµ trong specs | YÃªu cáº§u liá»‡t kÃª "Assumptions" dÆ°á»›i má»—i sÆ¡ Ä‘á»“. |
| 2 | CÃº phÃ¡p Mermaid bá»‹ lá»—i khi render cÃ¡c luá»“ng phá»©c táº¡p | Sá»­ dá»¥ng `flow_validator.py` Ä‘á»ƒ check syntax trÆ°á»›c khi output. |
| 3 | Máº¥t dáº¥u dáº¥u váº¿t (Traceability) khi sá»­a Ä‘á»•i tÃ i liá»‡u | Gáº¯n mÃ£ FR trá»±c tiáº¿p vÃ o nhÃ£n (labels) cá»§a cÃ¡c Action Nodes. |

## 9. Open Questions

| # | Cau hoi | Trang thai |
|---|---------|-----------|
| 1 | <!-- Cau hoi can tra loi --> | â“ |

## 10. Metadata

- **Skill Name**: flow-design-analyst
- **Created**: 2026-02-19
- **Author**: Skill Architect
- **Framework**: architect.md v2.0
- **Status**: ğŸ”µ IN PROGRESS

```

### flow-design-analyst/build-log.md
```md
# flow-design-analyst â€” Build Log

> Generated by Skill Builder | Date: 2026-02-19
> Status: âšª PENDING

---

## 1. Build Session Log

<!-- Nhat ky tung buoc xay dung, ghi theo thoi gian -->

| Thoi gian | Hanh dong | Ket qua |
|-----------|----------|---------|
| <!-- e.g. 14:00 --> | <!-- e.g. Tao SKILL.md --> | <!-- e.g. OK --> |

## 2. Files Created

| # | File | Muc dich | Status |
|---|------|---------|--------|
| 1 | <!-- e.g. SKILL.md --> | <!-- e.g. Core skill logic --> | â¬œ |

## 3. Decisions Made During Build

<!-- Cac quyet dinh ky thuat trong qua trinh xay dung -->

| # | Quyet dinh | Ly do | Anh huong |
|---|-----------|-------|----------|
| 1 | <!-- e.g. Dung Python thay vi Bash --> | <!-- e.g. Logic phuc tap hon --> | <!-- e.g. Can Python 3.10+ --> |

## 4. Issues Encountered

<!-- Cac van de gap phai va cach xu ly -->

| # | Van de | Nguyen nhan | Cach xu ly |
|---|--------|-----------|-----------|
| 1 | <!-- e.g. Template khong load --> | <!-- e.g. Sai path --> | <!-- e.g. Fix path resolution --> |

## 5. Final Status

- [ ] Skill package created at `.agent/skills/flow-design-analyst/`
- [ ] Structure validated (7-Zone compliant)
- [ ] SKILL.md reviewed and approved
- [ ] Knowledge files loaded
- [ ] Scripts tested
- [ ] Templates verified
- [ ] Loop checklist created
- [ ] Ready for use

```

### flow-design-analyst/todo.md
```md
# flow-design-analyst â€” Implementation Plan

> Generated by Skill Planner | Date: 2026-02-19
> Status: âšª PENDING

---

## 1. Pre-requisites

<!-- Tai lieu va kien thuc can chuan bi TRUOC khi bat tay xay dung -->

| # | Tai lieu / Kien thuc | Muc dich | Da san sang? |
|---|---------------------|---------|-------------|
| 1 | <!-- e.g. architect.md --> | <!-- e.g. Framework kien truc --> | â¬œ |

## 2. Phase Breakdown

### Phase 1: Foundation
<!-- Tao cau truc thu muc, cau hinh co ban -->
- [ ] Task 1.1: <!-- Mo ta -->
- [ ] Task 1.2: <!-- Mo ta -->

### Phase 2: Core Logic
<!-- Xay dung logic chinh cua skill -->
- [ ] Task 2.1: <!-- Mo ta -->
- [ ] Task 2.2: <!-- Mo ta -->

### Phase 3: Templates & Data
<!-- Tao templates, nap du lieu -->
- [ ] Task 3.1: <!-- Mo ta -->
- [ ] Task 3.2: <!-- Mo ta -->

### Phase 4: Quality & Verify
<!-- Kiem tra, test, verify -->
- [ ] Task 4.1: <!-- Mo ta -->
- [ ] Task 4.2: <!-- Mo ta -->

## 3. Knowledge & Resources Needed

| # | Tai lieu | Muc dich | Trang thai |
|---|---------|---------|-----------|
| 1 | <!-- e.g. UML standards --> | <!-- e.g. Dam bao diagram dung chuan --> | â“ |

## 4. Definition of Done

- [ ] Cau truc thu muc dung 7-Zone architecture
- [ ] SKILL.md co du persona, phases, guardrails
- [ ] Knowledge files da nap
- [ ] Templates da tao va test
- [ ] Loop checklist da tao
- [ ] <!-- Them tieu chi cu the cho skill nay -->

## 5. Notes

<!-- Ghi chu them, luu y dac biet -->

```

### skill-builder/design.md
```md
# skill-builder â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-13
> Status: ğŸŸ¢ COMPLETE

---

## 1. Problem Statement

Sau khi cÃ³ báº£n thiáº¿t káº¿ kiáº¿n trÃºc (`design.md` tá»« Architect) vÃ  káº¿ hoáº¡ch triá»ƒn khai
(`todo.md` tá»« Planner), ngÆ°á»i dÃ¹ng + AI Ä‘á»‘i máº·t vá»›i:

1. **KhÃ´ng cÃ³ "thá»£ xÃ¢y" chuyÃªn biá»‡t** â€” AI Agent pháº£i tá»± build skill mÃ  khÃ´ng cÃ³
   quy trÃ¬nh chuáº©n, dá»… bá» sÃ³t components, sai cáº¥u trÃºc
2. **áº¢o giÃ¡c khi viáº¿t ná»™i dung** â€” AI tá»± bá»‹a domain knowledge, viáº¿t guardrails chung
   chung, táº¡o template khÃ´ng khá»›p vá»›i thiáº¿t káº¿
3. **Thiáº¿u kiá»ƒm tra cháº¥t lÆ°á»£ng** â€” KhÃ´ng cÃ³ cÆ¡ cháº¿ verify output vs thiáº¿t káº¿ gá»‘c

**Ai gáº·p váº¥n Ä‘á»**: AI Agent thá»±c thi + ngÆ°á»i dÃ¹ng giÃ¡m sÃ¡t.
**Vá»‹ trÃ­**: Skill #3 (cuá»‘i cÃ¹ng) trong bá»™ Master Skill Suite (Architect â†’ Planner â†’ **Builder**).
**Expected Output**: Skill package hoÃ n chá»‰nh táº¡i `.agent/skills/{skill-name}/` + `build-log.md`.

**Quyáº¿t Ä‘á»‹nh Ä‘Ã£ xÃ¡c nháº­n:**

| # | Quyáº¿t Ä‘á»‹nh | MÃ´ táº£ |
|---|-----------|-------|
| B-D1 | Autonomous | AI tá»± viáº¿t ná»™i dung dá»±a 100% trÃªn tÃ i liá»‡u sáºµn cÃ³ |
| B-D2 | BÃ¡m sÃ¡t architect.md | Má»i file táº¡o ra PHáº¢I map Ä‘Æ°á»£c vá» 7 Zones |
| B-D3 | Sub-step Build | Chia nhá» bÆ°á»›c BUILD theo tá»«ng Phase cá»§a todo.md Ä‘á»ƒ trÃ¡nh quÃ¡ táº£i ngá»¯ cáº£nh |
| B-D4 | **Engineer Stance** | Ká»¹ sÆ° tá»± chá»§, cÃ³ quyá»n tháº©m Ä‘á»‹nh, pháº£n biá»‡n vÃ  sá»­a lá»—i logic trong design.md |
| B-D5 | Error Stop | Gáº·p lá»—i há»‡ thá»‘ng (Permission/Disk) -> Ghi log -> ThÃ´ng bÃ¡o -> Dá»ªNG NGAY |
| B-D6 | Placeholder Gate | NgÆ°á»¡ng cáº£nh bÃ¡o tá»‹nh tiáº¿n cho Placeholder (5: Level Up, >10: FAIL) |

## 2. Capability Map

### 2.1 Tri thuc (Knowledge)

Builder lÃ  skill **duy nháº¥t trong bá»™ 3 skill thá»±c sá»± táº¡o ra sáº£n pháº©m** (files tháº­t).
NÃ³ cáº§n hiá»ƒu **Cáº¤U TRÃšC CHUáº¨N** (xÃ¢y cÃ¡i gÃ¬) láº«n **CÃCH VIáº¾T Ná»˜I DUNG** (viáº¿t gÃ¬ vÃ o má»—i file).

| # | Kiáº¿n thá»©c | Vá»‹ trÃ­ trong skill | Má»¥c Ä‘Ã­ch |
|---|----------|-------------------|----------|
| K1 | **architect.md** (framework gá»‘c) | `knowledge/architect.md` (copy) | Chuáº©n 7 Zones, Progressive Disclosure Â§6, SKILL.md writing rules Â§9. **Báº£o chá»©ng cáº¥u trÃºc** |
| K2 | **Build execution guidelines** | `knowledge/build-guidelines.md` (má»›i) | CÃ¡ch viáº¿t ná»™i dung cá»¥ thá»ƒ cho tá»«ng Zone type: SKILL.md (imperative form, phases), knowledge/ (cáº¥u trÃºc tÃ i liá»‡u), loop/ (cÃ¡ch viáº¿t checklist) |
| K3 | **design.md** (INPUT) | `.skill-context/{name}/design.md` | Ground truth â€” kiáº¿n trÃºc skill cáº§n build |
| K4 | **todo.md** (INPUT) | `.skill-context/{name}/todo.md` | "Báº£n váº½ thi cÃ´ng" â€” thá»© tá»±, dependencies |
| K5 | **resources/** (INPUT) | `.skill-context/{name}/resources/` | TÃ i liá»‡u domain do user cung cáº¥p â€” **nguá»“n duy nháº¥t cho ná»™i dung domain** |

**Äiá»ƒm khÃ¡c biá»‡t**: Architect chá»‰ thiáº¿t káº¿, Planner chá»‰ láº­p káº¿ hoáº¡ch. Builder lÃ  **duy nháº¥t viáº¿t code/ná»™i dung thá»±c**.

### 2.2 Quy trinh (Process)

```mermaid
flowchart LR
    P1["PREPARE\n(Doc input)"] -->|model noi bo| P2["CLARIFY\n(Xu ly CAN LAM RO)"]
    P2 -->|all clear| P3["BUILD\n(Tao files)"]
    P3 -->|skill package| P4["VERIFY\n(Doi chieu design)"]
    P4 -->|pass| P5["DELIVER\n(Trinh bay + log)"]

    P2 -.->|hoi user| U((User))
    U -.->|tra loi| P2
    P2 -.->|ghi vao| D[design.md]

    P5 -.->|result| U
```

| Step | HÃ nh Ä‘á»™ng | Input | Output | Interaction? |
|------|----------|-------|--------|-------------|
| **PREPARE** | Äá»c design.md, todo.md, resources. **Tháº©m Ä‘á»‹nh logic thiáº¿t káº¿**. | Files tá»« `.skill-context/{name}/` | Model ná»™i bá»™: danh sÃ¡ch sub-steps, pháº£n biá»‡n (náº¿u cÃ³) | âŒ |
| **CLARIFY** | Há»i user vá» `[Cáº¦N LÃ€M RÃ•]` hoáº·c **cÃ¡c Ä‘iá»ƒm phi logic phÃ¡t hiá»‡n Ä‘Æ°á»£c**. Ghi vÃ o design.md Â§9. | todo.md + Tháº©m Ä‘á»‹nh | design.md cáº­p nháº­t, ambiguity & logic flaws resolved | âœ… Há»i user |
| **BUILD** | Triá»ƒn khai theo tá»«ng **Phase** cá»§a todo.md. Xong Phase nÃ o mark Phase Ä‘Ã³. | Káº¿ hoáº¡ch Ä‘Ã£ tháº©m Ä‘á»‹nh | `.agent/skills/{skill-name}/` | âŒ Chunked per Phase |
| **VERIFY** | Cháº¡y `validate_skill.py`. Kiá»ƒm tra ngÆ°á»¡ng Placeholder (Thang 5/10). | Skill package + design + todo | Verification report | âŒ |
| **DELIVER** | TrÃ¬nh bÃ y káº¿t quáº£ + ghi `build-log.md` | Verification report | build-log.md + bÃ¡o cÃ¡o | âœ… TrÃ¬nh bÃ y |

### 2.3 Kiem soat (Guardrails)

| # | Rule | MÃ´ táº£ | Chá»‘ng risk |
|---|------|-------|-----------|
| G1 | **Ká»¹ sÆ° Pháº£n biá»‡n** | Pháº£i verify báº£n thiáº¿t káº¿ trÆ°á»›c khi build. CÃ³ quyá»n cÃ£i láº¡i vÃ  sá»­a logic sai | Thiáº¿t káº¿ phi thá»±c táº¿ |
| G2 | **Phase-driven Build** | Pháº£i chia nhá» BUILD theo Phase cá»§a todo.md. Mark-as-done tá»«ng phase | Context Overload |
| G3 | **Log-Notify-Stop** | Lá»—i ghi file/há»‡ thá»‘ng -> Log -> Notify -> STOP. KhÃ´ng cháº¡y cá»‘ | Data Corruption |
| G4 | **Placeholder Scale** | Cáº£nh bÃ¡o má»—i 5 Placeholders. >10 Placeholders = Tháº¥t báº¡i (Failure) | Ná»™i dung rá»—ng |
| G5 | **Source Grounding** | Ná»™i dung 100% tá»« design, todo, resources. Tuyá»‡t Ä‘á»‘i khÃ´ng áº£o giÃ¡c. | Hallucination |
| G6 | **PD Tiering** | TuÃ¢n thá»§ Progressive Disclosure (Tier 1 vs Tier 2). | Context Bloat |
| G7 | **Build-log Mandatory** | Má»i quyáº¿t Ä‘á»‹nh, pháº£n biá»‡n, file táº¡o -> ghi rÃµ vÃ o build-log.md | Traceability |

## 3. Zone Mapping

```mermaid
flowchart TD
    User((User)) -->|"y tuong + tai lieu"| Architect[skill-architect]
    Architect -->|"ghi"| Design["design.md\n.skill-context/{name}/"]
    Design -->|"doc"| Planner[skill-planner]
    Planner -->|"ghi"| Todo["todo.md\n.skill-context/{name}/"]

    Design -->|"doc"| Builder[skill-builder]
    Todo -->|"doc"| Builder
    Resources["resources/\n.skill-context/{name}/"] -->|"doc"| Builder
    ArchitectMD["architect.md\n(root)"] -->|"doc"| Builder

    Builder -->|"tao"| SkillPkg[".agent/skills/{name}/\nSkill Package"]
    Builder -->|"ghi"| BuildLog["build-log.md\n.skill-context/{name}/"]
    Builder -.->|"hoi khi gap CAN LAM RO"| User
    Builder -.->|"trinh bay ket qua"| User

    style Builder fill:#e8f5e9,stroke:#2e7d32,stroke-width:3px
    style SkillPkg fill:#c8e6c9,stroke:#388e3c
```

| Zone | Cáº§n? | Ná»™i dung | LÃ½ do |
|------|------|---------|-------|
| **Core (SKILL.md)** | âœ… | Persona "Senior Skill Builder". Flow 5 steps. 7 Guardrails | Linh há»“n Ä‘iá»u khiá»ƒn |
| **Knowledge** | âœ… | `knowledge/architect.md` (copy chuáº©n) + `knowledge/build-guidelines.md` (imperative SKILL.md â‰¤500 dÃ²ng, knowledge tÃ¡ch tham chiáº¿u, loop checklist format, placeholder khi thiáº¿u domain) | Cáº§n hiá»ƒu Cáº¤U TRÃšC CHUáº¨N + CÃCH VIáº¾T |
| **Scripts** | âœ… | `scripts/validate_skill.py` â€” kiá»ƒm tra: Ä‘á»§ 4 Zones dÃ¹ng (Core/Knowledge/Scripts/Loop), SKILL.md < 500 dÃ²ng, file list khá»›p design.md Â§3 + todo.md Â§2, tuÃ¢n thá»§ Progressive Disclosure, bÃ¡o cÃ¡o thiáº¿u/sai | Automation cho Step VERIFY |
| **Templates** | âŒ | â€” | Má»—i skill khÃ¡c nhau, design.md Ä‘Ã£ lÃ  "template" |
| **Data** | âŒ | â€” | KhÃ´ng cÃ³ config tÄ©nh |
| **Loop** | âœ… | `loop/build-checklist.md` â€” checklist kiá»ƒm tra cháº¥t lÆ°á»£ng cuá»‘i cÃ¹ng; `loop/build-log.md` yÃªu cáº§u ghi input set, clarifications, files, validation, issues | Kiá»ƒm soÃ¡t output trÆ°á»›c deliver |
| **Assets** | âŒ | â€” | KhÃ´ng cÃ³ media |

**Zones sá»­ dá»¥ng: 4/7** (Core, Knowledge, Scripts, Loop).

**Scripts â€” validate_skill.py yÃªu cáº§u tá»‘i thiá»ƒu**
- Kiá»ƒm tra Ä‘á»§ 4 Zones Ä‘Æ°á»£c sá»­ dá»¥ng (Core/Knowledge/Scripts/Loop), flag náº¿u thiáº¿u.
- SKILL.md < 500 dÃ²ng, cÃ³ persona + phases + guardrails.
- Äá»‘i chiáº¿u danh sÃ¡ch file thá»±c táº¿ vá»›i thiáº¿t káº¿: design.md Â§3 (Zone Mapping) + todo.md Â§2 (Phase Breakdown).
- Kiá»ƒm tra Progressive Disclosure: Tier 1 (SKILL.md, knowledge/*) tá»“n táº¡i; Tier 2 (loop/, scripts/) cÃ³ link tá»« SKILL.md.
- Xuáº¥t bÃ¡o cÃ¡o cÃ³ tráº¡ng thÃ¡i Pass/Fail tá»«ng háº¡ng má»¥c.

**build-log.md skeleton (Step DELIVER)**
- Input set (design.md, todo.md, resources/* phiÃªn báº£n hiá»‡n táº¡i).
- Clarifications Ä‘Ã£ ghi vÃ o design.md (má»¥c Clarifications).
- Files created/updated trong `.agent/skills/{skill-name}/`.
- Káº¿t quáº£ validate_skill.py + tá»± kiá»ƒm tra build-checklist.md.
- Issues cÃ²n má»Ÿ hoáº·c cáº§n user Ä‘iá»n tiáº¿p.

## 4. Folder Structure

```mermaid
mindmap
  root((skill-builder))
    SKILL.md
      Persona Senior Skill Builder
      5 Steps PREPARE CLARIFY BUILD VERIFY DELIVER
      7 Guardrails
      Output spec
    knowledge
      architect.md
        7 Zones framework
        Progressive Disclosure
        SKILL.md writing rules
      build-guidelines.md
        Cach viet SKILL.md
        Cach viet knowledge files
        Cach viet loop checklists
        Cach xu ly resources
        Placeholder khi thieu domain data
    scripts
      validate_skill.py
        Kiem tra cau truc
        Doi chieu vs design.md
        Report ket qua
    loop
      build-checklist.md
        Structure check
        Content source check
        Progressive disclosure check
        Completeness check
```

## 5. Execution Flow

```mermaid
sequenceDiagram
    participant U as User
    participant B as Skill Builder
    participant K as knowledge/
    participant D as design.md
    participant T as todo.md
    participant R as resources/
    participant S as scripts/validate_skill.py
    participant L as loop/build-checklist.md
    participant O as .agent/skills/{name}/

    U->>B: Kich hoat Builder (skill-name)
    B->>B: Doc SKILL.md (persona + rules)
    B->>K: Doc architect.md + build-guidelines.md

    Note over B: === STEP PREPARE ===
    B->>D: Doc design.md (Â§3 Zone Mapping)
    B->>T: Doc todo.md (Â§2 Phase Breakdown)
    B->>R: Doc resources/ (neu co)
    B->>B: Tao model noi bo: files can tao + thu tu

    Note over B: === STEP CLARIFY ===
    B->>T: Scan tim [CAN LAM RO]
    alt Co items can lam ro
        loop Voi moi item [CAN LAM RO]
            B->>U: Hoi user ve item
            U->>B: Tra loi
            B->>D: Ghi cau tra loi vao design.md
        end
    end

    Note over B: === STEP BUILD ===
    B->>O: Tao folder .agent/skills/{name}/
    loop Voi moi task trong todo.md phases
        B->>K: Tham chieu architect.md (cau truc)
        B->>K: Tham chieu build-guidelines.md (cach viet)
        B->>D: Tham chieu design.md (noi dung)
        B->>R: Lay domain content tu resources/
        B->>O: Tao file voi noi dung
    end

    Note over B: === STEP VERIFY ===
    B->>S: Chay validate_skill.py
    S-->>B: Ket qua validation
    B->>L: Doc build-checklist.md
    B->>B: Doi chieu output vs design.md Â§3 + todo.md Â§4 DoD

    Note over B: === STEP DELIVER ===
    B->>B: Ghi build-log.md (files, decisions, issues)
    B->>U: Trinh bay ket qua tong hop
```

## 6. Interaction Points

| # | Thá»i Ä‘iá»ƒm | Loáº¡i | LÃ½ do |
|---|-----------|------|-------|
| 1 | Step CLARIFY â€” gáº·p `[Cáº¦N LÃ€M RÃ•]` | Question â†’ ghi vÃ o design.md (má»¥c Clarifications), tá»‘i Ä‘a 5 má»¥c/phiÃªn | Giáº£i quyáº¿t ambiguity trÆ°á»›c khi build. Loop Ä‘áº¿n háº¿t |
| 2 | Step DELIVER â€” káº¿t thÃºc | Present results | User xem skill package + build-log trÆ°á»›c khi hoÃ n táº¥t |

**Chá»‰ 2 interaction points** â€” vÃ¬ input (design.md + todo.md) Ä‘Ã£ Ä‘Æ°á»£c confirm bá»Ÿi Architect + Planner.
B-D3 yÃªu cáº§u Ã­t interaction, cháº¡y 1 máº¡ch.

## 7. Progressive Disclosure Plan

### Táº§ng 1: Báº¯t buá»™c Ä‘á»c (Mandatory)
- `SKILL.md` â€” persona, 5 steps, 6 guardrails
- `knowledge/architect.md` â€” framework 7 Zones, Progressive Disclosure, SKILL.md writing rules
- `knowledge/build-guidelines.md` â€” cÃ¡ch viáº¿t ná»™i dung cho tá»«ng Zone type

### Táº§ng 2: Tá»± quyáº¿t Ä‘á»‹nh (Conditional)
- `loop/build-checklist.md` â€” Ä‘á»c SAU Step BUILD Ä‘á»ƒ tá»± kiá»ƒm tra (Step VERIFY)
- `scripts/validate_skill.py` â€” cháº¡y trong Step VERIFY

## 8. Risks & Blind Spots

| # | Blind Spot | Nguy cÆ¡ | Mitigation |
|---|-----------|---------|------------|
| B1 | **Bá»‹a ná»™i dung knowledge/** | AI "sÃ¡ng táº¡o" domain knowledge thay vÃ¬ dÃ¹ng resources/ | G1: bÃ¡m tÃ i liá»‡u. Thiáº¿u â†’ táº¡o skeleton, user Ä‘iá»n sau |
| B2 | **SKILL.md quÃ¡ chung** | Persona/phases mÆ¡ há»“ "xá»­ lÃ½ input, táº¡o output" | build-guidelines.md hÆ°á»›ng dáº«n cá»¥ thá»ƒ, architect.md Â§9.1 |
| B3 | **Bá» sÃ³t files** | design.md nÃ³i 5 zones nhÆ°ng chá»‰ táº¡o 3 | validate_skill.py Ä‘á»‘i chiáº¿u 1-1 + build-checklist |
| B4 | **Sai Progressive Disclosure** | Nhá»“i má»i thá»© vÃ o SKILL.md thay vÃ¬ phÃ¢n táº§ng | architect.md Â§6 quy Ä‘á»‹nh. build-guidelines.md cÃ³ vÃ­ dá»¥ |
| B5 | **Guardrails copy-paste** | Checklists chung chung, khÃ´ng specific | build-guidelines.md cÃ³ pattern guardrails hiá»‡u quáº£ |
| B6 | **QuÃªn ghi build-log** | Táº­p trung build mÃ  khÃ´ng document decisions/issues | G6 báº¯t buá»™c. Step DELIVER kiá»ƒm tra |

## 9. Open Questions

KhÃ´ng cÃ³ â€” táº¥t cáº£ decisions Ä‘Ã£ xÃ¡c nháº­n qua Phase 1 vÃ  Phase 2.

**Clarifications:**
1. [B-C1]: Builder cÃ³ quyá»n sá»­a DESIGN.md? -> YES.
2. [B-C2]: PD Check dÃ¹ng MD link hay inline? -> Markdown link `[Label](path)` lÃ  báº¯t buá»™c.

## 10. Metadata

- **Skill Name**: skill-builder
- **Created**: 2026-02-13
- **Author**: Skill Architect
- **Framework**: architect.md v2.0
- **Position**: #3 trong bá»™ Master Skill Suite (Architect â†’ Planner â†’ **Builder**)
- **Decisions**: B-D1 (autonomous), B-D2 (bÃ¡m architect.md), B-D3 (cháº¡y 1 máº¡ch), B-D4 (clarify-first)
- **Zones Used**: 4/7 (Core, Knowledge, Scripts, Loop)
- **Status**: ğŸŸ¢ COMPLETE

```

### skill-builder/build-log.md
```md
# skill-builder â€” Build Log

> Generated by Skill Builder | Date: 2026-02-13
> Status: âšª PENDING

---

## 1. Build Session Log

<!-- Nhat ky tung buoc xay dung, ghi theo thoi gian -->

| Thoi gian | Hanh dong | Ket qua |
|-----------|----------|---------|
| <!-- e.g. 14:00 --> | <!-- e.g. Tao SKILL.md --> | <!-- e.g. OK --> |

## 2. Files Created

| # | File | Muc dich | Status |
|---|------|---------|--------|
| 1 | <!-- e.g. SKILL.md --> | <!-- e.g. Core skill logic --> | â¬œ |

## 3. Decisions Made During Build

<!-- Cac quyet dinh ky thuat trong qua trinh xay dung -->

| # | Quyet dinh | Ly do | Anh huong |
|---|-----------|-------|----------|
| 1 | Dung Python thay vi Bash | Logic phuc tap hon | Can Python 3.10+ |
| 2 | Guardrail G9 - Knowledge Fidelity | NgÄƒn cháº·n viá»‡c AI tá»± Ã½ tÃ³m táº¯t tri thá»©c ká»¹ thuáº­t | TÄƒng máº­t Ä‘á»™ thÃ´ng tin trong Skill |
| 3 | Double-Pass Infusion Flow | Báº£o toÃ n tri thá»©c cho cÃ¡c tÃ i liá»‡u dÃ i | Giáº£m rá»§i ro máº¥t mÃ¡t tri thá»©c khi build |

## 4. Issues Encountered

<!-- Cac van de gap phai va cach xu ly -->

| # | Van de | Nguyen nhan | Cach xu ly |
|---|--------|-----------|-----------|
| 1 | <!-- e.g. Template khong load --> | <!-- e.g. Sai path --> | <!-- e.g. Fix path resolution --> |

## 5. Final Status

- [ ] Skill package created at `.agent/skills/skill-builder/`
- [ ] Structure validated (7-Zone compliant)
- [ ] SKILL.md reviewed and approved
- [ ] Knowledge files loaded
- [ ] Scripts tested
- [ ] Templates verified
- [ ] Loop checklist created
- [ ] Ready for use


## Validation Result (2026-02-14 13:57:51)
- **Final Status**: FAIL
- **Errors**: 1
- **Warnings**: 1
### Issues Found:
- [FAILED] [E04] ERROR: SKILL.md missing mandatory section keyword: 'Workflow'


## Validation Result (2026-02-14 13:58:17)
- **Final Status**: PASS (With Warnings)
- **Errors**: 0
- **Warnings**: 1


## Validation Result (2026-02-14 14:09:59)
- **Final Status**: PASS (With Warnings)
- **Errors**: 0
- **Warnings**: 2


## Validation Result (2026-02-14 14:10:24)
- **Final Status**: PASS
- **Errors**: 0
- **Warnings**: 0

## Resource Inventory

| Resource File | Priority | Purpose | Status |
|---|---|---|---|
| `design.md` | Critical | Architecture source of truth for builder behavior and constraints | Used |
| `todo.md` | Critical | Phase/task execution plan for builder implementation | Used |
| `resources/validation-logic.md` | Critical | Validation logic reference for `scripts/validate_skill.py` behavior | Used |
| `resources/test-fixtures/fail-pd-links/scripts/orphan.py` | Critical | Fixture for PD/orphan link validation cases | Used |
| `resources/test-fixtures/valid-skill/knowledge/doc.md` | Critical | Fixture for valid skill mapping and expected pass behavior | Used |
| `resources/test-fixtures/valid-skill/loop/check.md` | Critical | Fixture for loop/checklist structure validation | Used |
| `resources/test-fixtures/valid-skill/scripts/tool.py` | Critical | Fixture for script path validation and file mapping checks | Used |

## Resource Usage Matrix

| Resource File | Priority | Used In Task | Output File(s) | Notes |
|---|---|---|---|---|
| `design.md` | Critical | `2.1`, `2.2`, `2.3` | `.agent/skills/skill-builder/SKILL.md` | Drives workflow steps, guardrails, and delivery contract |
| `todo.md` | Critical | `2.2`, `3.3` | `.agent/skills/skill-builder/loop/build-checklist.md` | Syncs executable checks with planned tasks |
| `resources/validation-logic.md` | Critical | `2.3`, `2.4`, `3.1` | `.agent/skills/skill-builder/scripts/validate_skill.py` | Source for validator checks and reporting behavior |
| `resources/test-fixtures/fail-pd-links/scripts/orphan.py` | Critical | `3.1`, `3.2` | `.agent/skills/skill-builder/scripts/validate_skill.py` | Used to verify non-strict warning behavior on orphan files |
| `resources/test-fixtures/valid-skill/knowledge/doc.md` | Critical | `3.1`, `3.3` | `.agent/skills/skill-builder/scripts/validate_skill.py` | Used to verify strict-mode coverage and mapping checks |
| `resources/test-fixtures/valid-skill/loop/check.md` | Critical | `3.1`, `3.3` | `.agent/skills/skill-builder/scripts/validate_skill.py` | Used in loop-related validation scenarios |
| `resources/test-fixtures/valid-skill/scripts/tool.py` | Critical | `3.1`, `3.3` | `.agent/skills/skill-builder/scripts/validate_skill.py` | Used to validate scripts path handling in coverage checks |

## Validation Result (2026-02-16 01:08:45)
- **Session**: sync-agent-codex-skills
- **Non-strict Validator**: PASS (Exit Code 0)
- **Strict Validator**: PASS (Exit Code 0)
- **Context Coverage**: 7/7 critical resources traced
- **Evidence Files**:
  - `openspec/changes/sync-agent-codex-skills/evidence/validator-nonstrict-before.log`
  - `openspec/changes/sync-agent-codex-skills/evidence/validator-strict-before.log`
  - `openspec/changes/sync-agent-codex-skills/evidence/validator-nonstrict-after.log`
  - `openspec/changes/sync-agent-codex-skills/evidence/validator-strict-after.log`

## Sync Verification Result (2026-02-16 01:08:45)
- `skill-architect` parity check: PASS (`diff -qr` exit 0)
- `skill-builder` parity check: PASS (`diff -qr` exit 0)
- **Evidence Files**:
  - `openspec/changes/sync-agent-codex-skills/evidence/diff-architect-after.log`
  - `openspec/changes/sync-agent-codex-skills/evidence/diff-builder-after.log`

```

### skill-builder/todo.md
```md
# skill-builder â€” Implementation Plan

> Generated by Skill Planner | Refactored by Engineer | Date: 2026-02-14
> Status: âœ… COMPLETE (Refactor P0 Finished)

---

## 1. Pre-requisites

| # | Knowledge/Resource | Tier | Purpose | Trace | Status |
|---|--------------------|------|---------|-------|--------|
| 1 | Master Framework `architect.md` | Packaging | TiÃªu chuáº©n 7 Zones (Runtime Version) | [Tá»ª DESIGN Â§3] | âœ… Found |
| 2 | `.skill-context/skill-builder/design.md` | Input | Ground truth thiáº¿t káº¿ cho Builder | [Tá»ª DESIGN Â§3] | âœ… Found |
| 3 | `knowledge/build-guidelines.md` | Domain | Quy chuáº©n viáº¿t ná»™i dung (Usage headers) | [Tá»ª AUDIT] | âœ… Found |
| 4 | `resources/validation-logic.md` | Domain | Äáº·c táº£ ká»¹ thuáº­t cho validator | [Tá»ª AUDIT] | âœ… Found |

## 2. Phase Breakdown

### Phase 1: Foundation & Stance Setup (HOÃ€N THÃ€NH - P1 FIXED)
- [x] 1.1 Táº¡o thÆ° má»¥c `.agent/skills/skill-builder/` [Gá»¢I Ã]
- [x] 1.2 Copy `architect.md` (Runtime Version) [Tá»ª DESIGN Â§3]
- [x] 1.3 Triá»ƒn khai `knowledge/build-guidelines.md` (Usage headers + Naming rules) [Tá»ª AUDIT]
- [x] 1.4 Khá»Ÿi táº¡o `SKILL.md` (Persona: Senior Implementation Engineer, 7 Guardrails) [Tá»ª AUDIT]

### Phase 2: Core Zone Implementation (HOÃ€N THÃ€NH - P0 FIXED)
- [x] 2.1 Viáº¿t BÆ°á»›c 1-2: PREPARE & CLARIFY (ÄÃ³ng vÃ²ng logic design Â§9) [Tá»ª AUDIT]
- [x] 2.2 Viáº¿t BÆ°á»›c 3: BUILD (Sub-step Phase-driven) [Tá»ª AUDIT]
- [x] 2.3 Viáº¿t BÆ°á»›c 4-5: VERIFY & DELIVER (Thang Ä‘o 5/10, Log-Notify-Stop) [Tá»ª AUDIT]

### Phase 3: Scripts & Quality Control (HOÃ€N THÃ€NH - P0 FIXED)
- [x] 3.1 PhÃ¡t triá»ƒn `scripts/validate_skill.py` (Full P0 Spec: check_mapping, --log) [Tá»ª AUDIT]
- [x] 3.2 Táº¡o `loop/build-checklist.md` (Measurable criteria) [Tá»ª AUDIT]
- [x] 3.3 Thiáº¿t káº¿ `build-log.md` (Sync status vs reality) [Tá»ª AUDIT]

## 4. Definition of Done

- [x] **Gatekeeper**: Validator PASS trá»n bá»™ spec.
- [x] **Consitency**: Sá»‘ placeholder trong log khá»›p thá»±c táº¿.
- [x] **Integrity**: KhÃ´ng cÃ²n mÃ¢u thuáº«n giá»¯a Design, Todo vÃ  Implementation.

## 5. Notes (P0 Audit Resolution)
- [x] [RESOLVED]: ÄÃ£ Ä‘á»“ng bá»™ 7 guardrails trong SKILL.md.
- [x] [RESOLVED]: ÄÃ£ thÃªm Usage header cho toÃ n bá»™ file Knowledge.
- [x] [RESOLVED]: Validator Ä‘Ã£ cÃ³ module check_file_mapping vÃ  --log flag.

```

### skill-builder/resources/validation-logic.md
```md
# VALIDATION LOGIC SPECIFICATION: Äáº¶C Táº¢ Ká»¸ THUáº¬T KIá»‚M TRA Tá»° Äá»˜NG

TÃ i liá»‡u nÃ y Ä‘á»‹nh nghÄ©a logic nghiá»‡p vá»¥ chi tiáº¿t, cÃ¡c hÃ m kiá»ƒm tra vÃ  mÃ£ lá»—i (Error Codes) cho script `scripts/validate_skill.py`. Script nÃ y hoáº¡t Ä‘á»™ng nhÆ° má»™t "Gatekeeper" tá»± Ä‘á»™ng cuá»‘i cÃ¹ng trÆ°á»›c khi bÃ n giao sáº£n pháº©m.

## 1. Tá»”NG QUAN Há»† THá»NG
*   **Target:** ThÆ° má»¥c gá»‘c cá»§a gÃ³i Agent Skill vá»«a Ä‘Æ°á»£c xÃ¢y dá»±ng.  
*   **Input:** ÄÆ°á»ng dáº«n (Path) Ä‘áº¿n thÆ° má»¥c skill.  
*   **Output:** BÃ¡o cÃ¡o (Report) in ra console vÃ  ghi vÃ o `build-log.md`.  
*   **Exit Codes:**  
    *   `0`: Success (Táº¥t cáº£ kiá»ƒm tra Ä‘á»u PASS).  
    *   `1`: Validation Error (CÃ³ Ã­t nháº¥t 1 lá»—i Critical/Major).

## 2. CÃC MODULE KIá»‚M TRA (MANDATORY CHECKS)

Script cáº§n triá»ƒn khai 4 hÃ m kiá»ƒm tra cá»‘t lÃµi sau:

### 2.1. Module: Check Structural Integrity (`check_structure`)  
*   **Má»¥c tiÃªu:** Äáº£m báº£o khung xÆ°Æ¡ng sá»‘ng cá»§a ká»¹ nÄƒng tá»“n táº¡i Ä‘áº§y Ä‘á»§.  
*   **Logic:**  
    1. QuÃ©t thÆ° má»¥c gá»‘c cá»§a skill.  
    2. Kiá»ƒm tra sá»± tá»“n táº¡i (File Existence Check) cá»§a cÃ¡c thÃ nh pháº§n báº¯t buá»™c:  
        *   File: `SKILL.md`  
        *   Directory: `knowledge/`  
        *   Directory: `scripts/`  
        *   Directory: `loop/`  
    3. **Pass Condition:** TÃ¬m tháº¥y Ä‘á»§ 4 thÃ nh pháº§n trÃªn.  
    4. **Fail Condition:** Thiáº¿u báº¥t ká»³ thÃ nh pháº§n nÃ o.  
    5. **Error Message:** `[E01] CRITICAL: Missing mandatory zone: {missing_zone}`.

### 2.2. Module: Check Progressive Disclosure (`check_pd_links`)  
*   **Má»¥c tiÃªu:** Äáº£m báº£o tÃ­nh liÃªn káº¿t cháº·t cháº½ giá»¯a Táº§ng 1 (Core) vÃ  Táº§ng 2 (Resources).  
*   **Logic:**  
    1. Äá»c ná»™i dung file `SKILL.md` vÃ o bá»™ nhá»›.  
    2. QuÃ©t Ä‘á»‡ quy cÃ¡c thÆ° má»¥c Tier 2 (`knowledge/`, `scripts/`, `loop/`) Ä‘á»ƒ láº¥y danh sÃ¡ch táº¥t cáº£ cÃ¡c file con (Actual Files).  
    3. Vá»›i má»—i file trong danh sÃ¡ch Actual Files:  
        *   Sá»­ dá»¥ng Regex Ä‘á»ƒ tÃ¬m kiáº¿m tÃªn file hoáº·c Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i cá»§a nÃ³ trong ná»™i dung `SKILL.md`.  
        *   Regex Pattern: `r"\[.*\]\(.*{filename}.*\)"` (TÃ¬m kiáº¿m cÃº phÃ¡p Markdown link).  
    4. **Pass Condition:** TÃªn file hoáº·c Ä‘Æ°á»ng dáº«n xuáº¥t hiá»‡n trong `SKILL.md`.  
    5. **Fail Condition:** File tá»“n táº¡i trong thÆ° má»¥c nhÆ°ng khÃ´ng Ä‘Æ°á»£c tham chiáº¿u trong `SKILL.md`.  
    6. **Warning Message:** ` WARNING: Orphan file detected. '{filename}' exists but is not linked in SKILL.md`.

### 2.3. Module: Check File Consistency (`check_file_mapping`)  
*   **Má»¥c tiÃªu:** Äáº£m báº£o sáº£n pháº©m thá»±c táº¿ khá»›p 100% vá»›i báº£n thiáº¿t káº¿.  
*   **Input:**  
    *   `expected_list`: Danh sÃ¡ch file Ä‘Æ°á»£c parse tá»« section "Zone Mapping" cá»§a `design.md`.  
    *   `actual_list`: Danh sÃ¡ch file thá»±c táº¿ quÃ©t Ä‘Æ°á»£c tá»« á»• Ä‘Ä©a.  
*   **Logic:**  
    1. Thá»±c hiá»‡n so sÃ¡nh táº­p há»£p (Set Comparison).  
    2. XÃ¡c Ä‘á»‹nh `Missing Files` = `expected_list` - `actual_list`.  
    3. XÃ¡c Ä‘á»‹nh `Extra Files` = `actual_list` - `expected_list`.  
    4. **Pass Condition:** Cáº£ hai danh sÃ¡ch Missing vÃ  Extra Ä‘á»u rá»—ng.  
    5. **Fail Condition:** `Missing Files` khÃ´ng rá»—ng.  
    6. **Error Message:** `[E02] ERROR: Deviation from Design. Missing files: {missing_files}`.

### 2.5. Module: Check Placeholder Density (`check_placeholders`)
*   **Má»¥c tiÃªu:** Kiá»ƒm soÃ¡t má»©c Ä‘á»™ hoÃ n thiá»‡n vá» ná»™i dung.
*   **Logic:**
    1. Äáº¿m chuá»—i `[MISSING_DOMAIN_DATA]` trÃªn toÃ n bá»™ gÃ³i skill.
    2. PhÃ¢n loáº¡i má»©c Ä‘á»™:
       - **0 - 4**: PASS (Normal).
       - **5 - 9**: WARNING (Medium - Cáº§n bá»• sung tÃ i nguyÃªn).
       - **10+**: FAIL (High - Build tháº¥t báº¡i do thiáº¿u dá»¯ liá»‡u tráº§m trá»ng).

### 2.6. Module: Error Policy Check (`check_error_handling`)
*   **Má»¥c tiÃªu:** Äáº£m báº£o Builder Ä‘Ã£ dá»«ng láº¡i khi cÃ³ lá»—i há»‡ thá»‘ng.
*   **Logic:** 
    1. Kiá»ƒm tra ghi chÃº trong `build-log.md`.
    2. Náº¿u cÃ³ lá»—i há»‡ thá»‘ng nhÆ°ng Builder váº«n tiáº¿p tá»¥c táº¡o file sau Ä‘Ã³ -> FAIL.

## 3. CÆ  CHáº¾ BÃO CÃO (REPORTING)

### 3.1. Console Output Template  
Káº¿t quáº£ cáº§n Ä‘Æ°á»£c in ra mÃ n hÃ¬nh theo Ä‘á»‹nh dáº¡ng báº£ng dá»… Ä‘á»c:
```text
==================================================  
   AGENT SKILL VALIDATION REPORT  
   Target: {skill_name}  
   Time: {timestamp}  
==================================================  
1. Checking 4 Zones.........  
2. SKILL.md Length......... (340 lines)  
3. [MAPPING] File Consistency.........  
4. Progressive Disclosure... [FAIL]  
   -> Orphan file: loop/extra_check.md  
==================================================  
FINAL STATUS: FAIL (Due to Warnings/Errors)  
See build-log.md for details.
```

### 3.2. Log Integration
* Script pháº£i cÃ³ cháº¿ Ä‘á»™ --log Ä‘á»ƒ ghi (append) toÃ n bá»™ ná»™i dung bÃ¡o cÃ¡o trÃªn vÃ o cuá»‘i file loop/build-log.md. Äiá»u nÃ y Ä‘áº£m báº£o tÃ­nh truy váº¿t (Traceability) cho bÆ°á»›c DELIVER.

```

### skill-builder/resources/test-fixtures/valid-skill/loop/check.md
```md

```

### skill-builder/resources/test-fixtures/valid-skill/knowledge/doc.md
```md

```

### skill-builder/resources/test-fixtures/valid-skill/scripts/tool.py
```py

```

### skill-builder/resources/test-fixtures/fail-pd-links/scripts/orphan.py
```py

```

### activity-diagram-design-analyst/design.md
```md
# activity-diagram-design-analyst â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-15
> Status: ğŸ”µ IN PROGRESS

---

## 1. Problem Statement

Skill nÃ y giáº£i quyáº¿t bÃ i toÃ¡n phÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ sÆ¡ Ä‘á»“ Activity Diagram theo dá»¯ liá»‡u nghiá»‡p vá»¥ thá»±c táº¿, thay vÃ¬ váº½ sÆ¡ Ä‘á»“ "happy path" Ä‘Æ¡n giáº£n.

**Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t (Refactor v2.0):**
- **Sá»± máº¥t mÃ¡t tri thá»©c (Knowledge Loss)**: CÃ¡c phiÃªn báº£n trÆ°á»›c thÆ°á»ng tÃ³m táº¯t (summarize) tÃ i liá»‡u gá»‘c, dáº«n Ä‘áº¿n viá»‡c AI bá» sÃ³t cÃ¡c tiá»ƒu tiáº¿t ká»¹ thuáº­t quan trá»ng (Fork/Join, Object Flow, Flow Final).
- **Thiáº¿u tÃ­nh pháº£n biá»‡n**: AI dá»… dÃ ng cháº¥p nháº­n logic cá»§a ngÆ°á»i dÃ¹ng mÃ  khÃ´ng kiá»ƒm tra cÃ¡c rá»§i ro kinh Ä‘iá»ƒn nhÆ° Deadlock khi dÃ¹ng Fork/Join sai cÃ¡ch.
- **TÃ­nh Ä‘Ã³ng gÃ³i**: Cáº§n chuáº©n hÃ³a láº¡i bá»™ tri thá»©c Clean Architecture B-U-E Ä‘á»ƒ Ã¡p dá»¥ng vÃ o modeling nghiá»‡p vá»¥ má»™t cÃ¡ch nháº¥t quÃ¡n.

**NhÃ³m ngÆ°á»i dÃ¹ng chÃ­nh:**
- Analyst/BA cáº§n chuyá»ƒn hÃ³a use case thÃ nh luá»“ng hoáº¡t Ä‘á»™ng ráº¡ng ngá»i tri thá»©c.
- Senior Engineer cáº§n má»™t cÃ´ng cá»¥ review logic cÃ³ kháº£ nÄƒng phÃ¡t hiá»‡n lá»—i Semantic.
- Team Lead cáº§n audit thiáº¿t káº¿ theo tiÃªu chuáº©n Clean Architecture.

**Hai tÃ¬nh huá»‘ng Ä‘áº§u vÃ o (Modes):**
1. **Mode A (Design V1)**: NgÆ°á»i dÃ¹ng chÆ°a cÃ³ sÆ¡ Ä‘á»“, skill pháº£i phÃ¢n tÃ­ch Context vÃ  táº¡o báº£n Mermaid V1 vá»›i Ä‘á»™ chi tiáº¿t cao.
2. **Mode B (Refactor/Audit)**: NgÆ°á»i dÃ¹ng Ä‘Ã£ cÃ³ sÆ¡ Ä‘á»“, skill pháº£i Ä‘Ã³ng vai trÃ² "Ká»¹ sÆ° Audit" Ä‘á»ƒ chá»‰ ra rá»§i ro logic (CF-0x, DL-0x...) vÃ  Ä‘á» xuáº¥t cáº£i tiáº¿n.

**GiÃ¡ trá»‹ cá»‘t lÃµi:**
- **High-Fidelity**: Chuyá»ƒn hÃ³a 100% tri thá»©c tá»« tÃ i liá»‡u nghiÃªn cá»©u, khÃ´ng tÃ³m táº¯t.
- **Traceability**: Má»i thÃ nh pháº§n sÆ¡ Ä‘á»“ Ä‘á»u pháº£i truy váº¿t Ä‘Æ°á»£c nguá»“n tá»« Context.
- **Clean Architecture Lens**: Ãp dá»¥ng triá»‡t Ä‘á»ƒ phÃ¢n lá»›p Boundary-UseCase-Entity vÃ o Swimlane.

## 2. Capability Map

### 2.1 Tri thá»©c (Knowledge) - Táº§m nhÃ¬n High-Fidelity
- **UML Activity Diagram Specialization**:
  - KhÃ´ng chá»‰ cÃ¡c node cÆ¡ báº£n, mÃ  pháº£i náº¯m vá»¯ng: Object Node, Pin, Expansion Region (náº¿u cáº§n), cÃ¡c cÆ¡ cháº¿ Token flow.
  - PhÃ¢n biá»‡t ráº¡ch rÃ²i giá»¯a Fork/Join (Concurrency) vÃ  Decision/Merge (Choice).
- **Comprehensive Research (100% Transform)**:
  - TÃ i nguyÃªn gá»‘c: `resources/activity-diagram-research.md`.
  - Nhiá»‡m vá»¥: Chuyá»ƒn hÃ³a toÃ n bá»™ quy táº¯c, kÃ½ hiá»‡u, vÃ  cáº¡m báº«y logic vÃ o skill. Tuyá»‡t Ä‘á»‘i khÃ´ng viáº¿t kiá»ƒu "tÃ³m táº¯t".
- **Clean Architecture B-U-E Lens**:
  - TÆ° duy phÃ¢n lá»›p: Boundary (Giao diá»‡n/TÆ°Æ¡ng tÃ¡c), Use Case (Logic phá»‘i há»£p), Entity (Luáº­t nghiá»‡p vá»¥ cá»‘t lÃµi).
  - Kháº£ nÄƒng Ã¡nh xáº¡ (Mapping) tá»« Use Case steps sang Swimlane tÆ°Æ¡ng á»©ng.

### 2.2 Quy trÃ¬nh (Process) - Expert Persona
Workflow 4-Phase (Gate-based):
1. **Phase 1: Collect**: Nháº­n dáº¡ng Mode A/B vÃ  tháº©m Ä‘á»‹nh Context.
2. **Phase 2: Analyze**: TrÃ­ch xuáº¥t Logical Baseline. ÄÃ o sÃ¢u cÃ¡c "Edge cases" vÃ  "Exception flows".
3. **Phase 3: Design/Refactor**: Táº¡o Mermaid vá»›i Ä‘á»™ tháº©m má»¹ cao vÃ  bÃ¡o cÃ¡o Findings chuyÃªn sÃ¢u.
4. **Phase 4: Explain**: Giáº£i thÃ­ch lÃ½ do thiáº¿t káº¿ dá»±a trÃªn Clean Architecture.

### 2.3 Kiá»ƒm soÃ¡t (Guardrails) - Tháº¯t cháº·t ká»· luáº­t
- **G1: High-Fidelity**: KhÃ´ng summarize tri thá»©c ká»¹ thuáº­t. Náº¿u tÃ i nguyÃªn nÃ³i cÃ³ 10 loáº¡i lá»—i, skill pháº£i biáº¿t 10 loáº¡i lá»—i.
- **G2: Anti-Hallucination**: KhÃ´ng tá»± bá»‹a nghiá»‡p vá»¥. DÃ¹ng `[MISSING_DOMAIN_DATA]` khi thiáº¿u context.
- **G3: Risk Focus**: Pháº£i phÃ¡t hiá»‡n Ã­t nháº¥t má»™t rá»§i ro tiá»m áº©n (vÃ­ dá»¥: thiáº¿u luá»“ng lá»—i) náº¿u nghiá»‡p vá»¥ phá»©c táº¡p.
- **G4: Interaction Gate**: KhÃ´ng tá»± Ã½ hoÃ n thiá»‡n náº¿u Ä‘á»™ tin cáº­y < 70%.
- **G5: Language Accuracy**: Sá»­ dá»¥ng Tiáº¿ng Viá»‡t chuyÃªn nghiá»‡p, thuáº­t ngá»¯ Tiáº¿ng Anh giá»¯ nguyÃªn (Swimlane, Fork, Join).

## 3. Zone Mapping

| Zone | Ná»™i dung | Báº¯t buá»™c? |
|------|----------|----------|
| Core (`SKILL.md`) | Persona "Senior Activity Design Engineer", Quy trÃ¬nh 4-Phase, High-Fidelity Guards | âœ… |
| Knowledge | **100% Transform** tá»« `activity-diagram-research.md`, `refactor-risk-patterns.md`, `clean-architecture-lens.md` | âœ… |
| Scripts | `scripts/validate_syntax.py`, `scripts/report_generator.py` (Há»— trá»£ AI kiá»ƒm tra syntax vÃ  táº¡o bÃ¡o cÃ¡o) | Optional |
| Templates | `templates/activity-mode-a.template.md`, `templates/activity-mode-b.template.md`, `templates/findings-report.template.md` | âœ… |
| Data | `data/rules.yaml`, `data/severity-matrix.yaml` (Dá»¯ liá»‡u cá»©ng vá» tiÃªu chuáº©n) | âœ… |
| Loop | `loop/checklist.md`, `loop/phase-verify.md`, `loop/final-verify.md` | âœ… |
| Assets | `assets/symbols-cheatsheet.md` | Optional |

## 4. Folder Structure

Mermaid mindmap de xac dinh bo khung skill.

```mermaid
mindmap
  root((activity-diagram-design-analyst))
    SKILL.md
      Persona
      Two Modes A/B
      Guardrails
      Output Contract
    knowledge
      activity-uml-rules.md
      refactor-risk-patterns.md
      clean-architecture-lens.md
      source-prioritization.md
    scripts
      validate_syntax.py
      report_generator.py
    templates
      activity-mode-a.template.md
      activity-mode-b.template.md
      findings-report.template.md
    data
      rules.yaml
      severity-matrix.yaml
    loop
      checklist.md
      phase-verify.md
      final-verify.md
      test-cases
        mode-a-design-v1.md
        mode-b-refactor.md
    assets
      symbols-cheatsheet.md
```

## 5. Execution Flow

Sequence flow de mo ta luong runtime theo 2 mode.

```mermaid
sequenceDiagram
    participant U as User
    participant S as Skill
    participant K as Research Base
    participant V as Verify Loop

    U->>S: Context input + (optional) existing diagram
    S->>S: Detect Mode A or Mode B
    S->>K: Retrieve docs and references
    K-->>S: Evidence package
    S->>S: Synthesize business flow
    alt Mode A (no existing diagram)
        S->>S: Generate Mermaid V1
    else Mode B (diagram exists)
        S->>S: Audit and refactor Mermaid
    end
    S->>V: Structural + logic + traceability checks
    V-->>S: Findings + risk levels
    S->>U: Diagram + gaps + clean-architecture guidance
```

## 6. Interaction Points

| # | Thoi diem | Ly do |
|---|-----------|-------|
| 1 | Sau khi doc input ban dau | Xac nhan mode A/B va pham vi use case |
| 2 | Sau khi trich xuat actor + business rules | Xac nhan khong bo sot nghiep vu quan trong |
| 3 | Truoc khi chot diagram | Trinh bay assumptions va diem mo ho can user quyet dinh |
| 4 | Sau khi gap analysis | Xac nhan muc uu tien cho cac de xuat refactor |

## 7. Progressive Disclosure Plan

### Tang 1: Bat buoc doc (Mandatory)
- SKILL.md
- knowledge/activity-uml-rules.md
- knowledge/clean-architecture-lens.md
- loop/checklist.md
- Docs/diagram/activity-diagram-research.md (neu ton tai trong repo)

### Tang 2: Tu quyet dinh (Conditional)
- knowledge/refactor-risk-patterns.md (chi dung cho Mode B)
- templates/activity-mode-a.template.md (khi tao moi V1)
- templates/activity-mode-b.template.md (khi refactor)
- data/rules.yaml, data/severity-matrix.yaml (khi can danh gia dinh luong)
- Tai lieu user chi dinh them (spec/usecase/domain docs)

## 8. Risks & Blind Spots

| # | Risk | Mitigation |
|---|------|------------|
| 1 | Diagram dung ky hieu nhung sai logic nghiep vu | Bat buoc trace moi nhanh voi rule/context goc |
| 2 | Thieu luong ngoai le do context mo ta "happy path" | Checklist bat buoc co alternate/error path |
| 3 | Nham Swimlane (sai chu the thuc hien) | Mapping actor-action truoc khi ve diagram |
| 4 | Lam dung tu cua hinh thuc, thieu tinh clean architecture | Danh gia theo boundary/use-case separation checklist |
| 5 | Over-assumption khi context thieu | Bat buoc output section "Assumptions + Questions" |
| 6 | Refactor qua tay lam phuc tap hoa flow | Uu tien don gian, giam so node, giu traceability |

## 9. Open Questions

| # | Cau hoi | Trang thai |
|---|---------|-----------|
| 1 | Co can ho tro input anh/screenshot diagram hay chi markdown mermaid? | â“ |
| 2 | Co can chuan hoa output song ngu (VI/EN) ngay tu V1? | â“ |
| 3 | Muc do tu dong sua diagram den dau thi can dung va hoi user? | â“ |
| 4 | Co can scoring dinh luong (0-100) cho quality diagram? | â“ |

## 9.1 Workflow Phases (Gate-based)

```mermaid
flowchart LR
    P1[Phase 1 Collect<br/>Context + Mode Detection] -->|Gate 1| P2[Phase 2 Analyze<br/>Rules + Business Logic]
    P2 -->|Gate 2| P3[Phase 3 Design/Refactor<br/>Mermaid + Findings]
    P3 -->|Gate 3| P4[Phase 4 Explain<br/>Clean Architecture Guidance]

    P1 -.-> I1[Interaction: Confirm scope]
    P2 -.-> I2[Interaction: Confirm assumptions]
    P3 -.-> I3[Interaction: Prioritize fixes]
```

## 10. Metadata

- **Skill Name**: activity-diagram-design-analyst
- **Created**: 2026-02-15
- **Refactored**: 2026-02-16 (v2.0 - High-Fidelity Upgrade)
- **Author**: Anti-gravity (using Master Skill Suite)
- **Framework**: architect.md v2.0
- **Primary Use**: PhÃ¢n tÃ­ch, thiáº¿t káº¿ vÃ  Audit Activity Diagram chuyÃªn sÃ¢u.
- **Status**: ï¿½ DESIGN REFACTORED - READY FOR PLANNING

```

### activity-diagram-design-analyst/build-log.md
```md
# Build Log - activity-diagram-design-analyst Refactor v2.0

> Date: 2026-02-16
> Role: Skill Builder (Senior Implementation Engineer)

## Resource Inventory
- `design.md`: v2.0 Refactored (High-Fidelity)
- `todo.md`: Phase 5 Active
- `resources/activity-diagram-research.md`: Rich Source (294 lines)

## Resource Usage Matrix
| Task | Target File | Source Files | Fidelity Confirmation |
|------|-------------|--------------|-----------------------|
| 1.3  | `data/rules.yaml` | `data/rules.yaml` | âœ… Rule mapping verified |
| 1.4  | `data/severity-matrix.yaml` | `data/severity-matrix.yaml` | âœ… Severity criteria verified |
| 5.1  | `knowledge/activity-uml-rules.md` | `resources/activity-diagram-research.md` | âœ… 100% Transform (Object flow, Flow Final, etc.) |
| 5.2  | `knowledge/refactor-risk-patterns.md` | `resources/refactor-risk-patterns.md` | âœ… Detailed error codes & refactor solutions |
| 5.3  | `SKILL.md` | `design.md` v2.0 | âœ… Expert Persona & 4-Phase logic |
| 3.2  | `knowledge/clean-architecture-lens.md`| `resources/clean-architecture-notes.md` | âœ… B-U-E mapping verified |
| 5.4  | `scripts/validate_syntax.py` | Built-in Mermaid rules | âœ… Basic syntax validation script added |
| 5.5  | `loop/checklist.md` etc. | Clean Architecture v2.0 | âœ… Upgraded to High-Fidelity standards |

## Progress Log
- [2026-02-16 15:40] Started Phase 5: High-Fidelity Refactoring.
- [2026-02-16 15:40] Design and Todo updated to v2.0.
- [2026-02-16 15:55] Completed Task 5.1 & 5.2. Knowledge zones are "Rich".
- [2026-02-16 16:05] Completed Task 5.3, 5.4, 5.5. Skill is now high-fidelity ready.


## Validation Result (2026-02-16 15:36:16)
- **Final Status**: FAIL
- **Errors**: 1
- **Warnings**: 14
### Issues Found:
- [FAILED] [E02] ERROR: Missing file from design: scripts/report_generator.py


## Validation Result (2026-02-16 15:36:58)
- **Final Status**: PASS (With Warnings)
- **Errors**: 0
- **Warnings**: 12

```

### activity-diagram-design-analyst/todo.md
```md
# activity-diagram-design-analyst â€” Implementation Plan

> Generated by Skill Planner | Date: 2026-02-16
> Status: ğŸ”µ REFACTORING - IN PROGRESS

---

## 1. Pre-requisites

| # | Knowledge/Resource | Tier (Domain/Technical/Packaging) | Purpose | Trace | Status |
|---|--------------------|-----------------------------------|---------|-------|--------|
| 1 | `resources/activity-diagram-research.md` | Domain | Ná»n táº£ng UML Activity Diagram (100% Volume) | [Tá»ª DESIGN Â§2.1] | âœ… Rich |
| 2 | `resources/clean-architecture-notes.md` | Domain | Lens B-U-E cho modeling nghiá»‡p vá»¥ | [Tá»ª DESIGN Â§2.1] | âœ… Rich |
| 3 | `resources/refactor-risk-patterns.md` | Domain | ThÆ° viá»‡n rá»§i ro (CF, DL, PL, RS, EX) | [Tá»ª DESIGN Â§3] | âœ… Rich |
| 4 | Refactored `design.md` | Packaging | Báº£n thiáº¿t káº¿ v2.0 cho má»¥c tiÃªu High-Fidelity | [Tá»ª DESIGN Â§10] | âœ… Ready |

## 2. Phase Breakdown

### Phase 1 -> 4 (Legacy - Maintenance)
- [x] Legacy tasks for foundational setup (Rules, Matrix, Templates). [Tá»ª DESIGN v1.0]

### Phase 5 - High-Fidelity Refactoring (Báº®T BUá»˜C)
- [x] **Task 5.1: Transform exhaustive knowledge into `knowledge/activity-uml-rules.md`**. [Tá»ª DESIGN Â§2.1]
- [x] **Task 5.2: Refactor `knowledge/refactor-risk-patterns.md`**. [Tá»ª DESIGN Â§3]
- [x] **Task 5.3: Update `SKILL.md` to Senior Engineer Persona**. [Tá»ª DESIGN Â§3]
- [x] **Task 5.4: Implement logic-checking automation (scripts)**. [Tá»ª DESIGN Â§3]
- [x] **Task 5.5: Update Loop Assets**. [Tá»ª DESIGN Â§3]

## 3. Knowledge & Resources Needed

- TÃ i liá»‡u nghiÃªn cá»©u gá»‘c: `resources/activity-diagram-research.md` (294 lines).
- Design v2.0 (High-Fidelity update).

## 4. Definition of Done

- [ ] `knowledge/` files pháº£n Ã¡nh 100% thÃ´ng tin ká»¹ thuáº­t tá»« resources (khÃ´ng summarization).
- [ ] `SKILL.md` sá»­ dá»¥ng Persona chuyÃªn gia vÃ  cÃ³ quy trÃ¬nh Gate-based rÃµ rÃ ng.
- [ ] ToÃ n bá»™ trace tags Ä‘Æ°á»£c giá»¯ vá»¯ng vÃ  cáº­p nháº­t theo v2.0.
- [ ] BÃ¡o cÃ¡o `build-log.md` ghi nháº­n sá»± cáº£i thiá»‡n vá» máº­t Ä‘á»™ tri thá»©c.

## 5. Notes

- TrÃ¡nh viá»‡c "over-coding" script náº¿u prompt-based logic Ä‘Ã£ Ä‘á»§ máº¡nh. Táº­p trung vÃ o cháº¥t lÆ°á»£ng `SKILL.md`.
- Trá»ng tÃ¢m: Sá»± khÃ¡c biá»‡t giá»¯a Fork/Join vÃ  Decision/Merge pháº£i cá»±c ká»³ rÃµ rÃ ng trong knowledge.

```

### activity-diagram-design-analyst/loop/rule-severity-loop-checklist.md
```md
# Rule Severity Loop Checklist (n = 0 -> 9)

## Purpose
Checklist de dam bao vong lap refactor khong bo buoc, co bang chung kiem dinh, va tranh ket luan ao gia.

## Non-Skippable Steps Per Loop
1. Xac dinh `n` hien tai va muc tieu thay doi.
2. Ghi thay doi du kien vao log truoc khi sua file.
3. Cap nhat artifact (`data/rules.yaml` hoac `data/severity-matrix.yaml`) neu can.
4. Chay kiem tra cu phap YAML.
5. Chay kiem tra toan ven:
   - co du field bat buoc trong moi rule
   - severity nam trong tap cho phep
   - trace_sources khong rong
6. Ghi ket qua thuc te vao log (pass/fail + so lieu).
7. Danh dau hoan thanh vong lap va tang `n = n + 1`.

## Anti-Hallucination Controls
- Khong ghi "da lam" neu khong co lenh kiem tra tuong ung.
- Moi ket luan phai co bang chung tu file hoac command output.
- Neu fail validation thi khong duoc tang `n`.
- Neu khong co thay doi trong vong lap, phai ghi ro "no-change loop" va ly do.

## Loop Tracker

| n | Planned Goal | Syntax Check | Integrity Check | Log Updated | n+1 Done |
|---|--------------|--------------|-----------------|------------|----------|
| 0 | Tao baseline V1 cho rules + matrix | [x] | [x] | [x] | [x] |
| 1 | Bo sung required_nodes checks | [x] | [x] | [x] | [x] |
| 2 | Bo sung control_flow + decision rules | [x] | [x] | [x] | [x] |
| 3 | Bo sung parallelism rules | [x] | [x] | [x] | [x] |
| 4 | Bo sung responsibility + clean architecture rules | [x] | [x] | [x] | [x] |
| 5 | Chuan hoa severity matrix va escalation | [x] | [x] | [x] | [x] |
| 6 | Chuan hoa review gate + quality scoring | [x] | [x] | [x] | [x] |
| 7 | Kiem tra trace coverage va schema contract | [x] | [x] | [x] | [x] |
| 8 | Refactor naming + suggestion consistency | [x] | [x] | [x] | [x] |
| 9 | Final freeze + doc sync vao todo | [x] | [x] | [x] | [x] |

## Completion Rule
- Ket thuc khi `n == 9` va tat ca cot trong Loop Tracker la `[x]`.


```

### activity-diagram-design-analyst/resources/clean-architecture-notes.md
```md
Vai trÃ²: LÃ m â€œlensâ€ Ä‘á»ƒ review / thiáº¿t káº¿ Activity Diagram theo tÆ° duy **Boundary â€“ Use Case â€“ Entity**, trÃ¡nh láº«n UI/Infra vÃ o business flow, Ä‘áº£m báº£o luá»“ng thá»ƒ hiá»‡n Ä‘Ãºng **Use Case + Business Rules** chá»© khÃ´ng pháº£i chi tiáº¿t framework.

---

## 1. Má»¥c tiÃªu & pháº¡m vi Ã¡p dá»¥ng

### 1.1 Má»¥c tiÃªu

- Äá»‹nh nghÄ©a má»™t **cÃ¡ch nhÃ¬n chuáº©n Clean Architecture** khi Ä‘á»c/váº½ Activity Diagram:
- TÃ¡ch rÃµ:
  - **Actor (User / External System)**
  - **Use Case (Application Service / Orchestrator)**
  - **Domain (Entity / Domain Service / Domain Rules)**
  - **External Systems (DB, Message Queue, Payment, Email, Search, â€¦)**
- Háº¡n cháº¿:
  - KhÃ´ng Ä‘á»ƒ luá»“ng bá»‹ **UI-driven** (chá»‰ xoay quanh mÃ n hÃ¬nh/nÃºt).
  - KhÃ´ng Ä‘á»ƒ luá»“ng bá»‹ **DB-driven** (chá»‰ xoay quanh insert/update/delete).
- Há»— trá»£:
  - **Mode A (Design V1)**: giÃºp thiáº¿t káº¿ Activity Diagram tá»« yÃªu cáº§u.
  - **Mode B (Refactor/Audit)**: lÃ m khung review, phÃ¡t hiá»‡n chá»— sai layer hoáº·c thiáº¿u domain rule.

### 1.2 Pháº¡m vi

- Ãp dá»¥ng cho **luá»“ng nghiá»‡p vá»¥ cáº¥p Use Case**:
  - VÃ­ dá»¥: â€œÄÄƒng nháº­pâ€, â€œÄÄƒng bÃ i viáº¿tâ€, â€œDuyá»‡t bÃ i viáº¿tâ€, â€œBÃ¡o cÃ¡o vi pháº¡mâ€.
  - CÃ³ thá»ƒ Ã¡p dá»¥ng cho: Use case ngÆ°á»i dÃ¹ng (User/Admin) vÃ  Use case há»‡ thá»‘ng ná»™i bá»™ (cron job, batch xá»­ lÃ½).
- KhÃ´ng táº­p trung:
  - CÃ¡c luá»“ng thuáº§n háº¡ táº§ng (backup DB, rotate log).
  - CÃ¡c flow siÃªu low-level (vÃ­ dá»¥ thuáº­t toÃ¡n trong 1 function Ä‘Æ¡n láº»).

### 1.3 Khi nÃ o dÃ¹ng trong Mode A/B

- **Mode A â€“ Design V1**:
  - Sau khi: Äá»c xong requirement + use case, náº¯m Ä‘Æ°á»£c thuáº­t ngá»¯ domain cÆ¡ báº£n.
  - TrÆ°á»›c khi: Váº½ Activity Diagram V1.
  - CÃ¡ch dÃ¹ng: DÃ¹ng checklist Ä‘á»ƒ chá»n **swimlane** Ä‘Ãºng, quyáº¿t Ä‘á»‹nh action nÃ o thuá»™c Use Case/Domain/External, vÃ  xÃ¡c Ä‘á»‹nh chá»— cáº§n decision node cho domain rule.
- **Mode B â€“ Refactor/Audit**:
  - Khi Ä‘Ã£ cÃ³ Activity Diagram hiá»‡n táº¡i cáº§n kiá»ƒm tra lá»—i phÃ¢n táº§ng hoáº·c thiáº¿u domain rule.
  - CÃ¡ch dÃ¹ng: So sÃ¡nh tá»«ng node vá»›i lens Clean Architecture (Node nÃ y Ä‘Ãºng lane chÆ°a? CÃ³ rule domain nÃ o bá»‹ thiáº¿u?).

---

## 2. TÃ³m táº¯t Clean Architecture cho modeling luá»“ng nghiá»‡p vá»¥

### 2.1 CÃ¡c vÃ²ng trÃ²n Clean Architecture (tÃ³m táº¯t)

Theo Clean Architecture cá»§a Uncle Bob, há»‡ thá»‘ng Ä‘Æ°á»£c chia thÃ nh cÃ¡c vÃ²ng trÃ²n Ä‘á»“ng tÃ¢m:

- **Entities (Domain Layer)**:
  - Chá»©a business rules quan trá»ng, **báº¥t biáº¿n** theo thá»i gian.
  - KhÃ´ng phá»¥ thuá»™c UI, DB, framework.
- **Use Cases (Application Layer)**:
  - Äiá»u phá»‘i luá»“ng nghiá»‡p vá»¥ (workflow): Nháº­n input tá»« Actor, gá»i Entities Ä‘á»ƒ thá»±c hiá»‡n rule, gá»i gateway Ä‘á»ƒ Ä‘á»c/ghi dá»¯ liá»‡u.
- **Interface Adapters**:
  - Chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u giá»¯a core vÃ  external (Controllers, Presenters, View Models).
- **Frameworks & Drivers (Infrastructure)**:
  - Web framework, DB, file system, external API.

**NguyÃªn táº¯c phá»¥ thuá»™c (Dependency Rule):** CÃ¡c vÃ²ng trÃ²n bÃªn trong **khÃ´ng Ä‘Æ°á»£c** phá»¥ thuá»™c vÃ²ng ngoÃ i.

### 2.2 Checklist phÃ¢n lá»›p cho Activity Diagram

Khi nhÃ¬n vÃ o **má»™t action**, nÃªn tráº£ lá»i:

1. **ÄÃ¢y lÃ  hÃ nh Ä‘á»™ng cá»§a Actor?** (VD: "Nháº­p thÃ´ng tin", "Nháº¥n ÄÄƒng bÃ i")
2. **ÄÃ¢y lÃ  bÆ°á»›c Ä‘iá»u phá»‘i Use Case (Application)?** (VD: "Tiáº¿p nháº­n yÃªu cáº§u", "Validate input")
3. **ÄÃ¢y lÃ  domain rule / xá»­ lÃ½ nghiá»‡p vá»¥ cá»‘t lÃµi?** (VD: "Kiá»ƒm tra quyá»n", "TÃ­nh Ä‘iá»ƒm uy tÃ­n")
4. **ÄÃ¢y lÃ  tÆ°Æ¡ng tÃ¡c vá»›i há»‡ thá»‘ng ngoÃ i (External/Infra)?** (VD: "LÆ°u bÃ i viáº¿t vÃ o DB", "Gá»­i email")

Náº¿u **khÃ´ng phÃ¢n loáº¡i Ä‘Æ°á»£c**, cÃ³ thá»ƒ flow Ä‘ang mÃ´ táº£ UI layout hoáº·c chi tiáº¿t ká»¹ thuáº­t khÃ´ng cáº§n thiáº¿t.

---

## 3. Mapping Clean Architecture â†” Activity Diagram

### 3.1 Thiáº¿t káº¿ swimlane theo layer

- **Lane 1 â€“ Actor(s)**: User, Admin, External Service. Action dáº¡ng: â€œNháº­p...â€, â€œChá»n...â€, â€œNháº¥n...â€.
- **Lane 2 â€“ Application / Use Case**: Application Service. Action dáº¡ng: â€œTiáº¿p nháº­n yÃªu cáº§uâ€, â€œOrchestrate flowâ€.
- **Lane 3 â€“ Domain (Entity / Domain Service)**: Business logic thuáº§n. Action dáº¡ng: â€œKiá»ƒm tra quotaâ€, â€œTÃ­nh Ä‘iá»ƒm thÆ°á»Ÿngâ€.
- **Lane 4 â€“ External Systems / Infrastructure**: DB, Payment, Email. Action dáº¡ng: â€œLÆ°u DBâ€, â€œGá»­i emailâ€.

> **Quy táº¯c:** KhÃ´ng dÃ¹ng lane â€œUIâ€ hay â€œControllerâ€. Domain rule pháº£i náº±m á»Ÿ lane Domain hoáº·c Application.

### 3.2 Quy táº¯c Ä‘áº·t action & decision

**Action naming:**
- Æ¯u tiÃªn **Ä‘á»™ng tá»« + bá»• ngá»¯ nghiá»‡p vá»¥** (VD: "Kiá»ƒm tra thÃ´ng tin Ä‘Äƒng nháº­p").
- TrÃ¡nh tÃªn thuáº§n ká»¹ thuáº­t (VD: "Insert DB posts").

**Decision placement:**
- Decision vá» **domain rule**: Äáº·t trong lane **Domain**.
- Decision vá» **orchestration/policy**: Äáº·t trong lane **Application**.
- Decision vá» **lá»±a chá»n UI**: Äáº·t trong lane **Actor**.

**Guard condition:**
- LuÃ´n ghi Ä‘iá»u kiá»‡n trÃªn cáº¡nh ra: `[Há»£p lá»‡]`, `[KhÃ´ng há»£p lá»‡]`, `[CÃ³ quyá»n]`.

### 3.3 Mapping tá»« Use Case â†’ Activity Diagram

- **Basic flow step** â†’ Action node trong lane Application/Domain/Actor.
- **Alternative flow** â†’ Branch tá»« 1 decision node.
- **Exception flow** â†’ Branch lá»—i (dáº«n tá»›i Final hoáº·c quay vá» bÆ°á»›c an toÃ n).

---

## 4. Antiâ€‘pattern thÆ°á»ng gáº·p (theo lens Clean Architecture)

### 4.1 UIâ€‘driven flow
- Dáº¥u hiá»‡u: Action tÃªn ráº¥t UI (â€œMá»Ÿ formâ€, â€œHiá»ƒn thá»‹ mÃ n hÃ¬nhâ€).
- Há»‡ quáº£: Logic nghiá»‡p vá»¥ bá»‹ má» nháº¡t, khÃ³ test domain Ä‘á»™c láº­p.

### 4.2 Persistenceâ€‘first flow (DBâ€‘driven)
- Dáº¥u hiá»‡u: Action táº­p trung vÃ o lá»‡nh DB (â€œInsert tableâ€, â€œUpdate columnâ€).
- Há»‡ quáº£: Domain logic bá»‹ chÃ´n trong repository/ORM.

### 4.3 Thiáº¿u domain rule gate
- Dáº¥u hiá»‡u: Requirement cÃ³ rule nhÆ°ng diagram khÃ´ng cÃ³ decision node tÆ°Æ¡ng á»©ng.
- Há»‡ quáº£: Rule dá»… bá»‹ quÃªn khi implement.

### 4.4 Swimlane láº«n lá»™n trÃ¡ch nhiá»‡m
- Dáº¥u hiá»‡u: Lane User chá»©a action â€œLÆ°u DBâ€, lane External chá»©a action â€œKiá»ƒm tra quyá»nâ€.
- Há»‡ quáº£: Hiá»ƒu sai trÃ¡ch nhiá»‡m há»‡ thá»‘ng.

### 4.5 DÃ¹ng Fork Ä‘á»ƒ thá»ƒ hiá»‡n lá»±a chá»n thay vÃ¬ song song
- Dáº¥u hiá»‡u: DÃ¹ng fork node chia thÃ nh cÃ¡c path lá»±a chá»n (chá»n 1 trong 3).
- Há»‡ quáº£: Sai semantics UML (fork = song song), gÃ¢y hiá»ƒu nháº§m logic.

---

## 5. Heuristics review nhanh (Checklist Yes/No)

1. Má»—i action thuá»™c rÃµ 1 trong 4 nhÃ³m (Actor/Use Case/Domain/External)?
2. Action DB/Framework khÃ´ng náº±m trong lane Domain/Actor?
3. Action domain khÃ´ng náº±m trong lane External/Infra?
4. Rule quan trá»ng Ä‘á»u cÃ³ decision node tÆ°Æ¡ng á»©ng?
5. Guard rÃµ rÃ ng, cover Ä‘á»§ case (cÃ³ `else`)?
6. Lane Domain trÃ¡nh tá»« vá»±ng UI?
7. Lane Actor khÃ´ng chá»©a action há»‡ thá»‘ng (LÆ°u DB, Gá»­i mail)?
8. Fork node thá»ƒ hiá»‡n Ä‘Ãºng song song (khÃ´ng dÃ¹ng cho lá»±a chá»n)?
9. Má»i fork cáº§n Ä‘á»“ng bá»™ Ä‘á»u cÃ³ join Ä‘Ãºng chá»—?
10. Má»i luá»“ng Ä‘á»u káº¿t thÃºc táº¡i Final hoáº·c tráº¡ng thÃ¡i xÃ¡c Ä‘á»‹nh?
11. Má»—i node Ä‘á»u trace Ä‘Æ°á»£c vá» Use Case step hoáº·c Business Rule?

---

## 6. VÃ­ dá»¥ before/after (Mermaid)

### 6.1 Before â€“ UIâ€‘driven, DBâ€‘driven
```mermaid
flowchart TD
U1[User click ÄÄƒng bÃ i] --> U2[Hiá»ƒn thá»‹ form bÃ i viáº¿t]
U2 --> U3[User nháº­p tiÃªu Ä‘á», ná»™i dung]
U3 --> U4[User click LÆ°u]
U4 --> DB1[INSERT INTO posts]
DB1 --> End(((End)))
```

### 6.2 After â€“ Ãp dá»¥ng Clean Architecture Lens
```mermaid
flowchart TD
subgraph User
U1[Nháº¥n ÄÄƒng bÃ i]
U2[Nháº­p tiÃªu Ä‘á», ná»™i dung]
U3[Nháº¥n XÃ¡c nháº­n]
end
subgraph Application
A1[Tiáº¿p nháº­n yÃªu cáº§u Ä‘Äƒng bÃ i]
A2{Dá»¯ liá»‡u há»£p lá»‡?}
A3[Khá»Ÿi táº¡o bÃ i viáº¿t nhÃ¡p]
end
subgraph Domain
D1{User cÃ³ quyá»n Ä‘Äƒng bÃ i?}
D2{Quota bÃ i viáº¿t cÃ²n Ä‘á»§?}
end
subgraph External
E1[LÆ°u bÃ i viáº¿t vÃ o DB]
end

U1 --> U2 --> U3 --> A1
A1 --> A2
A2 -- KhÃ´ng há»£p lá»‡ --> U2
A2 -- Há»£p lá»‡ --> D1
D1 -- KhÃ´ng cÃ³ quyá»n --> EndNoPerm(((ThÃ´ng bÃ¡o lá»—i quyá»n)))
D1 -- CÃ³ quyá»n --> D2
D2 -- Háº¿t quota --> EndQuota(((ThÃ´ng bÃ¡o háº¿t quota)))
D2 -- CÃ²n quota --> A3 --> E1 --> End(((ÄÄƒng bÃ i thÃ nh cÃ´ng)))
```
--------------------------------------------------------------------------------
## 7. Traceability rule (context â†’ node)
- Nguá»“n trace: Use Case Specification (Precondition, Basic/Alt/Exception flows), Business Rules.
- NguyÃªn táº¯c:
    + Má»—i step basic flow â†’ Ã­t nháº¥t 1 action node.
    + Má»—i alternative/exception â†’ 1 branch.
    + Má»—i business rule â†’ 1 decision node hoáº·c action domain.

- Gáº¯n trace: Note cáº¡nh node (VD: â€œTrace: UC01.S3, RULE-R1â€).


```

### activity-diagram-design-analyst/resources/activity-diagram-research.md
```md
# Activity Diagram - TÃ i nguyÃªn nghiÃªn cá»©u

> **Nguá»“n**: NotebookLM - https://notebooklm.google.com/notebook/46ddeb54-c391-43df-95f2-53c820428ada
> **NgÃ y táº¡o**: 2026-02-02

---

## 1. LÃ½ thuyáº¿t

### 1.1 KhÃ¡i niá»‡m
**Activity Diagram (Biá»ƒu Ä‘á»“ hoáº¡t Ä‘á»™ng/hÃ nh Ä‘á»™ng)** lÃ  má»™t loáº¡i biá»ƒu Ä‘á»“ thuá»™c nhÃ³m MÃ´ hÃ¬nh hÃ³a hÃ nh vi (Behavioral Modeling) trong UML.

- **Äá»‹nh nghÄ©a**: Biá»ƒu Ä‘á»“ chá»‰ ra dÃ²ng cháº£y cá»§a cÃ¡c hoáº¡t Ä‘á»™ng (flow of activities) hoáº·c quy trÃ¬nh trong há»‡ thá»‘ng.
- **Báº£n cháº¥t**: MÃ´ táº£ trÃ¬nh tá»± cÃ¡c bÆ°á»›c thá»±c hiá»‡n má»™t cÃ´ng viá»‡c tá»« Ä‘iá»ƒm báº¯t Ä‘áº§u Ä‘áº¿n Ä‘iá»ƒm káº¿t thÃºc.

### 1.2 Má»¥c Ä‘Ã­ch sá»­ dá»¥ng
- **MÃ´ táº£ thuáº­t toÃ¡n vÃ  quy trÃ¬nh nghiá»‡p vá»¥**: Chi tiáº¿t hÃ³a cÃ¡c bÆ°á»›c xá»­ lÃ½ bÃªn trong má»™t chá»©c nÄƒng cá»¥ thá»ƒ
- **Thá»ƒ hiá»‡n sá»± tÆ°Æ¡ng tÃ¡c**: LÃ m rÃµ sá»± tÆ°Æ¡ng tÃ¡c giá»¯a ngÆ°á»i dÃ¹ng (Admin/User) vÃ  Há»‡ thá»‘ng qua tá»«ng bÆ°á»›c
- **LÃ m rÃµ cÃ¡c luá»“ng sá»± kiá»‡n**: HÃ¬nh dung cÃ¡c luá»“ng Ä‘i cá»§a dá»¯ liá»‡u vÃ  Ä‘iá»u khiá»ƒn, bao gá»“m cáº£ nhÃ¡nh ráº½

### 1.3 Khi nÃ o dÃ¹ng?
- Trong giai Ä‘oáº¡n PhÃ¢n tÃ­ch vÃ  Thiáº¿t káº¿ há»‡ thá»‘ng
- Sau khi Ä‘Ã£ xÃ¡c Ä‘á»‹nh danh sÃ¡ch Use Case
- Khi cáº§n mÃ´ táº£ chi tiáº¿t ká»‹ch báº£n (Scenario) cá»§a má»™t Use Case phá»©c táº¡p
- Khi cáº§n mÃ´ táº£ quy trÃ¬nh nghiá»‡p vá»¥ (Business Process) cá»§a khÃ¡ch hÃ ng

**VÃ­ dá»¥**: Sau khi xÃ¡c Ä‘á»‹nh Use Case "Quáº£n lÃ½ bÃ i viáº¿t", váº½ Activity Diagram cho: "ThÃªm bÃ i viáº¿t", "Sá»­a bÃ i viáº¿t", "XÃ³a bÃ i viáº¿t"

### 1.4 So sÃ¡nh Activity Diagram vs Flowchart

| Äáº·c Ä‘iá»ƒm | Flowchart | Activity Diagram |
|----------|-----------|------------------|
| **Pháº¡m vi** | Láº­p trÃ¬nh cáº¥u trÃºc, thuáº­t toÃ¡n tuáº§n tá»± | UML (HÆ°á»›ng Ä‘á»‘i tÆ°á»£ng), hÃ nh vi há»‡ thá»‘ng |
| **Kháº£ nÄƒng xá»­ lÃ½** | Chá»§ yáº¿u tuáº§n tá»± | Há»— trá»£ xá»­ lÃ½ song song (Fork/Join) |
| **ThÃ nh pháº§n** | Khá»‘i hÃ¬nh há»c Ä‘Æ¡n giáº£n | CÃ³ Swimlanes, Fork/Join |
| **Chuáº©n hÃ³a** | KhÃ´ng chuáº©n hÃ³a thá»‘ng nháº¥t | Thuá»™c chuáº©n UML |

**Káº¿t luáº­n**: Activity Diagram lÃ  phiÃªn báº£n "nÃ¢ng cáº¥p" vÃ  chuáº©n hÃ³a cá»§a Flowchart.

---

## 2. Cáº¥u trÃºc

### 2.1 CÃ¡c thÃ nh pháº§n cÆ¡ báº£n

```
    â—                          â† Initial Node (Ä‘iá»ƒm báº¯t Ä‘áº§u)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hoáº¡t Ä‘á»™ng 1    â”‚            â† Activity Node (hÃ¬nh chá»¯ nháº­t bo gÃ³c)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â† Control Flow (mÅ©i tÃªn)
         â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                 â† Decision Node (hÃ¬nh thoi)
   /           \
  / [ÄÃºng]      \ [Sai]
 â–¼               â–¼
â”Œâ”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”
â”‚ A  â”‚         â”‚ B  â”‚
â””â”€â”€â”¬â”€â”˜         â””â”€â”€â”¬â”€â”˜
   â”‚              â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
    â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡                 â† Merge Node (hÃ¬nh thoi)
          â”‚
          â–¼
    â”ƒâ”â”â”â”â”â”â”â”â”â”ƒ                 â† Fork Node (thanh Ä‘áº­m)
   /           \
  â–¼             â–¼
â”Œâ”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”
â”‚ C  â”‚       â”‚ D  â”‚             â† Xá»­ lÃ½ song song
â””â”€â”€â”¬â”€â”˜       â””â”€â”€â”¬â”€â”˜
   â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â–¼
    â”ƒâ”â”â”â”â”â”â”â”â”â”ƒ                 â† Join Node (thanh Ä‘áº­m)
          â”‚
          â–¼
        (â—)                     â† Final Node (hÃ¬nh máº¯t bÃ²)
```

### 2.2 KÃ½ hiá»‡u cÃ¡c thÃ nh pháº§n

| ThÃ nh pháº§n | KÃ½ hiá»‡u | MÃ´ táº£ |
|------------|---------|-------|
| **Initial Node** | â— (trÃ²n Ä‘áº·c Ä‘en) | Äiá»ƒm báº¯t Ä‘áº§u quy trÃ¬nh |
| **Activity Node** | â–¢ (chá»¯ nháº­t bo gÃ³c) | Má»™t bÆ°á»›c thá»±c hiá»‡n, hÃ nh Ä‘á»™ng cá»¥ thá»ƒ |
| **Control Flow** | â†’ (mÅ©i tÃªn) | TrÃ¬nh tá»± thá»±c hiá»‡n |
| **Decision Node** | â—‡ (hÃ¬nh thoi, 1 vÃ o nhiá»u ra) | Ráº½ nhÃ¡nh theo Ä‘iá»u kiá»‡n |
| **Merge Node** | â—‡ (hÃ¬nh thoi, nhiá»u vÃ o 1 ra) | Gá»™p cÃ¡c nhÃ¡nh láº¡i |
| **Fork Node** | â”ƒâ”â”â”â”ƒ (thanh Ä‘áº­m, 1 vÃ o nhiá»u ra) | Báº¯t Ä‘áº§u xá»­ lÃ½ song song |
| **Join Node** | â”ƒâ”â”â”â”ƒ (thanh Ä‘áº­m, nhiá»u vÃ o 1 ra) | Káº¿t thÃºc xá»­ lÃ½ song song (Ä‘á»“ng bá»™) |
| **Final Node** | (â—) (trÃ²n Ä‘áº·c trong trÃ²n rá»—ng) | Káº¿t thÃºc quy trÃ¬nh |
| **Swimlanes** | Cá»™t dá»c/hÃ ng ngang | PhÃ¢n chia trÃ¡ch nhiá»‡m |

### 2.3 Guard Conditions (Äiá»u kiá»‡n báº£o vá»‡)

TrÃªn cÃ¡c luá»“ng Ä‘i ra tá»« Decision Node, ghi Ä‘iá»u kiá»‡n trong ngoáº·c vuÃ´ng:
- `[ÄÃºng]` / `[Sai]`
- `[Há»£p lá»‡]` / `[KhÃ´ng há»£p lá»‡]`
- `[OK]` / `[Cancel]`

### 2.4 CÃº phÃ¡p Mermaid

```mermaid
flowchart TD
    %% Initial Node
    Start((Start)) --> A[ÄÄƒng nháº­p]

    %% Decision Node
    A --> B{ThÃ´ng tin Ä‘Ãºng?}

    %% Branching
    B -- ÄÃºng --> C[Truy cáº­p trang chá»§]
    B -- Sai --> D[Hiá»ƒn thá»‹ lá»—i]
    D --> A

    %% Fork (Xá»­ lÃ½ song song)
    C --> Fork(( ))
    Fork --> E[Láº¥y dá»¯ liá»‡u ngÆ°á»i dÃ¹ng]
    Fork --> F[Láº¥y danh sÃ¡ch bÃ i viáº¿t]

    %% Join (Gá»™p song song)
    E --> Join(( ))
    F --> Join

    %% Swimlanes (Sá»­ dá»¥ng Subgraph)
    subgraph System
        E
        F
    end
    subgraph User
        A
    end

    %% Final Node
    Join --> End(((End)))
```

**KÃ½ hiá»‡u Mermaid:**
- `(( ))`: HÃ¬nh trÃ²n (Start/Fork/Join)
- `[ ]`: HÃ¬nh chá»¯ nháº­t (Action)
- `{ }`: HÃ¬nh thoi (Decision)
- `((( )))`: HÃ¬nh trÃ²n Ä‘Ã´i (Final Node)
- `subgraph`: Táº¡o Swimlanes

---

## 3. CÃ¡ch thá»©c xÃ¢y dá»±ng

### 3.1 Quy trÃ¬nh 5 bÆ°á»›c

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 1: XÃ¡c Ä‘á»‹nh pháº¡m vi tá»« Use Case                          â”‚
â”‚  â†“                                                              â”‚
â”‚  BÆ¯á»šC 2: XÃ¡c Ä‘á»‹nh cÃ¡c lÃ n bÆ¡i (Swimlanes)                      â”‚
â”‚  â†“                                                              â”‚
â”‚  BÆ¯á»šC 3: XÃ¡c Ä‘á»‹nh cÃ¡c hoáº¡t Ä‘á»™ng vÃ  luá»“ng Ä‘i chÃ­nh              â”‚
â”‚  â†“                                                              â”‚
â”‚  BÆ¯á»šC 4: XÃ¡c Ä‘á»‹nh Ä‘iá»ƒm quyáº¿t Ä‘á»‹nh vÃ  ráº½ nhÃ¡nh                  â”‚
â”‚  â†“                                                              â”‚
â”‚  BÆ¯á»šC 5: Káº¿t thÃºc quy trÃ¬nh (Final Node)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Chi tiáº¿t tá»«ng bÆ°á»›c

**BÆ°á»›c 1: XÃ¡c Ä‘á»‹nh pháº¡m vi tá»« Use Case**
- Chá»n má»™t Use Case cá»¥ thá»ƒ (VD: "ThÃªm chuyÃªn má»¥c", "ÄÄƒng nháº­p")
- Äá»c ká»¹ Ä‘áº·c táº£ Use Case (ká»‹ch báº£n chÃ­nh vÃ  ngoáº¡i lá»‡)

**BÆ°á»›c 2: XÃ¡c Ä‘á»‹nh Swimlanes**
- XÃ¡c Ä‘á»‹nh cÃ¡c Ä‘á»‘i tÆ°á»£ng tham gia
- ThÆ°á»ng cÃ³ 2 lÃ n chÃ­nh:
  - **NgÆ°á»i dÃ¹ng (User/Admin)**: Nháº­p liá»‡u, báº¥m nÃºt
  - **Há»‡ thá»‘ng (System)**: Kiá»ƒm tra, xá»­ lÃ½, lÆ°u CSDL, hiá»ƒn thá»‹ thÃ´ng bÃ¡o

**BÆ°á»›c 3: XÃ¡c Ä‘á»‹nh hoáº¡t Ä‘á»™ng vÃ  luá»“ng chÃ­nh**
- Chuyá»ƒn Ä‘á»•i cÃ¡c bÆ°á»›c trong Basic Flow thÃ nh Activity Node
- DÃ¹ng mÅ©i tÃªn ná»‘i theo trÃ¬nh tá»± thá»i gian

**BÆ°á»›c 4: XÃ¡c Ä‘á»‹nh Ä‘iá»ƒm quyáº¿t Ä‘á»‹nh**
- TÃ¬m tá»« khÃ³a: "Náº¿u... thÃ¬...", "Kiá»ƒm tra", "XÃ¡c thá»±c"
- Váº½ Decision Node vÃ  cÃ¡c nhÃ¡nh ráº½
- Ghi Guard Conditions trÃªn má»—i nhÃ¡nh

**BÆ°á»›c 5: Káº¿t thÃºc quy trÃ¬nh**
- ÄÃ¡nh dáº¥u Final Node
- Äáº£m báº£o má»i luá»“ng (ká»ƒ cáº£ lá»—i) Ä‘á»u dáº«n Ä‘áº¿n káº¿t thÃºc hoáº·c quay láº¡i hoáº¡t Ä‘á»™ng há»£p lá»‡

### 3.3 Best Practices

| NÃªn lÃ m | KhÃ´ng nÃªn lÃ m |
|---------|---------------|
| Má»™t Use Case - Má»™t Activity Diagram | Nhá»“i nhÃ©t toÃ n bá»™ há»‡ thá»‘ng vÃ o 1 biá»ƒu Ä‘á»“ |
| LuÃ´n cÃ³ Initial Node vÃ  Final Node | Bá» qua Ä‘iá»ƒm báº¯t Ä‘áº§u/káº¿t thÃºc |
| Äáº·t tÃªn Ä‘á»™ng tá»« (VD: "Kiá»ƒm tra Ä‘Äƒng nháº­p") | Äáº·t tÃªn danh tá»« (VD: "Viá»‡c kiá»ƒm tra") |
| Váº½ cáº£ luá»“ng ngoáº¡i lá»‡ (lá»—i) | Chá»‰ váº½ Happy Path |
| Sá»­ dá»¥ng Swimlanes phÃ¢n chia trÃ¡ch nhiá»‡m | Äá»ƒ cÃ¡c hoáº¡t Ä‘á»™ng láº«n lá»™n khÃ´ng rÃµ ai lÃ m |
| Khá»›p vá»›i Use Case Specification | KhÃ´ng Ä‘á»“ng bá»™ vá»›i tÃ i liá»‡u Ä‘áº·c táº£ |

---

## 4. Hoáº¡t Ä‘á»™ng

### 4.1 CÃ¡ch Ä‘á»c tá»«ng thÃ nh pháº§n

| NhÃ¬n tháº¥y | Äá»c lÃ  |
|-----------|--------|
| â— (trÃ²n Ä‘áº·c Ä‘en) | "Quy trÃ¬nh báº¯t Ä‘áº§u táº¡i Ä‘Ã¢y" |
| â–¢ (chá»¯ nháº­t bo gÃ³c) | "Há»‡ thá»‘ng/NgÆ°á»i dÃ¹ng Ä‘ang lÃ m [Ä‘á»™ng tá»«]" |
| â—‡ (hÃ¬nh thoi, 1 vÃ o nhiá»u ra) | "CÃ¢u há»i/Ä‘iá»u kiá»‡n kiá»ƒm tra" |
| â”ƒâ”â”â”â”ƒ (thanh Ä‘áº­m, 1 vÃ o nhiá»u ra) | "Báº¯t Ä‘áº§u lÃ m Ä‘á»“ng thá»i cÃ¡c viá»‡c sau" |
| â”ƒâ”â”â”â”ƒ (thanh Ä‘áº­m, nhiá»u vÃ o 1 ra) | "Chá» táº¥t cáº£ xong má»›i Ä‘i tiáº¿p" |
| (â—) (hÃ¬nh máº¯t bÃ²) | "Quy trÃ¬nh hoÃ n táº¥t" |

### 4.2 CÃ¡ch theo dÃµi luá»“ng

**Luá»“ng Ä‘iá»u khiá»ƒn (Control Flow)**:
- ÄÆ°á»ng liá»n nÃ©t cÃ³ mÅ©i tÃªn
- Äá»c: "LÃ m xong viá»‡c A thÃ¬ chuyá»ƒn sang viá»‡c B"
- Gáº·p Decision: Chá»n má»™t hÆ°á»›ng theo Ä‘iá»u kiá»‡n
- Gáº·p Fork: Theo dÃµi táº¥t cáº£ hÆ°á»›ng cÃ¹ng lÃºc

**Luá»“ng dá»¯ liá»‡u (Data Flow)**:
- Object Node: HÃ¬nh chá»¯ nháº­t gÃ³c vuÃ´ng (VD: `HÃ³a Ä‘Æ¡n [ChÆ°a thanh toÃ¡n]`)
- Object Flow: MÅ©i tÃªn ná»‘i Activity â†” Object
- Äá»c: "Hoáº¡t Ä‘á»™ng A táº¡o ra dá»¯ liá»‡u X, Hoáº¡t Ä‘á»™ng B dÃ¹ng dá»¯ liá»‡u X"

**Theo dÃµi trÃ¡ch nhiá»‡m (Swimlanes)**:
- Xem Activity Node náº±m trong cá»™t/hÃ ng nÃ o
- Äá»c: "NÃºt 'Duyá»‡t bÃ i' trong lÃ n 'Admin' â†’ Admin thá»±c hiá»‡n"

### 4.3 TÃ³m táº¯t cÃ¡ch Ä‘á»c

> "Báº¯t Ä‘áº§u tá»« cháº¥m Ä‘en â†’ Ä‘i theo mÅ©i tÃªn â†’ Ä‘á»ƒ Ã½ lÃ n bÆ¡i Ä‘á»ƒ biáº¿t ai lÃ m â†’ dá»«ng láº¡i suy nghÄ© á»Ÿ hÃ¬nh thoi â†’ cháº¡y song song á»Ÿ thanh Ä‘áº­m â†’ dá»«ng láº¡i á»Ÿ hÃ¬nh máº¯t bÃ²"

---

## 5. ThÃ nh pháº§n cáº¥u thÃ nh

### 5.1 Danh sÃ¡ch Ä‘áº§y Ä‘á»§

| ThÃ nh pháº§n | TÃªn tiáº¿ng Anh | Vai trÃ² |
|------------|---------------|---------|
| **NÃºt khá»Ÿi Ä‘áº§u** | Initial Node | Äiá»ƒm báº¯t Ä‘áº§u quy trÃ¬nh |
| **NÃºt hÃ nh Ä‘á»™ng** | Action/Activity Node | CÃ¡c bÆ°á»›c thá»±c hiá»‡n cÃ´ng viá»‡c |
| **Luá»“ng Ä‘iá»u khiá»ƒn** | Control Flow | ÄÆ°á»ng ná»‘i chá»‰ Ä‘á»‹nh trÃ¬nh tá»± |
| **Luá»“ng Ä‘á»‘i tÆ°á»£ng** | Object Flow | ÄÆ°á»ng ná»‘i chá»‰ Ä‘á»‹nh dÃ²ng cháº£y dá»¯ liá»‡u |
| **NÃºt quyáº¿t Ä‘á»‹nh** | Decision Node | Ráº½ nhÃ¡nh theo Ä‘iá»u kiá»‡n (If/Else) |
| **NÃºt gá»™p** | Merge Node | NÆ¡i cÃ¡c luá»“ng ráº½ nhÃ¡nh gáº·p nhau |
| **NÃºt chia song song** | Fork Node | Báº¯t Ä‘áº§u xá»­ lÃ½ Ä‘a luá»“ng |
| **NÃºt gá»™p song song** | Join Node | Káº¿t thÃºc xá»­ lÃ½ Ä‘a luá»“ng (Ä‘á»“ng bá»™) |
| **LÃ n bÆ¡i** | Swimlanes (Partitions) | PhÃ¢n chia trÃ¡ch nhiá»‡m |
| **NÃºt káº¿t thÃºc** | Activity Final Node | Káº¿t thÃºc toÃ n bá»™ quy trÃ¬nh |
| **NÃºt káº¿t thÃºc luá»“ng** | Flow Final Node | Chá»‰ káº¿t thÃºc má»™t nhÃ¡nh (kÃ½ hiá»‡u: âŠ—) |
| **Ghi chÃº** | Note/Comment | Giáº£i thÃ­ch thÃªm |

### 5.2 Chi tiáº¿t cÃ¡c nÃºt Ä‘áº·c biá»‡t

**Decision Node vs Merge Node**:
```
Decision:  1 vÃ o â†’ nhiá»u ra (cÃ³ Ä‘iá»u kiá»‡n)
Merge:     nhiá»u vÃ o â†’ 1 ra (khÃ´ng cÃ³ Ä‘iá»u kiá»‡n)
```

**Fork Node vs Join Node**:
```
Fork:      1 vÃ o â†’ nhiá»u ra (song song)
Join:      nhiá»u vÃ o â†’ 1 ra (Ä‘á»“ng bá»™ - chá» táº¥t cáº£)
```

**Activity Final vs Flow Final**:
```
Activity Final (â—):  Káº¿t thÃºc TOÃ€N Bá»˜ quy trÃ¬nh
Flow Final (âŠ—):      Chá»‰ káº¿t thÃºc Má»˜T nhÃ¡nh, nhÃ¡nh khÃ¡c váº«n cháº¡y
```

---

## Checklist

- [x] **LÃ½ thuyáº¿t**: cÃ³ khÃ¡i niá»‡m, má»¥c Ä‘Ã­ch, so sÃ¡nh vá»›i Flowchart
- [x] **Cáº¥u trÃºc**: cÃ³ cÃº phÃ¡p/kÃ½ hiá»‡u, cÃ¡c thÃ nh pháº§n, Mermaid
- [x] **CÃ¡ch xÃ¢y dá»±ng**: cÃ³ quy trÃ¬nh 5 bÆ°á»›c vÃ  best practices
- [x] **Hoáº¡t Ä‘á»™ng**: cÃ³ cÃ¡ch Ä‘á»c tá»«ng thÃ nh pháº§n, theo dÃµi luá»“ng
- [x] **ThÃ nh pháº§n**: cÃ³ danh sÃ¡ch Ä‘áº§y Ä‘á»§ cÃ¡c thÃ nh pháº§n

---

*TÃ i liá»‡u Ä‘Æ°á»£c tá»•ng há»£p tá»« NotebookLM vá»›i nguá»“n "MÃ´ hÃ¬nh hÃ³a hÃ nh vi" vÃ  "Äá»“ Ã¡n tá»‘t nghiá»‡p xÃ¢y dá»±ng website"*

```

### activity-diagram-design-analyst/resources/refactor-risk-patterns.md
```md
Vai trÃ²: ThÆ° viá»‡n â€œmáº«u rá»§i roâ€ (risk patterns) Ä‘á»ƒ audit/refactor Activity Diagram trong Mode B, giÃºp phÃ¢n loáº¡i **Critical / Major / Minor** nháº¥t quÃ¡n.

---

## 1. Má»¥c tiÃªu & pháº¡m vi rá»§i ro

### 1.1 Má»¥c tiÃªu
- XÃ¢y dá»±ng **bá»™ tá»« Ä‘iá»ƒn risk** cho Activity Diagram (Control-flow, Decision-logic, Parallelism, Responsibility, Exception).
- MÃ´ táº£: **Dáº¥u hiá»‡u â†’ Há»‡ quáº£ â†’ CÃ¡ch phÃ¡t hiá»‡n â†’ CÃ¡ch refactor**.
- LÃ m cÆ¡ sá»Ÿ cho Mode B (Refactor/Audit) Ä‘á»ƒ phÃ¡t hiá»‡n lá»—i logic vÃ  Ä‘Ã¡nh severity.

### 1.2 Äá»‹nh nghÄ©a â€œriskâ€
- **Risk** = báº¥t ká»³ máº«u nÃ o khiáº¿n luá»“ng khÃ´ng cháº¡y Ä‘Ãºng semantics UML (deadlock, implicit AND sai), dáº«n Ä‘áº¿n hiá»ƒu sai nghiá»‡p vá»¥ hoáº·c implement sai rule.

---

## 2. Taxonomy rá»§i ro

1. **Controlâ€‘flow Risks**: Thiáº¿u Initial/Final, dÃ¹ng Decision/Merge sai semantics, thiáº¿u Merge gÃ¢y "join ngáº§m".
2. **Decisionâ€‘logic Risks**: Guard thiáº¿u `else`, logic quÃ¡ phá»©c táº¡p, guard mÆ¡ há»“ (`[OK]`).
3. **Parallelism Risks**: DÃ¹ng **fork** cho lá»±a chá»n (thay vÃ¬ decision), Join deadlock (chá» token khÃ´ng bao giá» tá»›i).
4. **Responsibility / Swimlane Risks**: Logic domain náº±m sai lane (External/User), khÃ´ng dÃ¹ng swimlane.
5. **Exception & Alternate Flow Risks**: Chá»‰ váº½ happy path, exception khÃ´ng káº¿t thÃºc rÃµ rÃ ng.

---

## 3. Pattern Catalog (Má»—i pattern: dáº¥u hiá»‡u â†’ há»‡ quáº£ â†’ phÃ¡t hiá»‡n â†’ refactor)

### 3.1 Controlâ€‘flow Patterns

#### Pattern CFâ€‘01 â€“ Thiáº¿u Merge sau Decision (Implicit AND)
- **Dáº¥u hiá»‡u**: 2+ nhÃ¡nh tá»« decision cÃ¹ng Ä‘i vÃ o 1 action mÃ  khÃ´ng qua merge node.
- **Há»‡ quáº£**: Action Ä‘á»£i token tá»« táº¥t cáº£ cÃ¡c nhÃ¡nh (Implicit AND) â†’ Deadlock náº¿u logic lÃ  OR.
- **Refactor**: ThÃªm **merge node** gom cÃ¡c nhÃ¡nh trÆ°á»›c khi vÃ o action.

#### Pattern CFâ€‘02 â€“ Thiáº¿u Final Node / Flow Final
- **Dáº¥u hiá»‡u**: Path treo lÆ¡ lá»­ng, khÃ´ng dáº«n tá»›i Final hoáº·c quay láº¡i step rÃµ rÃ ng.
- **Há»‡ quáº£**: KhÃ´ng rÃµ tráº¡ng thÃ¡i káº¿t thÃºc.
- **Refactor**: ThÃªm Activity Final / Flow Final node.

### 3.2 Decisionâ€‘logic Patterns

#### Pattern DLâ€‘01 â€“ Guard khÃ´ng Ä‘áº§y Ä‘á»§ (Missing Else)
- **Dáº¥u hiá»‡u**: Thiáº¿u case `else` hoáº·c cÃ¡c case khÃ´ng cover háº¿t logic.
- **Há»‡ quáº£**: Case thiáº¿u bá»‹ bá» qua khi code.
- **Refactor**: Bá»• sung guard cÃ²n thiáº¿u hoáº·c guard `[else]`.

#### Pattern DLâ€‘02 â€“ Guard mÆ¡ há»“, khÃ´ng domainâ€‘driven
- **Dáº¥u hiá»‡u**: Guard `[OK]`, `[Success]` thay vÃ¬ `[Quota < N]`.
- **Há»‡ quáº£**: KhÃ³ test, khÃ´ng rÃµ rule.
- **Refactor**: Äá»•i tÃªn guard theo ngÃ´n ngá»¯ domain.

### 3.3 Parallelism Patterns

#### Pattern PLâ€‘01 â€“ DÃ¹ng Fork cho â€œchá»n 1 trong Nâ€ (Choice vs Parallel)
- **Dáº¥u hiá»‡u**: DÃ¹ng fork chia 3 nhÃ¡nh cho viá»‡c "chá»n chá»©c nÄƒng".
- **Há»‡ quáº£**: Semantics lÃ  cháº¡y Ä‘á»“ng thá»i 3 chá»©c nÄƒng â†’ Sai nghiá»‡p vá»¥.
- **Refactor**: Thay Fork báº±ng **Decision node**.

#### Pattern PLâ€‘02 â€“ Join chá» token khÃ´ng bao giá» tá»›i (Deadlock)
- **Dáº¥u hiá»‡u**: Join node chá» N incoming, nhÆ°ng logic ráº½ nhÃ¡nh khiáº¿n token khÃ´ng bao giá» Ä‘áº¿n Ä‘á»§.
- **Há»‡ quáº£**: Join Ä‘á»©ng vÄ©nh viá»…n (Deadlock).
- **Refactor**: DÃ¹ng Merge náº¿u lÃ  OR, hoáº·c sá»­a logic flow.

### 3.4 Responsibility / Swimlane Patterns

#### Pattern RSâ€‘01 â€“ Domain logic náº±m trong lane External / User
- **Dáº¥u hiá»‡u**: Lane DB chá»©a action "Kiá»ƒm tra quyá»n".
- **Há»‡ quáº£**: Dev code rule sai táº§ng (Ä‘áº©y vÃ o infra).
- **Refactor**: Chuyá»ƒn action sang lane Application/Domain.

#### Pattern RSâ€‘02 â€“ KhÃ´ng cÃ³ swimlane
- **Dáº¥u hiá»‡u**: Má»i action náº±m cÃ¹ng 1 cá»™t.
- **Refactor**: ThÃªm swimlane (Actor, Use Case, Domain, External) vÃ  phÃ¢n loáº¡i láº¡i.

### 3.5 Exception & Alternate Flow Patterns

#### Pattern EXâ€‘01 â€“ Happy Path only
- **Dáº¥u hiá»‡u**: Chá»‰ váº½ luá»“ng thÃ nh cÃ´ng, bá» qua lá»—i Ä‘Ã£ define trong use case.
- **Refactor**: ThÃªm decision node vÃ  nhÃ¡nh lá»—i.

#### Pattern EXâ€‘02 â€“ Exception flow khÃ´ng káº¿t thÃºc rÃµ rÃ ng
- **Dáº¥u hiá»‡u**: NhÃ¡nh lá»—i quay láº¡i luá»“ng chÃ­nh mÃ  khÃ´ng rÃµ tráº¡ng thÃ¡i (rollback hay chÆ°a).
- **Refactor**: DÃ¹ng Activity Final riÃªng hoáº·c decision retry rÃµ rÃ ng.

---

## 4. Severity Rubric (Critical / Major / Minor)

- **Critical**: GÃ¢y deadlock/sai semantics UML nghiÃªm trá»ng, hoáº·c bá» qua business rule cá»‘t lÃµi (bá» check quyá»n, thanh toÃ¡n).
  - VD: CF-01, PL-02, EX-01 (quan trá»ng).
- **Major**: GÃ¢y hiá»ƒu nháº§m domain, dev dá»… implement sai, sai swimlane.
  - VD: PL-01, RS-01, DL-01.
- **Minor**: áº¢nh hÆ°á»Ÿng readability, naming, layout.
  - VD: DL-02, thiáº¿u flow final (nhÆ°ng logic váº«n hiá»ƒu Ä‘Æ°á»£c).

---

## 5. Clarification Triggers (Khi nÃ o cáº§n há»i láº¡i user?)

1. **Guard mÆ¡ há»“**: `[OK]` nghÄ©a lÃ  gÃ¬? (Quyá»n hay Quota?).
2. **KhÃ´ng rÃµ Parallel vs Choice**: DÃ¹ng fork nhÆ°ng mÃ´ táº£ lÃ  "hoáº·c".
3. **Exception thiáº¿u mÃ´ táº£**: CÃ³ path lá»—i nhÆ°ng khÃ´ng biáº¿t há»‡ thá»‘ng cáº§n lÃ m gÃ¬ (Retry/Rollback?).
4. **Domain rule trong comment**: CÃ³ comment rule nhÆ°ng khÃ´ng cÃ³ node thá»±c thi.
5. **TrÃ¹ng láº·p lane**: KhÃ´ng rÃµ Actor hay System thá»±c hiá»‡n.

-> HÃ nh Ä‘á»™ng: ÄÃ¡nh dáº¥u **[Cáº¦N LÃ€M RÃ•]** vÃ  Ä‘áº·t cÃ¢u há»i.

---

## 6. Refactor Playbook (6 bÆ°á»›c)

1. **Detect**: QuÃ©t node, gÃ¡n label pattern (CF-01, PL-01...).
2. **Assign Severity**: ÄÃ¡nh giÃ¡ Critical/Major/Minor.
3. **Isolate**: Khoanh vÃ¹ng subgraph bá»‹ lá»—i.
4. **Redesign**: Váº½ láº¡i dá»±a trÃªn Use Case spec vÃ  semantics Ä‘Ãºng.
5. **Validate**: SoÃ¡t láº¡i vá»›i requirement vÃ  UML semantics.
6. **Explain**: Ghi láº¡i Before/After vÃ  lÃ½ do sá»­a Ä‘á»ƒ user hiá»ƒu.

---

## 7. VÃ­ dá»¥ thá»±c chiáº¿n Mermaid (Before/After)

### 7.1 Pattern PLâ€‘01 â€“ Fork dÃ¹ng cho lá»±a chá»n
**Before (Sai - Fork):**
```mermaid
flowchart TD
A[Dashboard] --> F((Fork))
F --> M1[TK]
F --> M2[SP]
```

**After (ÄÃºng - Decision):**
```mermaid
flowchart TD
A[Dashboard] --> D{Chá»n chá»©c nÄƒng?}
D -- TÃ i khoáº£n --> M1[Quáº£n lÃ½ TK]
D -- Sáº£n pháº©m --> M2[Quáº£n lÃ½ SP]
```

### 7.2 Pattern CFâ€‘01 â€“ Thiáº¿u Merge sau Decision
**Before (Sai - Implicit AND):** Action P chá» cáº£ E vÃ  D (deadlock).
```mermaid
flowchart TD
S --> D{Valid?}
D -- No --> E
D -- Yes --> P
E --> P
```

**After (ÄÃºng - Merge):** Action P cháº¡y khi 1 trong 2 Ä‘áº¿n.
```mermaid
flowchart TD
S --> D{Valid?}
D -- No --> E
D -- Yes --> M((Merge))
E --> M
M --> P
```

**After (ÄÃºng - Merge):**
```mermaid
flowchart TD
S --> D{Valid?}
D -- No --> E
D -- Yes --> M((Merge))
E --> M
M --> P
```

### 7.3 Pattern EXâ€‘02 â€“ Exception flow rÃµ rÃ ng

**Before (MÆ¡ há»“ sau lá»—i):**
```mermaid
flowchart TD
A[Äá»c config] --> B{ÄÃºng format?}
B -- Sai --> E[Log lá»—i] --> End((End Error))
B -- ÄÃºng --> C[Xá»­ lÃ½ tiáº¿p]
```

**Váº¥n Ä‘á»:** KhÃ´ng rÃµ sau lá»—i thÃ¬ há»‡ thá»‘ng xá»­ lÃ½ tiáº¿p nhÆ° tháº¿ nÃ o.
- CÃ³ dÃ¹ng cáº¥u hÃ¬nh máº·c Ä‘á»‹nh khÃ´ng?
- CÃ³ dá»«ng flow (fail fast) khÃ´ng?

**After A (Tiáº¿p tá»¥c vá»›i cáº¥u hÃ¬nh máº·c Ä‘á»‹nh):**
```mermaid
flowchart TD
  A[Äá»c file cáº¥u hÃ¬nh] --> B{Äá»‹nh dáº¡ng Ä‘Ãºng?}
  B -- Sai --> E[Log lá»—i + dÃ¹ng cáº¥u hÃ¬nh máº·c Ä‘á»‹nh]
  E --> C[Tiáº¿p tá»¥c xá»­ lÃ½ vá»›i cáº¥u hÃ¬nh máº·c Ä‘á»‹nh]
  B -- ÄÃºng --> C
```

**After B (Fail fast khi cáº¥u hÃ¬nh lá»—i):**
```mermaid
flowchart TD
  A[Äá»c file cáº¥u hÃ¬nh] --> B{Äá»‹nh dáº¡ng Ä‘Ãºng?}
  B -- Sai --> E[Log lá»—i + tráº£ vá» mÃ£ lá»—i]
  E --> EndError(((Káº¿t thÃºc vá»›i lá»—i cáº¥u hÃ¬nh)))
  B -- ÄÃºng --> C[Tiáº¿p tá»¥c xá»­ lÃ½ bÃ¬nh thÆ°á»ng]
```

**Rule chá»n hÆ°á»›ng xá»­ lÃ½:**
- Chá»n **After A** náº¿u há»‡ thá»‘ng cho phÃ©p degraded mode vÃ  default config an toÃ n.
- Chá»n **After B** náº¿u cáº¥u hÃ¬nh lÃ  Ä‘iá»u kiá»‡n tiÃªn quyáº¿t Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh Ä‘Ãºng/safe cá»§a nghiá»‡p vá»¥.

```

### activity-diagram-design-analyst/data/severity-matrix.yaml
```yaml
metadata:
  artifact: activity-diagram-severity-matrix
  version: 1.9.0
  generated_date: '2026-02-15'
  loop_tracker:
    start_n: 0
    current_n: 9
    target_n: 9
    status: completed
  companion_rule_set: data/rules.yaml
  execution_proof_runs:
  - run_id: proof-run-20260216-004605
    iteration: 0
    timestamp_utc: '2026-02-15T17:46:05.006857+00:00'
    action: validation-only
  - run_id: proof-run-20260216-004605
    iteration: 1
    timestamp_utc: '2026-02-15T17:46:05.244246+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 2
    timestamp_utc: '2026-02-15T17:46:05.497348+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 3
    timestamp_utc: '2026-02-15T17:46:05.753583+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 4
    timestamp_utc: '2026-02-15T17:46:06.010442+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 5
    timestamp_utc: '2026-02-15T17:46:06.265437+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 6
    timestamp_utc: '2026-02-15T17:46:06.520617+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 7
    timestamp_utc: '2026-02-15T17:46:06.783144+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 8
    timestamp_utc: '2026-02-15T17:46:07.042776+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 9
    timestamp_utc: '2026-02-15T17:46:07.304114+00:00'
    action: metadata-proof-update
severity_levels:
  critical:
    definition: can_break_business_correctness_or_create_deadlock_or_unrecoverable_flow
    score_penalty: 20
    response_sla: immediate_fix_before_approval
    examples:
    - CF-01
    - PL-02
    - EX-01
    - RN-01
  major:
    definition: high_risk_of_wrong_implementation_or_missing_important_behavior
    score_penalty: 10
    response_sla: fix_in_current_iteration_if_scope_allows
    examples:
    - DL-01
    - PL-01
    - RS-01
    - RS-02
    - EX-02
    - CA-01
    - RN-02
    - RN-03
    - RN-04
    - RN-05
  minor:
    definition: readability_or_modeling_quality_issue_with_lower_immediate_operational_impact
    score_penalty: 4
    response_sla: fix_or_document_as_deferred_with_reason
    examples:
    - DL-02
    - CA-02
escalation_rules:
- id: ESC-01
  condition: same_rule_reappears_in_2_consecutive_refactor_cycles
  escalate_to: one_level_higher
  rationale: repeated_issue_indicates_systemic_gap
- id: ESC-02
  condition: major_issue_affects_core_business_rule_auth_payment_permission_quota
  escalate_to: critical
  rationale: business_safety_priority
- id: ESC-03
  condition: multiple_minor_issues_over_5_in_single_diagram
  escalate_to: major
  rationale: cumulative_clarity_debt_impacts_implementation
- id: ESC-04
  condition: missing_required_node_check_with_id_RN-06_or_RN-07
  escalate_to: critical
  rationale: merge_join_errors_can_deadlock
quality_score_model:
  max_score: 100
  formula: score = 100 - (critical_count*20) - (major_count*10) - (minor_count*4)
  floor: 0
  quality_bands:
  - band: excellent
    range: 90-100
    guidance: ready_for_builder_with_minimal_changes
  - band: acceptable
    range: 75-89
    guidance: proceed_with_targeted_fixes
  - band: risky
    range: 60-74
    guidance: major_refactor_recommended_before_builder
  - band: blocked
    range: 0-59
    guidance: redesign_required_before_proceeding
required_nodes_policy:
  RN-01: critical
  RN-02: major
  RN-03: major
  RN-04: major
  RN-05: major
  RN-06: critical
  RN-07: critical
review_gate:
  pass_conditions:
  - critical_count_equals_0
  - all_required_nodes_policy_checks_pass
  - unresolved_clarification_questions_less_than_or_equal_3
  fail_conditions:
  - critical_count_greater_than_0
  - missing_required_nodes_include_RN-01_or_RN-06_or_RN-07
  - evidence_trace_coverage_below_80_percent

```

### activity-diagram-design-analyst/data/rules.yaml
```yaml
metadata:
  artifact: activity-diagram-rule-set
  version: 1.9.0
  owner: activity-diagram-design-analyst
  generated_date: '2026-02-15'
  loop_tracker:
    start_n: 0
    current_n: 9
    target_n: 9
    status: completed
  source_of_truth:
  - resources/activity-diagram-research.md
  - resources/clean-architecture-notes.md
  - resources/refactor-risk-patterns.md
  execution_proof_runs:
  - run_id: proof-run-20260216-004605
    iteration: 0
    timestamp_utc: '2026-02-15T17:46:05.006857+00:00'
    action: validation-only
  - run_id: proof-run-20260216-004605
    iteration: 1
    timestamp_utc: '2026-02-15T17:46:05.244246+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 2
    timestamp_utc: '2026-02-15T17:46:05.497348+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 3
    timestamp_utc: '2026-02-15T17:46:05.753583+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 4
    timestamp_utc: '2026-02-15T17:46:06.010442+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 5
    timestamp_utc: '2026-02-15T17:46:06.265437+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 6
    timestamp_utc: '2026-02-15T17:46:06.520617+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 7
    timestamp_utc: '2026-02-15T17:46:06.783144+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 8
    timestamp_utc: '2026-02-15T17:46:07.042776+00:00'
    action: metadata-proof-update
  - run_id: proof-run-20260216-004605
    iteration: 9
    timestamp_utc: '2026-02-15T17:46:07.304114+00:00'
    action: metadata-proof-update
schema_contract:
  required_rule_fields:
  - id
  - category
  - title
  - applicable_modes
  - severity_default
  - detect_if
  - evidence_required
  - message
  - suggestion
  - trace_sources
  allowed_categories:
  - control_flow
  - decision_logic
  - parallelism
  - responsibility
  - exception_flow
  - clean_architecture
  allowed_severity:
  - critical
  - major
  - minor
required_nodes_checks:
- id: RN-01
  node_type: initial_node
  required: true
  severity_if_missing: critical
  check_logic: diagram_must_have_at_least_one_explicit_start
  trace_sources:
  - resources/activity-diagram-research.md#2.2
- id: RN-02
  node_type: final_node
  required: true
  severity_if_missing: major
  check_logic: all_primary_paths_must_reach_final_or_defined_terminal_state
  trace_sources:
  - resources/activity-diagram-research.md#3.2
- id: RN-03
  node_type: decision_guards
  required: true
  severity_if_missing: major
  check_logic: each_decision_outgoing_branch_must_define_guard_condition_or_else
  trace_sources:
  - resources/activity-diagram-research.md#2.3
- id: RN-04
  node_type: exception_or_alternative_path
  required: true
  severity_if_missing: major
  check_logic: use_case_with_validation_or_failure_must_show_error_or_retry_path
  trace_sources:
  - resources/activity-diagram-research.md#3.3
  - resources/refactor-risk-patterns.md#3.5
- id: RN-05
  node_type: swimlane_partition
  required: true
  severity_if_missing: major
  check_logic: actor_application_domain_external_responsibility_should_be_partitioned
  trace_sources:
  - resources/clean-architecture-notes.md#3.1
  - resources/activity-diagram-research.md#2.2
- id: RN-06
  node_type: merge_after_or_decision
  required: conditional
  severity_if_missing: critical
  check_logic: if_branches_are_or_semantics_and_converge_then_explicit_merge_is_required
  trace_sources:
  - resources/refactor-risk-patterns.md#3.1
- id: RN-07
  node_type: join_after_parallel_fork
  required: conditional
  severity_if_missing: critical
  check_logic: synchronized_parallel_flows_started_by_fork_must_have_join_or_terminal_policy
  trace_sources:
  - resources/activity-diagram-research.md#2.1
  - resources/refactor-risk-patterns.md#3.3
rules:
- id: CF-01
  category: control_flow
  title: missing_merge_after_decision_creates_implicit_and
  applicable_modes:
  - A
  - B
  severity_default: critical
  detect_if: two_or_more_decision_branches_merge_directly_into_one_action_without_merge_node
  evidence_required:
  - decision_node_with_multiple_outgoing_branches
  - converged_action_without_merge
  message: Converged branches without merge can imply AND token waiting and deadlock
    risk.
  suggestion: Insert explicit merge node before converged action when business semantics
    are OR.
  trace_sources:
  - resources/refactor-risk-patterns.md#3.1
- id: CF-02
  category: control_flow
  title: no_explicit_terminal_state_for_primary_or_error_paths
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: one_or_more_paths_end_without_final_node_or_defined_terminal_policy
  evidence_required:
  - path_without_terminal
  message: Path termination is ambiguous and implementers cannot infer expected end
    state.
  suggestion: Add final_node or explicit retry/fallback/end_error terminal.
  trace_sources:
  - resources/activity-diagram-research.md#3.2
  - resources/refactor-risk-patterns.md#3.1
- id: DL-01
  category: decision_logic
  title: decision_guards_not_exhaustive
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: decision_branch_guards_do_not_cover_else_case_or_leave_unhandled_condition
  evidence_required:
  - decision_node
  - incomplete_guard_set
  message: Non-exhaustive guards cause hidden branches and implementation ambiguity.
  suggestion: Add else branch or complete condition coverage aligned to business rules.
  trace_sources:
  - resources/refactor-risk-patterns.md#3.2
  - resources/activity-diagram-research.md#2.3
- id: DL-02
  category: decision_logic
  title: guard_names_are_ambiguous_not_domain_driven
  applicable_modes:
  - A
  - B
  severity_default: minor
  detect_if: guard_uses_generic_terms_like_ok_success_without_business_condition
  evidence_required:
  - guard_text
  message: Generic guard names reduce traceability to business policy.
  suggestion: Rename guards with domain constraints, e.g. has_permission, quota_available.
  trace_sources:
  - resources/refactor-risk-patterns.md#3.2
  - resources/clean-architecture-notes.md#3.2
- id: PL-01
  category: parallelism
  title: fork_used_for_choice_instead_of_parallel_execution
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: fork_splits_into_branches_where_requirement_describes_choose_one_path
  evidence_required:
  - fork_node
  - textual_requirement_indicates_choice
  message: Fork semantics imply concurrent execution, not mutually exclusive choice.
  suggestion: Replace fork with decision node and guarded branches.
  trace_sources:
  - resources/refactor-risk-patterns.md#3.3
  - resources/activity-diagram-research.md#2.1
- id: PL-02
  category: parallelism
  title: join_waits_for_unreachable_tokens
  applicable_modes:
  - B
  severity_default: critical
  detect_if: join_requires_multiple_inputs_but_upstream_flow_can_only_deliver_subset_tokens
  evidence_required:
  - join_node
  - branch_reachability_analysis
  message: Join deadlock risk due to unreachable synchronization path.
  suggestion: Replace with merge for OR semantics or redesign upstream branching.
  trace_sources:
  - resources/refactor-risk-patterns.md#3.3
- id: RS-01
  category: responsibility
  title: domain_rule_placed_in_external_or_actor_lane
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: permission_or_quota_or_business_validation_logic_exists_in_actor_or_external_lane
  evidence_required:
  - swimlane_partition
  - action_to_lane_mapping
  message: Responsibility leakage breaks clean architecture separation.
  suggestion: Move business rule evaluation to domain or application lane.
  trace_sources:
  - resources/clean-architecture-notes.md#3.1
  - resources/refactor-risk-patterns.md#3.4
- id: RS-02
  category: responsibility
  title: missing_swimlane_partition_for_key_actors
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: diagram_has_actions_without_clear_actor_application_domain_external_partition
  evidence_required:
  - action_list_without_lane_ownership
  message: Missing swimlane partition obscures accountability and handoff boundaries.
  suggestion: Introduce swimlanes for actor, application, domain, and external systems.
  trace_sources:
  - resources/activity-diagram-research.md#2.2
  - resources/clean-architecture-notes.md#3.1
- id: RS-03
  category: clean_architecture
  title: ui_or_persistence_driven_flow_overrides_business_use_case
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: flow_steps_are_dominated_by_ui_actions_or_db_commands_without_explicit_use_case_or_domain_rules
  evidence_required:
  - action_name_distribution
  - missing_domain_decisions
  message: Flow is implementation-driven, not business-use-case-driven.
  suggestion: Reframe flow around use-case orchestration and domain rule checkpoints.
  trace_sources:
  - resources/clean-architecture-notes.md#4
- id: EX-01
  category: exception_flow
  title: happy_path_only_without_defined_error_paths
  applicable_modes:
  - A
  - B
  severity_default: critical
  detect_if: requirement_contains_validation_or_failure_cases_but_diagram_has_only_success_path
  evidence_required:
  - use_case_alternative_or_exception_section
  - no_error_branch_in_diagram
  message: Missing exception handling can omit critical operational behavior.
  suggestion: Add explicit error branches with retry, fallback, or failure terminal.
  trace_sources:
  - resources/activity-diagram-research.md#3.3
  - resources/refactor-risk-patterns.md#3.5
- id: EX-02
  category: exception_flow
  title: exception_branch_has_unclear_post_error_policy
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: error_branch_logs_error_but_no_clear_decision_on_default_continue_or_fail_fast
  evidence_required:
  - exception_branch
  - missing_post_error_policy
  message: Error branch behavior is ambiguous after fault event.
  suggestion: 'Define explicit policy: continue_with_safe_default or fail_fast_terminal.'
  trace_sources:
  - resources/refactor-risk-patterns.md#7.3
- id: CA-01
  category: clean_architecture
  title: business_rule_not_traceable_to_context
  applicable_modes:
  - A
  - B
  severity_default: major
  detect_if: decision_or_action_has_no_trace_to_use_case_step_or_business_rule_identifier
  evidence_required:
  - context_document
  - node_without_trace
  message: Untraceable logic increases risk of accidental requirement drift.
  suggestion: Attach trace tags from context to business-critical nodes.
  trace_sources:
  - resources/clean-architecture-notes.md#7
- id: CA-02
  category: clean_architecture
  title: technical_detail_leaks_into_domain_lane
  applicable_modes:
  - A
  - B
  severity_default: minor
  detect_if: domain_lane_contains_framework_or_storage_specific_action_naming
  evidence_required:
  - domain_lane_actions
  message: Technical implementation details leak into domain narrative.
  suggestion: Rename domain actions to business intent and move infra details to external
    lane.
  trace_sources:
  - resources/clean-architecture-notes.md#4.2
review_protocol:
  when_confidence_below_threshold:
    threshold: 0.7
    action: ask_user_for_clarification
  mandatory_output_sections:
  - mermaid_diagram
  - findings_by_severity
  - assumptions_and_open_questions
  - clean_architecture_guidance

```

### sequence-design-analyst/design.md
```md
# sequence-design-analyst â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-17
> Status: ï¿½ COMPLETED

---

## 1. Problem Statement

Viá»‡c thiáº¿t káº¿ Sequence Diagram (sÆ¡ Ä‘á»“ tuáº§n tá»±) thÆ°á»ng gáº·p khÃ³ khÄƒn do thiáº¿u sá»± káº¿t ná»‘i cháº·t cháº½ giá»¯a yÃªu cáº§u nghiá»‡p vá»¥ thÃ´ vÃ  logic thá»±c thi trong codebase. CÃ¡c sÆ¡ Ä‘á»“ do AI táº¡o ra thÆ°á»ng bá»‹ thiáº¿u há»¥t cÃ¡c thÃ nh pháº§n lifeline (Actor, Service, DB) hoáº·c khÃ´ng mÃ´ táº£ chÃ­nh xÃ¡c thá»© tá»± message flow. Steve cáº§n má»™t giáº£i phÃ¡p chuyÃªn biá»‡t cÃ³ kháº£ nÄƒng tá»± tá»•ng há»£p tá»« tÃ i liá»‡u hÆ°á»›ng dáº«n (context1.md), nghiÃªn cá»©u thá»±c táº¿ codebase vÃ  thiáº¿t káº¿ sÆ¡ Ä‘á»“ chuáº©n UML (Mermaid).

## 2. Capability Map

### 2.1 Tri thuc (Knowledge)
- **UML Standards**: Hiá»ƒu sÃ¢u vá» Lifelines, Synchronous/Asynchronous Messages, vÃ  cÃ¡c Fragments (`alt`, `opt`, `loop`, `ref`).
- **Mermaid Specialist**: ThÃ nh tháº¡o cÃº phÃ¡p Mermaid mÃ£ nguá»“n má»Ÿ Ä‘á»ƒ sinh sÆ¡ Ä‘á»“ cháº¥t lÆ°á»£ng cao.
- **Domain Context**: Kháº£ nÄƒng Ä‘á»c hiá»ƒu kiáº¿n trÃºc dá»± Ã¡n (React/Next.js frontend & PayloadCMS backend).

### 2.2 Quy trinh (Process)
1.  **Scenario Discovery**: PhÃ¢n tÃ­ch ká»‹ch báº£n tá»« input ngÆ°á»i dÃ¹ng vÃ  tÃ i liá»‡u `context1.md`.
2.  **Codebase Research**: QuÃ©t codebase Ä‘á»ƒ xÃ¡c Ä‘á»‹nh chÃ­nh xÃ¡c cÃ¡c lá»›p/hÃ m tham gia vÃ o luá»“ng.
3.  **Traceability Analysis**: XÃ¢y dá»±ng chuá»—i tÆ°Æ¡ng tÃ¡c (chá»‰ rÃµ ai gá»i ai, tham sá»‘ lÃ  gÃ¬).
4.  **Drafting & Refinement**: Sinh code Mermaid vÃ  tá»‘i Æ°u hÃ³a vá»‹ trÃ­ cÃ¡c lifelines báº£n váº½.
5.  **Quality Assurance**: Kiá»ƒm tra chÃ©o vá»›i Checklist trÆ°á»›c khi bÃ n giao.

### 2.3 Kiem soat (Guardrails)
- **Code-First Truth**: Chá»‰ váº½ nhá»¯ng gÃ¬ thá»±c sá»± tá»“n táº¡i hoáº·c Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong yÃªu cáº§u thiáº¿t káº¿.
- **Readability Limit**: Cáº£nh bÃ¡o ngÆ°á»i dÃ¹ng náº¿u sÆ¡ Ä‘á»“ vÆ°á»£t quÃ¡ má»©c Ä‘á»™ phá»©c táº¡p cho phÃ©p (quÃ¡ nhiá»u lifelines hoáº·c nested fragments).
- **Naming Consistency**: Äáº£m báº£o tÃªn Actor/Object khá»›p 100% vá»›i codebase.

## 3. Zone Mapping

| Zone | Noi dung | Bat buoc? |
|------|----------|----------|
| Core (SKILL.md) | `SKILL.md`: Äiá»u phá»‘i 5 pha: Collect, Research, Design, Generate, Verify. | âœ… |
| Knowledge | Chá»©a `knowledge/uml-rules.md`, `knowledge/project-patterns.md`, vÃ  `knowledge/sequence-preparation.md`. | âœ… |
| Scripts | (Optional) script phÃ¢n tÃ­ch call stack Ä‘Æ¡n giáº£n. | âŒ |
| Templates | Máº«u Mermaid: `templates/crud-flow.mmd`, `templates/auth-flow.mmd`, `templates/logic-flow.mmd`. | âœ… |
| Data | Cáº¥u hÃ¬nh theme/styling cho sÆ¡ Ä‘á»“. | âŒ |
| Loop | `loop/checklist.md`, `loop/verify-script.py`, vÃ  `loop/test-cases/index.md`. | âœ… |
| Assets | N/A | âŒ |

## 4. Folder Structure

```mermaid
mindmap
  root((sequence-design-analyst))
    SKILL.md
      Persona: Senior UML Architect
      Phases: Scenario, Research, Design, Verify
    knowledge
      uml-rules.md
      project-patterns.md
      sequence-preparation.md
    templates
      crud-flow.mmd
      auth-flow.mmd
      logic-flow.mmd
    loop
      checklist.md
      verify-script.py
      test-cases/index.md
```

## 5. Execution Flow

```mermaid
sequenceDiagram
    participant U as Steve (User)
    participant A as Analyst Skill
    participant C as Codebase
    participant K as Knowledge Zone
    participant L as Loop Zone

    U->>A: Input Scenario / Requirements
    A->>A: Read SKILL.md & context1.md
    A->>C: Search for actual logic (grep/view_file)
    A->>K: Reference UML & Project standards
    A->>A: Construct Message Objects
    A->>L: Verify against checklist.md
    alt Is Valid
        A->>U: Final Mermaid Code + Context Summary
    else Missing Info
        A-->>U: Request Clarification (Interaction Point)
    end
```

## 6. Interaction Points

| # | Thoi diem | Ly do |
|---|-----------|-------|
| 1 | Sau khi Scenario Discovery | XÃ¡c nháº­n ká»‹ch báº£n (Scenario) vÃ  danh sÃ¡ch Actor/Lifelines chÃ­nh xÃ¡c. |
| 2 | Sau khi Codebase Research | XÃ¡c nháº­n luá»“ng cÃ¡c phÆ°Æ¡ng thá»©c (Method calls) Ä‘Ã£ Ä‘Ãºng vá»›i thá»±c táº¿ codebase. |
| 3 | TrÆ°á»›c khi Generate Final | XÃ¡c nháº­n phÆ°Æ¡ng Ã¡n xá»­ lÃ½ cÃ¡c nhÃ¡nh `alt` phá»©c táº¡p. |

## 7. Progressive Disclosure Plan

### Tang 1: Bat buoc doc (Mandatory)
- `SKILL.md`: Linh há»“n Ä‘iá»u hÆ°á»›ng Agent.
- `knowledge/uml-rules.md`: Bá»™ quy táº¯c váº½ chuáº©n.
- `loop/checklist.md`: RÃ o cháº¯n cháº¥t lÆ°á»£ng.

### Tang 2: Tu quyet dinh (Conditional)
- `knowledge/project-patterns.md`: Äá»c khi cáº§n hiá»ƒu cÃ¡ch gá»i Local API cá»§a dá»± Ã¡n.
- `templates/*.mmd`: Sá»­ dá»¥ng khi sinh output cá»¥ thá»ƒ.
- `loop/verify-script.py`: Cháº¡y khi cáº§n tháº©m Ä‘á»‹nh logic phá»©c táº¡p.

## 8. Risks & Blind Spots

<!-- AI thuong sai o dau voi loai cong viec nay? Co rui ro gi? -->

| # | Risk | Mitigation |
|---|------|------------|
| 1 | AI váº½ sai logic thá»±c táº¿ do codebase phá»©c táº¡p. | Báº¯t buá»™c AI pháº£i dÃ¹ng `grep/view_file` trÆ°á»›c khi váº½. |
| 2 | SÆ¡ Ä‘á»“ Mermaid quÃ¡ dÃ i gÃ¢y lá»—i render hoáº·c khÃ³ Ä‘á»c. | Quy táº¯c chia nhá» sÆ¡ Ä‘á»“ (Sub-sequences) náº¿u lifelines > 8. |
| 3 | Thiáº¿u cÃ¡c trÆ°á»ng há»£p ngoáº¡i lá»‡ (Edge cases). | Checklist báº¯t buá»™c pháº£i cÃ³ Ã­t nháº¥t 1 block `alt` cho luá»“ng lá»—i. |

## 9. Open Questions

| # | Cau hoi | Trang thai |
|---|---------|-----------|
| 1 | CÃ³ cáº§n bá»• sung script tá»± Ä‘á»™ng export áº£nh tá»« Mermaid khÃ´ng? | âŒ KhÃ´ng cáº§n |
| 2 | Skill cÃ³ nÃªn kiÃªm luÃ´n viá»‡c gá»£i Ã½ Refactor code sau khi váº½ khÃ´ng? | âŒ KhÃ´ng cáº§n |

## 10. Metadata

- **Skill Name**: sequence-design-analyst
- **Created**: 2026-02-17
- **Author**: Skill Architect (TÃ­t dá»… thÆ°Æ¡ng ğŸŒ¸)
- **Framework**: architect.md v2.0
- **Status**: ğŸš€ APPROVED (Ready for Planning)

```

### sequence-design-analyst/build-log.md
```md
# Build Log â€” sequence-design-analyst

## Resource Inventory
- `design.md`: Critical
- `todo.md`: Critical
- `resources/context1.md`: Critical
- `resources/uml-rules.md`: Critical
- `resources/project-patterns.md`: Critical

## Resource Usage Matrix

| Resource File | Priority | Used In Task | Output File(s) | Notes |
|---|---|---|---|---|
| `resources/uml-rules.md` | Critical | Phase 1.3 | `knowledge/uml-rules.md` | Transformed 100% with all Mermaid examples and logic fragments. |
| `resources/project-patterns.md` | Critical | Phase 1.4 | `knowledge/project-patterns.md` | Transformed 100% with 3 Mermaid diagrams (Auth, Query, Write). |
| `resources/context1.md` | Critical | Phase 1.5 | `knowledge/sequence-preparation.md` | Transformed 100% to guide scenario analysis. |
| `design.md` | Critical | Phase 2.1 | `SKILL.md` | Source of truth for Persona, Phases, and Guardrails. |
| `todo.md` | Critical | All Phases | - | Steering the implementation workflow. |

## Fidelity Confirmation
- **Knowledge Zone**: 100% of technical rules, Mermaid diagrams, and patterns from `resources/` have been transformed into `knowledge/`. Verified against Fidelity Standard (G9).
- **Templates**: Skeletons match UML standards defined in `uml-rules.md` perfectly.
- **Naming**: Consistently used kebab-case for files and Senior UML Architect persona.

## Validation Result
- **Placeholder Density**: 0 (Normal).
- **Structure Check**: 7-Zone mapping satisfied.
- **Gatekeeper Check**: SKILL.md enforces layer order (No skip DB).

ğŸš€ **Status: DELIVERED**


## Validation Result (2026-02-17 20:18:57)
- **Final Status**: PASS
- **Errors**: 0
- **Warnings**: 0

```

### sequence-design-analyst/todo.md
```md
# implementation-plan â€” sequence-design-analyst
> Status: ğŸš€ DELIVERED (Finalized)

## 1. Pre-requisites

| # | Knowledge/Resource | Tier | Purpose | Trace | Status |
|---|-------------------|------|---------|-------|--------|
| 1 | `resources/context1.md` | Domain | Cung cáº¥p hÆ°á»›ng dáº«n chuáº©n vá» Sequence Diagram | [Tá»ª AUDIT TÃ€I NGUYÃŠN] | âœ… |
| 2 | UML Sequence Standards | Domain | Tri thá»©c vá» Lifelines, Synchronous Messages, alt/loop/opt fragments | [Tá»ª DESIGN Â§2.1] | âœ… |
| 3 | Mermaid Syntax v11.4+ | Technical | CÃº phÃ¡p Ä‘á»ƒ sinh sÆ¡ Ä‘á»“ chÃ­nh xÃ¡c | [Tá»ª DESIGN Â§2.1] | âœ… |
| 4 | Project Logic Patterns | Domain | CÃ¡ch cÃ¡c lá»›p Controller/Service/Repo tÆ°Æ¡ng tÃ¡c trong dá»± Ã¡n | [Tá»ª DESIGN Â§2.1] | âœ… |

## 2. Phase Breakdown

### Phase 1: Resource Preparation & Knowledge Base
- [x] Soáº¡n tháº£o tÃ i liá»‡u chuáº©n UML chuyÃªn sÃ¢u táº¡i `resources/uml-rules.md` (bao gá»“m rules vá» fragments). [Tá»ª AUDIT TÃ€I NGUYÃŠN]
- [x] Thu tháº­p vÃ  soáº¡n tháº£o tÃ i liá»‡u `resources/project-patterns.md` mÃ´ táº£ cÃ¡ch gá»i Local API vÃ  cáº¥u trÃºc MVC cá»§a dá»± Ã¡n. [Tá»ª AUDIT TÃ€I NGUYÃŠN]
- [x] Chuyá»ƒn Ä‘á»•i (Transform) `resources/uml-rules.md` thÃ nh `knowledge/uml-rules.md` trong skill package. [Tá»ª DESIGN Â§4]
- [x] Chuyá»ƒn Ä‘á»•i (Transform) `resources/project-patterns.md` thÃ nh `knowledge/project-patterns.md`. [Tá»ª DESIGN Â§4]

### Phase 2: Core Implementation
- [x] Implement `SKILL.md` vá»›i Ä‘áº§y Ä‘á»§ Persona: "Senior UML Architect", 5 Phases thá»±c thi, vÃ  cÃ¡c Guardrails vá» Ä‘á»™ Ä‘á»c (Readability Limit). [Tá»ª DESIGN Â§3, Â§4, Â§8]
- [x] Cáº¥u táº¡o (Configure) há»‡ thá»‘ng Progressive Disclosure: Tier 1 (Mandatory) vÃ  Tier 2 (Conditional). [Tá»ª DESIGN Â§7]

### Phase 3: Templates & Automation
- [x] Táº¡o file `templates/crud-flow.mmd` lÃ m máº«u cho cÃ¡c luá»“ng xá»­ lÃ½ dá»¯ liá»‡u. [Tá»ª DESIGN Â§4]
- [x] Táº¡o file `templates/auth-flow.mmd` lÃ m máº«u cho cÃ¡c luá»“ng xÃ¡c thá»±c/phÃ¢n quyá»n. [Tá»ª DESIGN Â§4]
- [x] Táº¡o file `templates/logic-flow.mmd` lÃ m máº«u cho logic phá»©c táº¡p nhiá»u ráº½ nhÃ¡nh. [Tá»ª DESIGN Â§4]

### Phase 4: Quality Control (Loop)
- [x] Triá»ƒn khai `loop/checklist.md` vá»›i Ã­t nháº¥t 10 tiÃªu chÃ­ kiá»ƒm tra (Traceability, Fragments, Naming Consistency). [Tá»ª DESIGN Â§4, Â§8]
- [x] Implement `loop/verify-script.py` (Python) Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a viá»‡c kiá»ƒm tra sá»± tá»“n táº¡i cá»§a cÃ¡c lifelines trong codebase thá»±c táº¿. [Tá»ª DESIGN Â§4, Â§8]
- [x] XÃ¢y dá»±ng bá»™ Test Cases máº«u táº¡i `loop/test-cases/` bao gá»“m: Luá»“ng Ä‘Äƒng nháº­p, Luá»“ng thanh toÃ¡n, Luá»“ng CRUD sáº£n pháº©m. [Gá»¢I Ã Bá»” SUNG]

## 3. Knowledge & Resources Needed

| Resource Name | Source | Use In |
|---------------|--------|--------|
| sequence-design-analyst/design.md | `.skill-context/` | ToÃ n bá»™ quÃ¡ trÃ¬nh |
| context1.md | `resources/` | Phase 1 |
| Mermaid Official Docs | External | Phase 3 |

## 4. Definition of Done

- [x] `SKILL.md` hoáº¡t Ä‘á»™ng Ä‘Ãºng theo 5 pha Ä‘Ã£ thiáº¿t káº¿.
- [x] Má»i kiáº¿n thá»©c tá»« `resources/` Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i triá»‡t Ä‘á»ƒ vÃ o `knowledge/`.
- [x] CÃ³ Ã­t nháº¥t 3 templates Mermaid hoáº¡t Ä‘á»™ng tá»‘t.
- [x] Há»‡ thá»‘ng Loop (`checklist.md`) cÃ³ kháº£ nÄƒng phÃ¡t hiá»‡n lá»—i Logic áº£o giÃ¡c (Hallucination).
- [x] ÄÃ£ kiá»ƒm tra chÃ©o (Verify) 100% cÃ¡c task vá»›i `design.md`.

## 5. Notes

- **[ÄÃƒ XÃC NHáº¬N]**: KhÃ´ng tÃ­ch há»£p script export áº£nh tá»« Mermaid (Æ°u tiÃªn code Mermaid thuáº§n).
- **[ÄÃƒ XÃC NHáº¬N]**: Chá»©c nÄƒng Refactor code náº±m ngoÃ i pháº¡m vi cá»§a skill nÃ y.
- **[Gá»¢I Ã Bá»” SUNG]**: CÃ¡c test case trong `loop/test-cases/` cáº§n bao phá»§ cáº£ luá»“ng thÃ nh cÃ´ng (Happy Path) vÃ  luá»“ng lá»—i (Edge Cases) Ä‘á»ƒ kiá»ƒm tra tÃ­nh chÃ­nh xÃ¡c cá»§a cÃ¡c block `alt` trong Mermaid.

```

### sequence-design-analyst/resources/context1.md
```md

Äá»ƒ váº½ Ä‘Æ°á»£c **Sequence Diagram** (sÆ¡ Ä‘á»“ tuáº§n tá»±) cho má»™t chá»©c nÄƒng, cáº§n chuáº©n bá»‹ Ä‘á»§ cÃ¡c thÃ´ng tin sau (theo Ä‘Ãºng cÃ¡ch lÃ m chuáº©n trong UML vÃ  cÃ¡c hÆ°á»›ng dáº«n thá»±c hÃ nh).[](https://creately.com/guides/sequence-diagram-tutorial/)

---

## 1. XÃ¡c Ä‘á»‹nh rÃµ ká»‹ch báº£n (scenario) / use case

Sequence Diagram luÃ´n váº½ **cho má»™t ká»‹ch báº£n cá»¥ thá»ƒ** (main flow hoáº·c 1 nhÃ¡nh ngoáº¡i lá»‡) chá»© khÃ´ng váº½ chung chung.

Cáº§n cÃ³:

* TÃªn use case hoáº·c chá»©c nÄƒng: vÃ­ dá»¥ â€œÄÄƒng nháº­p há»‡ thá»‘ngâ€, â€œÄáº·t hÃ ng onlineâ€, â€œRÃºt tiá»n ATMâ€â€¦
* Má»¥c tiÃªu cá»§a use case: ngÆ°á»i dÃ¹ng / há»‡ thá»‘ng muá»‘n Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u gÃ¬ sau khi káº¿t thÃºc ká»‹ch báº£n.
* Ká»‹ch báº£n mÃ´ táº£ báº±ng lá»i (text) tá»«ng bÆ°á»›c:
  * VÃ­ dá»¥:
    1. NgÆ°á»i dÃ¹ng nháº­p username/password.
    2. Há»‡ thá»‘ng kiá»ƒm tra thÃ´ng tin Ä‘Äƒng nháº­p.
    3. Náº¿u Ä‘Ãºng, há»‡ thá»‘ng chuyá»ƒn sang mÃ n hÃ¬nh chÃ­nh; náº¿u sai, bÃ¡o lá»—iâ€¦

Náº¿u chÆ°a cÃ³ **use case description** hoáº·c luá»“ng bÆ°á»›c rÃµ rÃ ng, ráº¥t khÃ³ váº½ sequence diagram chÃ­nh xÃ¡c.[](https://www.geeksforgeeks.org/system-design/unified-modeling-language-uml-sequence-diagrams/)

---

## 2. Danh sÃ¡ch cÃ¡c â€œngÆ°á»i chÆ¡iâ€: Actor vÃ  Ä‘á»‘i tÆ°á»£ng / lá»›p tham gia

TrÆ°á»›c khi váº½, pháº£i liá»‡t kÃª Ä‘Æ°á»£c **nhá»¯ng thÃ nh pháº§n nÃ o tÆ°Æ¡ng tÃ¡c vá»›i nhau** trong ká»‹ch báº£n:

* CÃ¡c **actor** (tÃ¡c nhÃ¢n bÃªn ngoÃ i):
  * NgÆ°á»i dÃ¹ng (User, Admin, NhÃ¢n viÃªn, KhÃ¡ch hÃ ngâ€¦), há»‡ thá»‘ng bÃªn ngoÃ i (Payment Gateway, Email Service, API bÃªn thá»© 3â€¦).
* CÃ¡c  **Ä‘á»‘i tÆ°á»£ng / lá»›p / thÃ nh pháº§n há»‡ thá»‘ng** :
  * MÃ n hÃ¬nh / UI (LoginForm, CheckoutPageâ€¦),
  * Controller (AuthController, OrderControllerâ€¦),
  * Service (UserService, OrderServiceâ€¦),
  * Repository/DAO (UserRepository, OrderRepositoryâ€¦),
  * CSDL hoáº·c há»‡ thá»‘ng lÆ°u trá»¯ (Database, FileStorageâ€¦).

ThÃ´ng tin cáº§n cÃ³:

* TÃªn rÃµ rÃ ng cho tá»«ng actor vÃ  Ä‘á»‘i tÆ°á»£ng.
* Vai trÃ² / trÃ¡ch nhiá»‡m chÃ­nh cá»§a tá»«ng thÃ nh pháº§n trong ká»‹ch báº£n.

Tá»« Ä‘Ã¢y, khi váº½ sáº½ tÆ°Æ¡ng á»©ng vá»›i **cÃ¡c lifeline** cá»§a sequence diagram.[](https://www.visual-paradigm.com/learning/handbooks/software-design-handbook/sequence-diagram.jsp)

---

## 3. Thá»© tá»± cÃ¡c bÆ°á»›c tÆ°Æ¡ng tÃ¡c (message flow) giá»¯a cÃ¡c thÃ nh pháº§n

ÄÃ¢y lÃ  pháº§n quan trá»ng nháº¥t:  **ai gá»i ai, gá»i cÃ¡i gÃ¬, theo thá»© tá»± nÃ o** .

Cáº§n lÃ m rÃµ:

* Báº¯t Ä‘áº§u tá»« actor nÃ o gá»­i request Ä‘áº§u tiÃªn cho há»‡ thá»‘ng?
* Há»‡ thá»‘ng (thÃ nh pháº§n A) sau Ä‘Ã³ gá»i thÃ nh pháº§n B, rá»“i B gá»i Câ€¦ theo thá»© tá»± ra sao?
* á» má»—i bÆ°á»›c, **ná»™i dung message** lÃ  gÃ¬:
  * TÃªn hÃ m / phÆ°Æ¡ng thá»©c (login(), validateCredentials(), saveOrder(), sendEmail()â€¦)
  * Tham sá»‘ quan trá»ng (username, password, orderId, amount, â€¦) â€“ khÃ´ng nháº¥t thiáº¿t pháº£i ghi háº¿t chi tiáº¿t, nhÆ°ng nÃªn cÃ³ tÃªn dá»… hiá»ƒu.
* Nhá»¯ng bÆ°á»›c nÃ o lÃ   **gá»­i request** , bÆ°á»›c nÃ o lÃ   **tráº£ vá» káº¿t quáº£ (return)** .

Náº¿u cÃ³ mÃ´ táº£ use case dáº¡ng tá»«ng bÆ°á»›c (Step 1, Step 2, â€¦) thÃ¬ cÃ³ thá»ƒ chuyá»ƒn tá»«ng bÆ°á»›c Ä‘Ã³ thÃ nh má»™t hoáº·c vÃ i message trong Sequence Diagram.[](https://creately.com/guides/sequence-diagram-tutorial/)

---

## 4. Äiá»u kiá»‡n ráº½ nhÃ¡nh, láº·p, luá»“ng thay tháº¿

Sequence Diagram khÃ´ng chá»‰ cÃ³ flow tháº³ng, mÃ  cÃ²n mÃ´ táº£ **if/else, loop, luá»“ng ngoáº¡i lá»‡** báº±ng cÃ¡c *interaction fragments* (alt, opt, loop, â€¦).

Cáº§n chuáº©n bá»‹:

* CÃ¡c **Ä‘iá»u kiá»‡n** cÃ³ thá»ƒ xáº£y ra trong ká»‹ch báº£n:
  * VÃ­ dá»¥: â€œNáº¿u máº­t kháº©u saiâ€, â€œNáº¿u sá»‘ dÆ° khÃ´ng Ä‘á»§â€, â€œNáº¿u validate tháº¥t báº¡iâ€â€¦
* CÃ¡c  **nhÃ¡nh xá»­ lÃ½ tÆ°Æ¡ng á»©ng** :
  * Vá»›i má»—i Ä‘iá»u kiá»‡n, há»‡ thá»‘ng sáº½ gá»­i/nháº­n nhá»¯ng message khÃ¡c gÃ¬ so vá»›i luá»“ng chÃ­nh.
* CÃ¡c **vÃ²ng láº·p** (loop):
  * VÃ­ dá»¥: láº·p qua danh sÃ¡ch sáº£n pháº©m trong giá» hÃ ng, láº·p gá»­i thÃ´ng bÃ¡o cho nhiá»u ngÆ°á»iâ€¦

ThÃ´ng tin nÃ y giÃºp sá»­ dá»¥ng Ä‘Ãºng cÃ¡c khung `alt`, `opt`, `loop`â€¦ trong Sequence Diagram.[](https://www.drawio.com/blog/sequence-diagrams)

---

## 5. Thá»i Ä‘iá»ƒm táº¡o / há»§y Ä‘á»‘i tÆ°á»£ng (náº¿u cÃ³)

Trong má»™t sá»‘ ká»‹ch báº£n:

* CÃ³ Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c **táº¡o má»›i** trong quÃ¡ trÃ¬nh xá»­ lÃ½ (vÃ­ dá»¥ táº¡o Ä‘á»‘i tÆ°á»£ng `Order`, `Session`, `Cart`â€¦).
* CÃ³ Ä‘á»‘i tÆ°á»£ng bá»‹  **há»§y / káº¿t thÃºc** .

Cáº§n biáº¿t:

* á» bÆ°á»›c nÃ o Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c táº¡o ra (ai táº¡o nÃ³, báº±ng message nÃ o).
* Khi nÃ o Ä‘á»‘i tÆ°á»£ng khÃ´ng cÃ²n tá»“n táº¡i / bá»‹ há»§y.

ThÃ´ng tin nÃ y sáº½ thá»ƒ hiá»‡n báº±ng mÅ©i tÃªn táº¡o Ä‘á»‘i tÆ°á»£ng vÃ  dáº¥u â€œXâ€ há»§y lifeline trong sÆ¡ Ä‘á»“.[](https://www.visual-paradigm.com/learning/handbooks/software-design-handbook/sequence-diagram.jsp)

---

## 6. Ranh giá»›i há»‡ thá»‘ng vÃ  má»©c Ä‘á»™ chi tiáº¿t

TrÆ°á»›c khi váº½, nÃªn xÃ¡c Ä‘á»‹nh:

* **Äang váº½ Sequence Diagram cho má»©c nÃ o?**
  * System Sequence Diagram (SSD): chá»‰ giá»¯a  **Actor â†” Há»‡ thá»‘ng nhÆ° má»™t khá»‘i** .
  * Design-level Sequence Diagram: chi tiáº¿t Ä‘áº¿n **UI, Controller, Service, Repositoryâ€¦**
* Má»©c chi tiáº¿t nÃ y quyáº¿t Ä‘á»‹nh:
  * CÃ³ cáº§n váº½ message tá»›i tá»«ng lá»›p bÃªn trong, hay chá»‰ tá»›i â€œSystemâ€?
  * CÃ³ cáº§n ghi Ä‘áº§y Ä‘á»§ tham sá»‘, kiá»ƒu tráº£ vá» khÃ´ng, hay chá»‰ ghi tÃªn action Ä‘Æ¡n giáº£n?

Náº¿u khÃ´ng quyáº¿t Ä‘á»‹nh rÃµ, sÆ¡ Ä‘á»“ ráº¥t dá»… bá»‹  **quÃ¡ rá»‘i hoáº·c quÃ¡ sÆ¡ sÃ i** .

---

## 7. TÃ³m táº¯t: cáº§n nhá»¯ng gÃ¬ Ä‘á»ƒ váº½ Ä‘Æ°á»£c Sequence Diagram?

TÃ³m gá»n láº¡i, trÆ°á»›c khi cáº§m bÃºt (hoáº·c tool) váº½ Sequence Diagram, nÃªn Ä‘áº£m báº£o cÃ³:

1. **Use case / ká»‹ch báº£n cá»¥ thá»ƒ** (main flow hoáº·c 1 luá»“ng phá»¥), mÃ´ táº£ báº±ng lá»i.
2. **Danh sÃ¡ch actor vÃ  cÃ¡c Ä‘á»‘i tÆ°á»£ng/lá»›p tham gia** , vá»›i vai trÃ² rÃµ rÃ ng.
3. **Thá»© tá»± cÃ¡c bÆ°á»›c tÆ°Æ¡ng tÃ¡c** giá»¯a cÃ¡c thÃ nh pháº§n (ai gá»i ai, gá»i phÆ°Æ¡ng thá»©c gÃ¬).
4. **Äiá»u kiá»‡n ráº½ nhÃ¡nh, láº·p, luá»“ng ngoáº¡i lá»‡** náº¿u muá»‘n mÃ´ táº£ khÃ´ng chá»‰ happy path.
5. (TÃ¹y má»©c chi tiáº¿t) ThÃ´ng tin vá»  **táº¡o / há»§y Ä‘á»‘i tÆ°á»£ng** , vÃ  má»©c Ä‘á»™ chi tiáº¿t mong muá»‘n (SSD hay chi tiáº¿t á»Ÿ má»©c thiáº¿t káº¿).

Khi cÃ³ Ä‘á»§ cÃ¡c thÃ´ng tin nÃ y, viá»‡c váº½ Sequence Diagram chá»‰ cÃ²n lÃ   **chuyá»ƒn tá»« chá»¯ sang hÃ¬nh** :

* Má»—i actor/Ä‘á»‘i tÆ°á»£ng â†’ má»™t lifeline á»Ÿ trÃªn.
* Má»—i bÆ°á»›c trong ká»‹ch báº£n â†’ má»™t hoáº·c vÃ i message theo thá»© tá»± tá»« trÃªn xuá»‘ng.
* CÃ¡c Ä‘iá»u kiá»‡n / láº·p â†’ khung alt/opt/loop tÆ°Æ¡ng á»©ng.

```

### sequence-design-analyst/resources/project-patterns.md
```md
# Project Architecture & Patterns

> **Má»¥c Ä‘Ã­ch**: GiÃºp AI hiá»ƒu "báº£n Ä‘á»“" kiáº¿n trÃºc vÃ  luá»“ng logic cá»§a dá»± Ã¡n Next.js + PayloadCMS Ä‘á»ƒ váº½ Sequence Diagram Ä‘Ãºng lá»›p, Ä‘Ãºng hÆ°á»›ng call.

---

## 1. Core Architecture

### 1.1 Tech Stack & Runtime

- **Frontend / SSR**: Next.js 15 (App Router) cháº¡y trÃªn Node runtime.
  - Sá»­ dá»¥ng Server Components, Route Handlers vÃ /hoáº·c Server Actions cho cÃ¡c luá»“ng cáº§n truy cáº­p Payload Local API.
- **Backend / CMS**: PayloadCMS 3.0 cháº¡y cÃ¹ng process vá»›i Next.js nhÆ° má»™t monolith.
- **Database**: MongoDB (theo quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc chung cá»§a dá»± Ã¡n).

### 1.2 API Style â€“ Local API First

- **Local API** (Primary):
  - Sá»­ dá»¥ng helper `getPayload` Ä‘á»ƒ láº¥y instance Payload trong mÃ´i trÆ°á»ng Node.
  - Chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng **trÃªn server** (Route Handler, Server Component, Server Action), khÃ´ng dÃ¹ng trá»±c tiáº¿p trÃªn client component.
  - CÃ¡c phÆ°Æ¡ng thá»©c chÃ­nh:
    - `payload.find({ collection, where, limit, sort })`
    - `payload.findByID({ collection, id })`
    - `payload.create({ collection, data })`
    - `payload.update({ collection, id, data })`

- **REST API** (Fallback / Integration):
  - Khi cáº§n gá»i tá»« client-side hoáº·c tá»« há»‡ thá»‘ng bÃªn ngoÃ i, sá»­ dá»¥ng REST endpoints chuáº©n cá»§a Payload thay vÃ¬ Local API.

**Guardrail cho Sequence**: Khi váº½ sÆ¡ Ä‘á»“, luÃ´n thá»ƒ hiá»‡n luá»“ng Data Access Ä‘i qua **Payload Local API hoáº·c REST API**, khÃ´ng bao giá» cho UI/Service nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i Database.

---

## 2. Sequence Layers (Thá»© tá»± tham gia cá»§a cÃ¡c lá»›p)

### 2.1 Chuá»—i lá»›p chuáº©n

Thá»© tá»± tham gia chuáº©n trong cÃ¡c Sequence Diagram cá»§a dá»± Ã¡n:

1. **Actor (User / External System)**
   - NgÆ°á»i dÃ¹ng web, mobile, hoáº·c há»‡ thá»‘ng tÃ­ch há»£p (Payment Gateway, OAuth Provider).

2. **UI Component / Screen (Next.js App Router)**
   - Page / Layout / Client Component chá»‹u trÃ¡ch nhiá»‡m:
     - Nháº­n input tá»« user.
     - Gá»­i request tá»›i Route Handler / Server Action / Service.

3. **Service Layer (Domain / Application Services)**
   - Viáº¿t báº±ng TypeScript, náº±m trong thÆ° má»¥c kiá»ƒu `src/services/` hoáº·c `src/features/**/services`.
   - Äáº£m nhiá»‡m:
     - Ãnh xáº¡ input tá»« UI thÃ nh lá»‡nh domain.
     - Gá»i Payload Local API thÃ´ng qua cÃ¡c hÃ m helper (vÃ­ dá»¥: `postService.findMany`, `authService.login`).

4. **Payload Local API (Data Access via getPayload)**
   - HÃ m helper kiá»ƒu:
     ```ts
     import { getPayload } from 'payload';
     import config from '@/payload.config';

     export const getPayloadClient = async () => {
       // caching instance Ä‘á»ƒ trÃ¡nh táº¡o láº¡i nhiá»u láº§n
       // ...
     };
     ```
   - Service layer gá»i `payload.find`, `payload.findByID`, `payload.create`, v.v. táº¡i Ä‘Ã¢y.

5. **Database / External Systems**
   - MongoDB Ä‘á»©ng phÃ­a sau Payload.
   - CÃ¡c há»‡ thá»‘ng khÃ¡c (Redis, 3rd-party API) náº¿u cÃ³ sáº½ luÃ´n Ä‘Æ°á»£c wrap bá»Ÿi má»™t service/adapter phÃ­a Payload hoáº·c service layer.

### 2.2 Quy táº¯c khi váº½ Sequence

- KhÃ´ng váº½ Actor / UI gá»i Database trá»±c tiáº¿p; luÃ´n chÃ¨n Service layer vÃ  Payload Local API.
- TÃªn lifeline nÃªn pháº£n Ã¡nh Ä‘Ãºng layer, vÃ­ dá»¥:
  - `actor User`
  - `participant PostPage`
  - `participant PostService`
  - `participant Payload`
  - `participant MongoDB`

---

## 3. Common Logic Flows

### 3.1 Auth Flow (Login / Token / Session)

**Má»¥c tiÃªu**: Chuáº©n hÃ³a cÃ¡ch thá»ƒ hiá»‡n logic xÃ¡c thá»±c khi váº½ Sequence Diagram.

**Luá»“ng tá»•ng quÃ¡t (login báº±ng email/password):**

1. `User` nháº­p credential trÃªn UI (Login Page).
2. `LoginPage` gá»­i request tá»›i `AuthRoute` hoáº·c `AuthService` (Route Handler / Server Action).
3. `AuthService` sá»­ dá»¥ng `getPayload` Ä‘á»ƒ láº¥y client vÃ  gá»i:
   ```ts
   payload.login({
     collection: 'users',
     data: { email, password },
   })
   ```
   (hoáº·c pattern tÆ°Æ¡ng Ä‘Æ°Æ¡ng náº¿u dÃ¹ng collection auth cá»§a Payload).
4. Payload xÃ¡c thá»±c user, tráº£ vá» user + token / session info.
5. `AuthService`:
   - Ghi session (HTTP-only cookie / session store).
   - Tráº£ káº¿t quáº£ vá» cho UI (success / error).
6. UI hiá»ƒn thá»‹ mÃ n hÃ¬nh tiáº¿p theo (dashboard) hoáº·c thÃ´ng bÃ¡o lá»—i.

**CÃ¡c Ä‘iá»ƒm cáº§n thá»ƒ hiá»‡n rÃµ trong Sequence Diagram:**

- NhÃ¡nh `alt` cho:
  - `login success`
  - `invalid credentials`
  - (tÃ¹y chá»n) `user locked` / `email not verified`
- `opt` block cho cÃ¡c hÃ nh Ä‘á»™ng tÃ¹y chá»n:
  - Ghi audit log login.
  - Gá»­i email Ä‘Äƒng nháº­p má»›i.
- KhÃ´ng váº½ UI â†’ Database, mÃ  lÃ :
  - `User ->> LoginPage ->> AuthService ->> Payload ->> MongoDB`.

**VÃ­ dá»¥ Sequence Diagram â€“ Auth Flow:**

```mermaid
sequenceDiagram
  actor User
  participant LoginPage
  participant AuthService
  participant Payload
  participant MongoDB

  User ->> LoginPage: submitLoginForm(email, password)
  activate LoginPage
  LoginPage ->> AuthService: login(email, password)
  activate AuthService
  AuthService ->> Payload: payload.login({ collection: 'users', data })
  activate Payload
  Payload ->> MongoDB: findOne({ email })
  activate MongoDB
  MongoDB -->> Payload: UserRecord | null
  deactivate MongoDB

  alt login success
      Payload -->> AuthService: { user, token }
      deactivate Payload
      AuthService ->> AuthService: setSessionCookie(token)
      AuthService -->> LoginPage: { success: true, user }
      LoginPage -->> User: redirectToDashboard()
      opt ghi audit log
          AuthService -->> Payload: payload.create({ collection: 'auditLogs', data })
      end
  else invalid credentials
      Payload -->> AuthService: AuthError("Invalid credentials")
      deactivate Payload
      AuthService -->> LoginPage: { success: false, error }
      LoginPage -->> User: showError("Sai email hoáº·c máº­t kháº©u")
  else user locked
      Payload -->> AuthService: AuthError("Account locked")
      deactivate Payload
      AuthService -->> LoginPage: { success: false, error }
      LoginPage -->> User: showError("TÃ i khoáº£n bá»‹ khÃ³a")
  end

  deactivate AuthService
  deactivate LoginPage
```

---

### 3.2 Data Query Flow (Payload find / findByID)

**Pattern chuáº©n Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u trong Next.js qua Payload Local API:**

1. **UI / Route Handler gá»i Service:**
   - VÃ­ dá»¥: `PostPage` gá»i `PostService.getFeed({ page, pageSize })`.

2. **Service Layer xá»­ lÃ½ business logic:**
   - Chuáº©n hÃ³a input (phÃ¢n trang, filter).
   - Quyáº¿t Ä‘á»‹nh collection nÃ o, Ä‘iá»u kiá»‡n `where`, `sort`, `limit`.

3. **Service gá»i Payload Local API:**
   ```ts
   const payload = await getPayloadClient();

   const result = await payload.find({
     collection: 'posts',
     where: { published: { equals: true } },
     limit: 20,
     sort: '-publishedAt',
   });
   ```

4. **Payload truy váº¥n Database vÃ  tráº£ vá» result:**
   - `docs` (máº£ng record), `totalDocs`, `page`, `hasNextPage`, v.v.

5. **Service mapping dá»¯ liá»‡u vá» DTO:**
   - Chá»‰ expose field cáº§n thiáº¿t cho UI (áº©n field nháº¡y cáº£m).
   - CÃ³ thá»ƒ chuáº©n hÃ³a sang TypeScript DTO (Data Transfer Object).

6. **UI render káº¿t quáº£:**
   - Server Component nháº­n data, render HTML.
   - Client Component chá»‰ nháº­n dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c chuáº©n hÃ³a.

**Quy táº¯c khi váº½ Sequence:**

- Luá»“ng cÆ¡ báº£n:
  `User ->> UI ->> Service ->> Payload ->> DB -->> Payload -->> Service -->> UI -->> User`.
- Náº¿u chá»‰ cáº§n Ä‘á»c dá»¯ liá»‡u (read-only), khÃ´ng cáº§n váº½ thÃªm Repo riÃªng náº¿u Ä‘Ã£ thá»ƒ hiá»‡n Payload Ä‘á»§ rÃµ.
- Náº¿u dÃ¹ng DTO pattern, cÃ³ thá»ƒ thÃªm lifeline `PostMapper` hoáº·c ghi rÃµ mapping trong note.

**VÃ­ dá»¥ Sequence Diagram â€“ Data Query Flow:**

```mermaid
sequenceDiagram
  actor User
  participant PostPage
  participant PostService
  participant Payload
  participant MongoDB

  User ->> PostPage: loadFeedPage(page, pageSize)
  activate PostPage
  PostPage ->> PostService: getFeed({ page, pageSize })
  activate PostService
  PostService ->> Payload: payload.find({ collection: 'posts', where, limit, sort })
  activate Payload
  Payload ->> MongoDB: query({ published: true }, sort: -publishedAt)
  activate MongoDB
  MongoDB -->> Payload: { docs[], totalDocs, hasNextPage }
  deactivate MongoDB
  Payload -->> PostService: PaginatedResult<Post>
  deactivate Payload
  Note over PostService: Map sang PostDTO, áº©n field nháº¡y cáº£m
  PostService -->> PostPage: PostDTO[]
  deactivate PostService
  PostPage -->> User: renderFeed(PostDTO[])
  deactivate PostPage
```

---

### 3.3 Write / Update Flow (Create / Update via Payload)

**ThÃ­ch há»£p cho cÃ¡c use case:** táº¡o post má»›i, cáº­p nháº­t profile, táº¡o order.

1. `User` submit form táº¡i UI.
2. UI gá»i Service / Route Handler vá»›i payload form.
3. Service validate vÃ  chuáº©n hÃ³a data.
4. Service dÃ¹ng Payload Local API:
   ```ts
   const newPost = await payload.create({
     collection: 'posts',
     data: { title, content, author: userId },
   });
   ```
   hoáº·c:
   ```ts
   const updatedPost = await payload.update({
     collection: 'posts',
     id,
     data: { title, content },
   });
   ```
5. Payload ghi dá»¯ liá»‡u xuá»‘ng DB, cháº¡y hooks (beforeValidate, beforeChange, afterChange, v.v.).
6. Service tráº£ káº¿t quáº£ cho UI; UI hiá»ƒn thá»‹ thÃ´ng bÃ¡o / redirect.

**Sequence nÃªn thá»ƒ hiá»‡n:**

- `alt` cho:
  - `validation success` vs `validation fail`.
  - `DB error` náº¿u cáº§n mÃ´ táº£ luá»“ng lá»—i.
- `opt` cho:
  - Gá»­i notification, index search, background jobs.

**VÃ­ dá»¥ Sequence Diagram â€“ Write / Update Flow:**

```mermaid
sequenceDiagram
  actor User
  participant PostEditor
  participant PostService
  participant Payload
  participant MongoDB

  User ->> PostEditor: submitPostForm(title, content)
  activate PostEditor
  PostEditor ->> PostService: createPost({ title, content, authorId })
  activate PostService
  PostService ->> PostService: validateInput(data)

  alt validation success
      PostService ->> Payload: payload.create({ collection: 'posts', data })
      activate Payload
      Payload ->> MongoDB: insertOne(postData)
      activate MongoDB
      MongoDB -->> Payload: insertedDoc
      deactivate MongoDB
      Note over Payload: Cháº¡y hooks: beforeChange, afterChange
      Payload -->> PostService: Post
      deactivate Payload
      PostService -->> PostEditor: { success: true, post }
      PostEditor -->> User: redirectToPost(post.id)
      opt gá»­i notification
          PostService -->> Payload: payload.create({ collection: 'notifications', data })
      end
  else validation fail
      PostService -->> PostEditor: { success: false, errors }
      PostEditor -->> User: showValidationErrors(errors)
  else DB error
      Payload -->> PostService: DatabaseError
      PostService -->> PostEditor: { success: false, error: "Lá»—i há»‡ thá»‘ng" }
      PostEditor -->> User: showError("KhÃ´ng thá»ƒ táº¡o bÃ i viáº¿t")
  end

  deactivate PostService
  deactivate PostEditor
```

---

## 4. Guardrails for Sequence in This Project

ÄÃ¢y lÃ  cÃ¡c "luáº­t cá»©ng" khi váº½ Sequence Diagram cho codebase Next.js + Payload nÃ y.

- **KhÃ´ng váº½ trá»±c tiáº¿p vÃ o Database**
  - Má»i thao tÃ¡c Ä‘á»c/ghi CSDL pháº£i Ä‘i qua **Payload Local API** (hoáº·c REST API trong trÆ°á»ng há»£p Ä‘áº·c biá»‡t).

- **TÃ´n trá»ng Layer Order**
  - Actor â†’ UI â†’ Service Layer â†’ Payload Local API â†’ Database.
  - KhÃ´ng bá» qua Service Layer Ä‘á»ƒ UI gá»i Payload trá»±c tiáº¿p, trá»« cÃ¡c use case ká»¹ thuáº­t Ä‘Æ¡n giáº£n vÃ  Ä‘Ã£ Ä‘Æ°á»£c cháº¥p thuáº­n.

- **TÃªn Service khá»›p file `.service.ts`**
  - Náº¿u trong code cÃ³ `post.service.ts`, thÃ¬ trong sÆ¡ Ä‘á»“ nÃªn dÃ¹ng `PostService` thay vÃ¬ tÃªn tÃ¹y Ã½ khÃ¡c.

- **Auth luÃ´n qua Auth Service / Auth Collection**
  - KhÃ´ng váº½ UI gá»i tháº³ng `payload.find(users)` Ä‘á»ƒ login; pháº£i qua `AuthService` / collection auth cá»§a Payload.

- **Sequence Diagram bÃ¡m sÃ¡t use case tháº­t**
  - Má»—i sÆ¡ Ä‘á»“ pháº£i gáº¯n vá»›i má»™t scenario cá»¥ thá»ƒ (login, load feed, create postâ€¦), khÃ´ng váº½ sÆ¡ Ä‘á»“ "tá»•ng há»£p" quÃ¡ nhiá»u use case.

- **KhÃ´ng mÃ´ táº£ logic ngoÃ i pháº¡m vi dá»± Ã¡n**
  - Náº¿u cÃ³ tÃ­ch há»£p 3rd-party, chá»‰ mÃ´ táº£ tá»›i má»©c cáº§n thiáº¿t (vÃ­ dá»¥: `PaymentGateway`) mÃ  khÃ´ng Ä‘i sÃ¢u vÃ o ná»™i bá»™ há»‡ thá»‘ng Ä‘Ã³.

---

## 5. Naming Conventions Tham Kháº£o Nhanh

| Layer              | Lifeline Mermaid           | VÃ­ dá»¥ file thá»±c táº¿               |
|--------------------|----------------------------|----------------------------------|
| Actor              | `actor User`               | â€”                                |
| UI / Page          | `participant PostPage`     | `app/(frontend)/posts/page.tsx`  |
| Route Handler      | `participant PostRoute`    | `app/api/posts/route.ts`         |
| Service            | `participant PostService`  | `src/services/post.service.ts`   |
| Payload Local API  | `participant Payload`      | `src/lib/payload.ts`             |
| Database           | `participant MongoDB`      | MongoDB Atlas / local instance   |
| External System    | `participant PaymentGW`    | Stripe, VNPay, v.v.              |
```

### sequence-design-analyst/resources/uml-rules.md
```md
# UML Sequence Standards (Mermaid)

> **Má»¥c Ä‘Ã­ch**: Chuáº©n hÃ³a cÃ¡ch suy nghÄ© vÃ  cÃº phÃ¡p khi váº½ Sequence Diagram báº±ng Mermaid cho toÃ n bá»™ dá»± Ã¡n.

---

## 1. Syntax Basics

### 1.1 Lifelines (Participants & Actors)

- **Actor (ngÆ°á»i dÃ¹ng / há»‡ thá»‘ng ngoÃ i)**
  - DÃ¹ng cÃº phÃ¡p Mermaid: `actor User` hoáº·c `actor Admin` Ä‘á»ƒ biá»ƒu diá»…n tÃ¡c nhÃ¢n bÃªn ngoÃ i.
  - Actor thÆ°á»ng náº±m ngoÃ i cÃ¹ng bÃªn trÃ¡i sÆ¡ Ä‘á»“ (User) hoáº·c ngoÃ i cÃ¹ng bÃªn pháº£i (cÃ¡c há»‡ thá»‘ng tÃ­ch há»£p nhÆ° Payment Gateway).

- **Participants (thÃ nh pháº§n há»‡ thá»‘ng)**
  - DÃ¹ng cÃº phÃ¡p: `participant LoginPage`, `participant AuthController`, `participant UserService`, `participant DB`.
  - Thá»© tá»± khuyáº¿n nghá»‹ tá»« trÃ¡i sang pháº£i:
    1. Actor (User / External System)
    2. UI / Screen (Next.js page / React component)
    3. Controller / Route handler (Next.js route, server action)
    4. Service layer (TypeScript service / use case)
    5. Repository / Payload Local API
    6. Database / External infra (MongoDB, Redis, 3rd-party API)

### 1.2 Message Types

- **Synchronous call (gá»i Ä‘á»“ng bá»™)**
  - CÃº phÃ¡p Mermaid: `A ->> B: methodName(params)`
  - DÃ¹ng cho cÃ¡c lá»i gá»i hÃ m / phÆ°Æ¡ng thá»©c mÃ  caller **chá»** káº¿t quáº£ (vÃ­ dá»¥: `Controller ->> Service: loginUser(email, password)`).

- **Asynchronous call (gá»­i event / message)**
  - CÃº phÃ¡p Mermaid: `A -->> B: eventName`
  - DÃ¹ng cho cÃ¡c hÃ nh Ä‘á»™ng fire-and-forget, vÃ­ dá»¥ publish event, gá»­i message queue, cron job, webhooks.

- **Return message (tráº£ káº¿t quáº£)**
  - CÃº phÃ¡p khuyáº¿n nghá»‹: `B -->> A: result / status` trong Mermaid.
  - Chá»‰ váº½ return khi:
    - Káº¿t quáº£ quan trá»ng cho nhÃ¡nh ráº½ (success/fail).
    - Cáº§n nháº¥n máº¡nh data Ä‘Æ°á»£c tráº£ vá» (vÃ­ dá»¥: `User`, `AccessToken`, `Error`).

### 1.3 Notes vÃ  Annotation

- Sá»­ dá»¥ng cÃº phÃ¡p Mermaid cho ghi chÃº:
  - `Note over A: short note`
  - `Note left of A: ...` hoáº·c `Note right of A: ...`
- DÃ¹ng note Ä‘á»ƒ:
  - Giáº£i thÃ­ch business rule quan trá»ng.
  - Link tá»›i tÃ i liá»‡u khÃ¡c (SRS, API doc).

### 1.4 Activation (Thá»i gian sá»‘ng xá»­ lÃ½)

- Mermaid há»— trá»£ `activate` / `deactivate` Ä‘á»ƒ biá»ƒu diá»…n khoáº£ng thá»i gian object Ä‘ang xá»­ lÃ½ má»™t lá»i gá»i.
- VÃ­ dá»¥:
  ```mermaid
  sequenceDiagram
    participant Service
    participant Repo

    Service ->> Repo: findUser()
    activate Repo
    Repo -->> Service: User
    deactivate Repo
  ```
- Activation nÃªn dÃ¹ng cho:
  - Thá»ƒ hiá»‡n rÃµ call chain nhiá»u táº§ng (UI â†’ Controller â†’ Service â†’ Repo â†’ DB).
  - Hiá»ƒn thá»‹ xá»­ lÃ½ lá»“ng nhau (nested calls / recursion).

---

## 2. Interaction Fragments (Quan trá»ng nháº¥t)

**Má»¥c tiÃªu**: DÃ¹ng Ä‘Ãºng `alt`, `opt`, `loop` Ä‘á»ƒ mÃ´ táº£ if/else, luá»“ng tÃ¹y chá»n vÃ  vÃ²ng láº·p theo Ä‘Ãºng chuáº©n UML.

### 2.1 `alt` â€“ Ráº½ nhÃ¡nh logic (If / Else / Multi-branch)

- DÃ¹ng cho **cÃ¡c nhÃ¡nh loáº¡i trá»« láº«n nhau** (mutually exclusive paths).
- Má»—i nhÃ¡nh cÃ³ má»™t guard (Ä‘iá»u kiá»‡n), tÆ°Æ¡ng Ä‘Æ°Æ¡ng `if / else if / else`.

VÃ­ dá»¥:
```mermaid
sequenceDiagram
  alt login success
      AuthService ->> SessionService: createSession(userId)
      SessionService -->> AuthService: sessionToken
  else invalid password
      AuthService -->> User: showError("Invalid credentials")
  else user locked
      AuthService -->> User: showError("Account locked")
  end
```

**Quy táº¯c:**

- Má»i luá»“ng if/else quan trá»ng trong nghiá»‡p vá»¥ nÃªn dÃ¹ng `alt` thay vÃ¬ váº½ nhiá»u mÅ©i tÃªn rá»i ráº¡c.
- KhÃ´ng nhá»“i quÃ¡ nhiá»u trÆ°á»ng há»£p hiáº¿m â†’ tÃ¡ch thÃ nh sÆ¡ Ä‘á»“ khÃ¡c náº¿u sá»‘ nhÃ¡nh > 3â€“4.

### 2.2 `opt` â€“ HÃ nh Ä‘á»™ng tÃ¹y chá»n (Optional)

- `opt` dÃ¹ng cho **má»™t nhÃ¡nh duy nháº¥t, cÃ³ thá»ƒ xáº£y ra hoáº·c khÃ´ng** â€“ tÆ°Æ¡ng Ä‘Æ°Æ¡ng `if (condition) { ... }` **khÃ´ng cÃ³** else.
- ThÃ­ch há»£p cho cÃ¡c tÃ­nh nÄƒng "cÃ³ cÅ©ng Ä‘Æ°á»£c, khÃ´ng cÃ³ cÅ©ng Ä‘Æ°á»£c" nhÆ°:
  - Gá»­i email thÃ´ng bÃ¡o.
  - Ghi log nÃ¢ng cao.
  - TÃ­nh reward points náº¿u user lÃ  member.

VÃ­ dá»¥:
```mermaid
sequenceDiagram
  opt send notification
      NotificationService -->> EmailProvider: sendWelcomeEmail(userEmail)
  end
```

**Quy táº¯c:**

- Náº¿u cÃ³ cáº£ nhÃ¡nh "khÃ´ng gá»­i" vá»›i hÃ nh vi khÃ¡c biá»‡t â†’ dÃ¹ng `alt` thay vÃ¬ `opt`.
- KhÃ´ng láº¡m dá»¥ng `opt` cho cÃ¡c logic chÃ­nh cá»§a use case (nÃªn dÃ¹ng `alt`).

### 2.3 `loop` â€“ VÃ²ng láº·p

- DÃ¹ng `loop` cho cÃ¡c thao tÃ¡c láº·p láº¡i nhiá»u láº§n trong cÃ¹ng má»™t scenario:
  - Duyá»‡t tá»«ng item trong giá» hÃ ng.
  - Gá»­i thÃ´ng bÃ¡o tá»›i danh sÃ¡ch user.
- CÃ³ thá»ƒ ghi Ä‘iá»u kiá»‡n hoáº·c range ngay trÃªn `loop`, vÃ­ dá»¥:
  ```mermaid
  sequenceDiagram
    loop for each item in cartItems
        CheckoutService ->> PricingService: calculatePrice(item)
        PricingService -->> CheckoutService: itemPrice
    end
  ```

**Quy táº¯c:**

- KhÃ´ng váº½ tá»«ng láº§n láº·p giá»‘ng há»‡t nhau; hÃ£y dÃ¹ng `loop` vá»›i mÃ´ táº£ rÃµ rÃ ng.
- Náº¿u trong vÃ²ng láº·p cÃ²n cÃ³ if/else â†’ cÃ³ thá»ƒ lá»“ng `alt` bÃªn trong `loop`.

---

## 3. Best Practices (TÆ° duy & Quy Æ°á»›c)

### 3.1 TÆ° duy tá»« Use Case â†’ Sequence

Äá»ƒ trÃ¡nh sÆ¡ Ä‘á»“ sai logic, luÃ´n Ä‘i theo pipeline sau trÆ°á»›c khi váº½:

1. **XÃ¡c Ä‘á»‹nh scenario cá»¥ thá»ƒ**
   - VÃ­ dá»¥: "User Ä‘Äƒng nháº­p thÃ nh cÃ´ng", "User Ä‘Äƒng nháº­p sai máº­t kháº©u 3 láº§n".
2. **Liá»‡t kÃª actor & Ä‘á»‘i tÆ°á»£ng tham gia**
   - User, UI (page / component), Controller, Service, Repo, DB, external API.
3. **Viáº¿t láº¡i luá»“ng bÆ°á»›c (Step 1, 2, 3, â€¦)**
   - Ai gá»i ai, gá»i hÃ m gÃ¬, dá»¯ liá»‡u quan trá»ng lÃ  gÃ¬.
4. **XÃ¡c Ä‘á»‹nh Ä‘iá»u kiá»‡n ráº½ nhÃ¡nh & vÃ²ng láº·p**
   - CÃ¡c case thÃ nh cÃ´ng / tháº¥t báº¡i, Ä‘iá»u kiá»‡n lá»—i, loop qua danh sÃ¡ch.
5. **Quyáº¿t Ä‘á»‹nh má»©c chi tiáº¿t (SSD vs Design-level)**
   - Váº½ Actor â†” System tá»•ng quÃ¡t hay xuá»‘ng tá»›i tá»«ng lá»›p UI / Service / Repo.

Sequence Diagram chá»‰ lÃ  bÆ°á»›c **chuyá»ƒn tá»« chá»¯ sang hÃ¬nh** cá»§a 5 nhÃ³m thÃ´ng tin trÃªn.

### 3.2 Activation Boxes (Thá»i gian xá»­ lÃ½)

- **Khi nÃ o nÃªn dÃ¹ng activation**:
  - Khi muá»‘n nháº¥n máº¡nh ai Ä‘ang "giá»¯ quyá»n Ä‘iá»u khiá»ƒn" táº¡i má»—i bÆ°á»›c trong call chain.
  - Khi cÃ³ nested calls (Service gá»i Repo, Repo gá»i DB) Ä‘á»ƒ ngÆ°á»i xem dá»… theo dÃµi.
- **Khi nÃ o cÃ³ thá»ƒ lÆ°á»£c bá»›t**:
  - Actor khá»Ÿi phÃ¡t (User / Browser) Ä‘Ã´i khi khÃ´ng cáº§n váº½ activation náº¿u lifeline kÃ©o dÃ i toÃ n bá»™ sÆ¡ Ä‘á»“.
- **Äá»‹nh dáº¡ng**:
  - DÃ¹ng `activate Object` ngay sau message vÃ o, vÃ  `deactivate Object` khi tráº£ káº¿t quáº£ xong.

VÃ­ dá»¥:
```mermaid
sequenceDiagram
  actor User
  participant UI
  participant AuthService
  participant Payload

  User ->> UI: submitLoginForm()
  activate UI
  UI ->> AuthService: login(email, password)
  activate AuthService
  AuthService ->> Payload: findUserByEmail()
  activate Payload
  Payload -->> AuthService: User | null
  deactivate Payload
  AuthService -->> UI: LoginResult
  deactivate AuthService
  UI -->> User: showResult()
  deactivate UI
```

### 3.3 Äáº·t tÃªn Message (Verb + Object)

- **Quy táº¯c chung**:
  - TÃªn message = **Ä‘á»™ng tá»« + tÃ¢n ngá»¯** (verb + object) báº±ng tiáº¿ng Anh chuáº©n.
  - VÃ­ dá»¥ tá»‘t: `loginUser`, `validateCredentials`, `createOrder`, `sendResetEmail`.
  - TrÃ¡nh tÃªn mÆ¡ há»“ kiá»ƒu `doStuff`, `process`, `handle`.

- **Khá»›p vá»›i codebase**:
  - Æ¯u tiÃªn dÃ¹ng Ä‘Ãºng tÃªn hÃ m / method trong code náº¿u cÃ³.
  - Vá»›i Payload Local API, message cÃ³ thá»ƒ lÃ :
    - `payload.find(posts)`, `payload.findByID(users)`, `payload.create(order)`.

- **KhÃ´ng nhÃ©t quÃ¡ nhiá»u param vÃ o message label**:
  - Chá»‰ nÃªu cÃ¡c tham sá»‘ quan trá»ng (userId, orderId, amountâ€¦).
  - Chi tiáº¿t thÃªm cÃ³ thá»ƒ Ä‘Æ°a vÃ o note náº¿u cáº§n.

### 3.4 Layout & Äá»™ Ä‘á»c Ä‘Æ°á»£c (Readability)

- **Giá»›i háº¡n sá»‘ lifeline**:
  - Náº¿u > 8 lifeline, cÃ¢n nháº¯c tÃ¡ch thÃ nh nhiá»u sÆ¡ Ä‘á»“ nhá» hÆ¡n (sub-sequence).
- **NhÃ³m cÃ¡c message liÃªn quan**:
  - CÃ¡c khá»‘i cÃ³ cÃ¹ng má»¥c Ä‘Ã­ch (validate, persist, notify) nÃªn gom trong cÃ¹ng má»™t fragment hoáº·c Ä‘Æ°á»£c "Ä‘Ã³ng khung" báº±ng note.
- **KhÃ´ng váº½ "nháº£y cÃ³c" tá»›i Database**:
  - Luá»“ng pháº£i luÃ´n Ä‘i qua Service/Repository hoáº·c Payload Local API, khÃ´ng cho UI gá»i DB trá»±c tiáº¿p.

---

## 4. Checklist Nhanh TrÆ°á»›c Khi Chá»‘t SÆ¡ Äá»“

TrÆ°á»›c khi coi má»™t Sequence Diagram lÃ  "xong", kiá»ƒm tra:

- [ ] CÃ³ **scenario cá»¥ thá»ƒ** Ä‘Æ°á»£c mÃ´ táº£ báº±ng lá»i á»Ÿ ngoÃ i (hoáº·c trong note).
- [ ] Táº¥t cáº£ actor & Ä‘á»‘i tÆ°á»£ng Ä‘á»u cÃ³ lifeline rÃµ rÃ ng, tÃªn Ä‘Ãºng vai trÃ².
- [ ] KhÃ´ng cÃ³ message "bay" tháº³ng tá»« UI tá»›i DB, luÃ´n qua Service/Repo/Payload.
- [ ] CÃ¡c luá»“ng if/else dÃ¹ng `alt`, cÃ¡c hÃ nh Ä‘á»™ng tÃ¹y chá»n dÃ¹ng `opt`, vÃ²ng láº·p dÃ¹ng `loop`.
- [ ] Message Ä‘áº·t tÃªn theo quy táº¯c verb + object, Æ°u tiÃªn khá»›p code tháº­t.
- [ ] Activation thá»ƒ hiá»‡n rÃµ call chain chÃ­nh (Ã­t nháº¥t cho Service/Repo/DB náº¿u cáº§n).
- [ ] SÆ¡ Ä‘á»“ khÃ´ng quÃ¡ dÃ y Ä‘áº·c; náº¿u quÃ¡ dÃ i, tÃ¡ch thÃ nh nhiá»u sÆ¡ Ä‘á»“ nhá» hÆ¡n theo use case hoáº·c subflow.
```

### skill-planner/design.md
```md
# skill-planner â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-13
> Status: ğŸŸ¢ COMPLETE

---

## 1. Problem Statement

Sau khi Skill Architect táº¡o báº£n thiáº¿t káº¿ kiáº¿n trÃºc (`design.md`), ngÆ°á»i dÃ¹ng Ä‘á»‘i máº·t
vá»›i 3 váº¥n Ä‘á»:

1. **KhÃ´ng biáº¿t báº¯t Ä‘áº§u tá»« Ä‘Ã¢u** â€” design.md chá»©a kiáº¿n trÃºc tá»•ng thá»ƒ nhÆ°ng khÃ´ng chá»‰
   thá»© tá»± triá»ƒn khai
2. **KhÃ´ng biáº¿t cáº§n chuáº©n bá»‹ kiáº¿n thá»©c gÃ¬** â€” skill thÆ°á»ng Ä‘Ã²i há»i domain knowledge
   mÃ  ngÆ°á»i dÃ¹ng (hoáº·c AI) chÆ°a cÃ³
3. **Dá»… láº¡c hÆ°á»›ng khi xÃ¢y dá»±ng** â€” khÃ´ng cÃ³ checklist hoÃ n thÃ nh, dá»… bá» sÃ³t thÃ nh pháº§n

**Ai gáº·p váº¥n Ä‘á»**: AI Agent vÃ  ngÆ°á»i dÃ¹ng Ä‘ang xÃ¢y dá»±ng Agent Skill má»›i.
**Vá»‹ trÃ­**: Skill #2 trong bá»™ Master Skill Suite (Architect â†’ **Planner** â†’ Builder).

## 2. Capability Map

### 2.1 Tri thá»©c (Knowledge)

| # | Kiáº¿n thá»©c | File | Má»¥c Ä‘Ã­ch |
|---|----------|------|---------|
| K1 | ÄÃ³ng gÃ³i ká»¹ nÄƒng (Skill Packaging) | `knowledge/skill-packaging.md` | Hiá»ƒu cÃ¡ch chuyá»ƒn human skill â†’ agent skill. MÃ´ hÃ¬nh 3 táº§ng. Chá»‘ng áº£o giÃ¡c |
| K2 | Báº£n thiáº¿t káº¿ (Input) | `.skill-context/{name}/design.md` | Ground truth â€” nguá»“n duy nháº¥t má»i task pháº£i trace vá» |
| K3 | TÃ i liá»‡u tham kháº£o (Input) | `.skill-context/{name}/resources/` + context prompt | Bá»• sung tá»« user (náº¿u cÃ³) |

**KhÃ´ng dÃ¹ng** `architect.md` â€” Ä‘Ã³ lÃ  framework thiáº¿t káº¿, khÃ´ng pháº£i framework láº­p káº¿ hoáº¡ch.

#### Ná»™i dung `knowledge/skill-packaging.md`:

1. **NguyÃªn táº¯c Ä‘Ã³ng gÃ³i**
   - Ká»¹ nÄƒng con ngÆ°á»i = Kiáº¿n thá»©c + Quy trÃ¬nh + PhÃ¡n Ä‘oÃ¡n
   - AI cáº§n cáº£ 3 á»Ÿ dáº¡ng TÆ¯á»œNG MINH (explicit)
   - PhÃ¡n Ä‘oÃ¡n â†’ chuyá»ƒn thÃ nh Guardrails + Checklists

2. **MÃ´ hÃ¬nh 3 táº§ng kiáº¿n thá»©c**
   - Táº§ng 1 (Domain): Kiáº¿n thá»©c miá»n â€” hiá»ƒu báº£n cháº¥t thá»© cáº§n lÃ m
   - Táº§ng 2 (Technical): Ká»¹ thuáº­t triá»ƒn khai â€” cÃ´ng cá»¥, cÃº phÃ¡p
   - Táº§ng 3 (Packaging): ÄÃ³ng gÃ³i â€” map human skill vÃ o 7 Zones

3. **Checklist chuyá»ƒn Ä‘á»•i** (cho má»—i Zone trong design.md):
   - Kiáº¿n thá»©c miá»n nÃ o cáº§n? â†’ knowledge/ files
   - CÃ´ng cá»¥/ká»¹ thuáº­t nÃ o cáº§n? â†’ scripts/, tools
   - Quy trÃ¬nh nÃ o cáº§n chuáº©n hÃ³a? â†’ SKILL.md phases
   - PhÃ¡n Ä‘oÃ¡n nÃ o cáº§n guardrail? â†’ loop/ checklists
   - Output nÃ o cáº§n khuÃ´n máº«u? â†’ templates/

4. **NguyÃªn táº¯c chá»‘ng áº£o giÃ¡c**
   - Má»i task PHáº¢I trace vá» section cá»¥ thá»ƒ trong design.md
   - KhÃ´ng phÃ¡t minh requirements má»›i (chá»‰ phÃ¢n rÃ£)
   - KhÃ´ng Ä‘oÃ¡n kiáº¿n thá»©c miá»n â€” liá»‡t kÃª Ä‘á»ƒ user cung cáº¥p
   - ÄÃ¡nh dáº¥u rÃµ: `[Tá»ª DESIGN]` vs `[Gá»¢I Ã Bá»” SUNG]`

### 2.2 Quy trÃ¬nh (Process)

**Flow liÃªn tá»¥c 3 bÆ°á»›c ná»™i bá»™, 1 interaction point á»Ÿ cuá»‘i:**

| BÆ°á»›c | HÃ nh Ä‘á»™ng | Input | Output |
|------|----------|-------|--------|
| READ | Äá»c design.md + resources/ + context prompt | Files tá»« `.skill-context/{name}/` | Model ná»™i bá»™ vá» skill |
| ANALYZE | PhÃ¢n tÃ­ch 3 táº§ng kiáº¿n thá»©c Ã— má»—i Zone | Model + skill-packaging.md | Báº£ng kiáº¿n thá»©c + tasks |
| WRITE | Ghi todo.md, trace má»i item vá» design.md | Káº¿t quáº£ phÃ¢n tÃ­ch | `.skill-context/{name}/todo.md` |

**Logic ANALYZE chi tiáº¿t:**
```
Vá»›i Má»–I Zone cÃ³ ná»™i dung trong design.md Â§3 (Zone Mapping):
â”œâ”€â”€ Táº§ng 1 (Domain): Kiáº¿n thá»©c miá»n nÃ o cáº§n chuáº©n bá»‹?
â”œâ”€â”€ Táº§ng 2 (Technical): CÃ´ng cá»¥/ká»¹ thuáº­t thu tháº­p kiáº¿n thá»©c nÃ o cáº§n?
â””â”€â”€ Táº§ng 3 (Packaging): Map vÃ o Zone báº±ng cÃ¡ch nÃ o, cáº§n táº¡o file gÃ¬?
â†’ Sinh: Pre-requisite entries + Task entries (cÃ³ trace)
```

### 2.3 Kiem soat (Guardrails)

| # | Rule | MÃ´ táº£ |
|---|------|-------|
| G1 | Trace báº¯t buá»™c | Má»i item trong todo.md PHáº¢I trace vá» `design.md Â§N` |
| G2 | PhÃ¢n biá»‡t nguá»“n | ÄÃ¡nh dáº¥u `[Tá»ª DESIGN]` vs `[Gá»¢I Ã Bá»” SUNG]` |
| G3 | KhÃ´ng phÃ¡t minh | Chá»‰ PHÃ‚N RÃƒ thiáº¿t káº¿, khÃ´ng thÃªm requirements má»›i |
| G4 | Liá»‡t kÃª, khÃ´ng tá»± lÃ m | Liá»‡t kÃª kiáº¿n thá»©c cáº§n â†’ user chuáº©n bá»‹. KhÃ´ng tá»± search |
| G5 | Neo vÃ o design.md | Ground truth duy nháº¥t. Náº¿u thiáº¿u â†’ ghi vÃ o Notes, khÃ´ng Ä‘oÃ¡n |

## 3. Zone Mapping

| Zone | Cáº§n? | Ná»™i dung | LÃ½ do |
|------|------|---------|-------|
| Core (SKILL.md) | âœ… | Persona Senior Skill Planner. Flow Readâ†’Analyzeâ†’Write. 5 Guardrails. Output spec | Linh há»“n Ä‘iá»u khiá»ƒn |
| Knowledge | âœ… | `skill-packaging.md` â€” 3 táº§ng kiáº¿n thá»©c, checklist chuyá»ƒn Ä‘á»•i, chá»‘ng áº£o giÃ¡c | Tri thá»©c ná»n vá» Ä‘Ã³ng gÃ³i ká»¹ nÄƒng |
| Scripts | âŒ | â€” | Output lÃ  markdown, khÃ´ng cáº§n automation |
| Templates | âŒ | â€” | DÃ¹ng `todo.md.template` tá»« init_context |
| Data | âŒ | â€” | KhÃ´ng cÃ³ config tÄ©nh |
| Loop | âœ… | `plan-checklist.md` â€” kiá»ƒm tra cháº¥t lÆ°á»£ng todo.md | Kiá»ƒm soÃ¡t output |
| Assets | âŒ | â€” | KhÃ´ng cÃ³ media |

## 4. Folder Structure

```mermaid
mindmap
  root((skill-planner))
    SKILL.md
      Persona
      Flow 3 buoc
      5 Guardrails
      Output spec
    knowledge
      skill-packaging.md
        3 tang kien thuc
        Checklist chuyen doi
        Chong ao giac
    loop
      plan-checklist.md
        Trace check
        Completeness check
        Quality check
```

## 5. Execution Flow

```mermaid
sequenceDiagram
    participant U as User
    participant P as Skill Planner
    participant K as knowledge/skill-packaging.md
    participant D as .skill-context/{name}/design.md
    participant R as .skill-context/{name}/resources/
    participant O as .skill-context/{name}/todo.md

    U->>P: KÃ­ch hoáº¡t Planner (skill-name)
    P->>P: Äá»c SKILL.md (persona + rules)
    P->>K: Äá»c skill-packaging.md (3 táº§ng + chá»‘ng áº£o giÃ¡c)
    P->>D: Äá»c design.md (ground truth)
    P->>R: Äá»c resources/ (náº¿u cÃ³)

    Note over P: === BÆ¯á»šC READ hoÃ n táº¥t ===

    loop Vá»›i má»—i Zone cÃ³ ná»™i dung trong design.md Â§3
        P->>P: Táº§ng 1 Domain: kiáº¿n thá»©c miá»n cáº§n?
        P->>P: Táº§ng 2 Technical: cÃ´ng cá»¥ cáº§n?
        P->>P: Táº§ng 3 Packaging: map vÃ o zone báº±ng cÃ¡ch nÃ o?
        P->>P: Sinh pre-requisites + tasks (cÃ³ trace)
    end

    Note over P: === BÆ¯á»šC ANALYZE hoÃ n táº¥t ===

    P->>O: Ghi todo.md (Pre-reqs, Phases, Resources, DoD, Notes)

    Note over P: === BÆ¯á»šC WRITE hoÃ n táº¥t ===

    P->>U: TrÃ¬nh bÃ y todo.md, chá» confirm
    alt User confirm
        U->>P: OK
        P->>P: ÄÃ¡nh dáº¥u hoÃ n táº¥t
    else User cáº§n sá»­a
        U->>P: Pháº£n há»“i
        P->>O: Cáº­p nháº­t todo.md theo pháº£n há»“i
        P->>U: TrÃ¬nh bÃ y láº¡i
    end
```

## 6. Interaction Points

| # | Thá»i Ä‘iá»ƒm | Loáº¡i | LÃ½ do |
|---|-----------|------|-------|
| 1 | Sau khi ghi todo.md | Confirm/Revise | User xem káº¿t quáº£, xÃ¡c nháº­n hoáº·c yÃªu cáº§u sá»­a |

Chá»‰ 1 interaction point â€” vÃ¬ input (design.md) Ä‘Ã£ Ä‘Æ°á»£c confirm bá»Ÿi Skill Architect.

## 7. Progressive Disclosure Plan

### Táº§ng 1: Báº¯t buá»™c Ä‘á»c (Mandatory)
- `SKILL.md` â€” persona, flow, guardrails
- `knowledge/skill-packaging.md` â€” 3 táº§ng kiáº¿n thá»©c, chá»‘ng áº£o giÃ¡c

### Táº§ng 2: Tá»± quyáº¿t Ä‘á»‹nh (Conditional)
- `loop/plan-checklist.md` â€” Ä‘á»c SAU khi ghi todo.md Ä‘á»ƒ tá»± kiá»ƒm tra

## 8. Risks & Blind Spots

| # | Risk | Nguy cÆ¡ | Mitigation |
|---|------|---------|------------|
| B1 | Bá»‹a kiáº¿n thá»©c miá»n | AI viáº¿t sai kiáº¿n thá»©c domain vÃ¬ tá»± suy luáº­n | G1+G2: trace báº¯t buá»™c + Ä‘Ã¡nh dáº¥u nguá»“n |
| B2 | Tasks quÃ¡ chung chung | "Táº¡o SKILL.md" khÃ´ng Ä‘á»§ chi tiáº¿t | plan-checklist: má»—i task pháº£i actionable |
| B3 | Bá» sÃ³t Zone | Design nÃ³i cáº§n Zone nhÆ°ng Planner quÃªn | Checklist: Ä‘á»‘i chiáº¿u má»i Zone trong design Â§3 |
| B4 | Sai thá»© tá»± dependencies | Task B phá»¥ thuá»™c A nhÆ°ng xáº¿p sau | Tasks xáº¿p theo dependency, ghi rÃµ phá»¥ thuá»™c |
| B5 | KhÃ´ng phÃ¢n biá»‡t 3 táº§ng | Gá»™p Domain + Technical + Packaging | skill-packaging.md báº¯t buá»™c tÃ¡ch 3 táº§ng |

## 9. Open Questions

KhÃ´ng cÃ³ â€” táº¥t cáº£ decisions Ä‘Ã£ Ä‘Æ°á»£c thá»‘ng nháº¥t trong Phase 1-2.

## 10. Metadata

- **Skill Name**: skill-planner
- **Created**: 2026-02-13
- **Author**: Skill Architect
- **Framework**: architect.md v2.0
- **Position**: #2 trong bá»™ Master Skill Suite (Architect â†’ **Planner** â†’ Builder)
- **Decisions**: P-D1 (liá»‡t kÃª), P-D2 (knowledge ná»n), P-D3 (3 táº§ng), P-D4 (flow liÃªn tá»¥c)
- **Zones Used**: 3/7 (Core, Knowledge, Loop)
- **Status**: ğŸŸ¢ COMPLETE

```

### skill-planner/build-log.md
```md
# skill-planner â€” Build Log

> Generated by Skill Builder | Date: 2026-02-13
> Status: âšª PENDING

---

## 1. Build Session Log

<!-- Nhat ky tung buoc xay dung, ghi theo thoi gian -->

| Thoi gian | Hanh dong | Ket qua |
|-----------|----------|---------|
| <!-- e.g. 14:00 --> | <!-- e.g. Tao SKILL.md --> | <!-- e.g. OK --> |

## 2. Files Created

| # | File | Muc dich | Status |
|---|------|---------|--------|
| 1 | <!-- e.g. SKILL.md --> | <!-- e.g. Core skill logic --> | â¬œ |

## 3. Decisions Made During Build

<!-- Cac quyet dinh ky thuat trong qua trinh xay dung -->

| # | Quyet dinh | Ly do | Anh huong |
|---|-----------|-------|----------|
| 1 | <!-- e.g. Dung Python thay vi Bash --> | <!-- e.g. Logic phuc tap hon --> | <!-- e.g. Can Python 3.10+ --> |

## 4. Issues Encountered

<!-- Cac van de gap phai va cach xu ly -->

| # | Van de | Nguyen nhan | Cach xu ly |
|---|--------|-----------|-----------|
| 1 | <!-- e.g. Template khong load --> | <!-- e.g. Sai path --> | <!-- e.g. Fix path resolution --> |

## 5. Final Status

- [ ] Skill package created at `.agent/skills/skill-planner/`
- [ ] Structure validated (7-Zone compliant)
- [ ] SKILL.md reviewed and approved
- [ ] Knowledge files loaded
- [ ] Scripts tested
- [ ] Templates verified
- [ ] Loop checklist created
- [ ] Ready for use

```

### skill-planner/todo.md
```md
# skill-planner â€” Implementation Plan

> Generated by Skill Planner | Date: 2026-02-13
> Status: âšª PENDING

---

## 1. Pre-requisites

<!-- Tai lieu va kien thuc can chuan bi TRUOC khi bat tay xay dung -->

| # | Tai lieu / Kien thuc | Muc dich | Da san sang? |
|---|---------------------|---------|-------------|
| 1 | <!-- e.g. architect.md --> | <!-- e.g. Framework kien truc --> | â¬œ |

## 2. Phase Breakdown

### Phase 1: Foundation
<!-- Tao cau truc thu muc, cau hinh co ban -->
- [ ] Task 1.1: <!-- Mo ta -->
- [ ] Task 1.2: <!-- Mo ta -->

### Phase 2: Core Logic
<!-- Xay dung logic chinh cua skill -->
- [ ] Task 2.1: <!-- Mo ta -->
- [ ] Task 2.2: <!-- Mo ta -->

### Phase 3: Templates & Data
<!-- Tao templates, nap du lieu -->
- [ ] Task 3.1: <!-- Mo ta -->
- [ ] Task 3.2: <!-- Mo ta -->

### Phase 4: Quality & Verify
<!-- Kiem tra, test, verify -->
- [ ] Task 4.1: <!-- Mo ta -->
- [ ] Task 4.2: <!-- Mo ta -->

## 3. Knowledge & Resources Needed

| # | Tai lieu | Muc dich | Trang thai |
|---|---------|---------|-----------|
| 1 | <!-- e.g. UML standards --> | <!-- e.g. Dam bao diagram dung chuan --> | â“ |

## 4. Definition of Done

- [ ] Cau truc thu muc dung 7-Zone architecture
- [ ] SKILL.md co du persona, phases, guardrails
- [ ] Knowledge files da nap
- [ ] Templates da tao va test
- [ ] Loop checklist da tao
- [ ] <!-- Them tieu chi cu the cho skill nay -->

## 5. Notes

<!-- Ghi chu them, luu y dac biet -->

```

### skill-planner/resources/architect.md
```md
# AGENT SKILL FRAMEWORK - TÃ€I LIá»†U KIáº¾N TRÃšC

================================================================================
                        PHáº¦N 1: Tá»”NG QUAN KIáº¾N TRÃšC
================================================================================

## 1.1. MÃ´ hÃ¬nh Meta-Skill Framework

MÃ´ hÃ¬nh nÃ y Ä‘á»‹nh nghÄ©a cÃ¡ch tiáº¿p cáº­n tá»•ng thá»ƒ Ä‘á»ƒ xÃ¢y dá»±ng má»™t bá»™ Agent Skill
cÃ³ cáº¥u trÃºc, logic vÃ  kháº£ nÄƒng kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng.

```mermaid
graph TD
    subgraph MetaSkillFramework [MÃ” HÃŒNH KIá»‚M CÃCH - META-SKILL FRAMEWORK]
        P1[PHA 1: NHáº¬N DIá»†N<br/>Input/Output] --> P2[PHA 2: CHIáº¾N LÆ¯á»¢C<br/>Checklist/Plan]
        P2 --> P3[PHA 3: THá»°C THI<br/>Research/Action]
        
        P1 --> D1[Dá»¯ liá»‡u Gá»‘c]
        P2 --> D2[Quy trÃ¬nh Chuáº©n]
        P3 --> D3[TÆ°Æ¡ng tÃ¡c & Tháº©m Ä‘á»‹nh]
        
        D1 --> LC[VÃ’NG Láº¶P KIá»‚M SOÃT<br/>Verify/Fix/Loop]
        D2 --> LC
        D3 --> LC
    end

    style MetaSkillFramework fill:#f9f9f9,stroke:#333,stroke-width:2px
    style LC fill:#e1f5fe,stroke:#01579b
```


## 1.2. Kiáº¿n trÃºc "NgÃ´i nhÃ " (Building Metaphor)

```mermaid
graph TD
    Outcome[MÃI NHÃ€: GIÃ TRá»Š Äáº¦U RA - Outcome<br/>- Sáº£n pháº©m hoÃ n thiá»‡n, chÃ­nh xÃ¡c, cÃ³ tháº©m má»¹<br/>- NgÆ°á»i dÃ¹ng hÃ i lÃ²ng vÃ  tin tÆ°á»Ÿng]
    
    subgraph Pillars [CÃC TRá»¤ Cá»˜T]
        T1[TRá»¤ 1: TRI THá»¨C<br/>Knowledge]
        T2[TRá»¤ 2: QUY TRÃŒNH<br/>Logic/Steps]
        T3[TRá»¤ 3: KIá»‚M SOÃT<br/>Guardrails]
    end
    
    Foundation[Ná»€N MÃ“NG: NGHIÃŠN Cá»¨U & PHÃ‚N TÃCH<br/>Input, Tools, Environment, User Pain-points]
    
    Foundation --> Pillars
    Pillars --> Outcome

    style Outcome fill:#e8f5e9,stroke:#2e7d32
    style Foundation fill:#fff3e0,stroke:#ef6c00
    style Pillars fill:#f3e5f5,stroke:#7b1fa2
```


================================================================================
                  PHáº¦N 2: CÃC THÃ€NH PHáº¦N KIáº¾N TRÃšC (ZONES)
================================================================================

## 2.1. Cáº¥u trÃºc thÆ° má»¥c chuáº©n

```mermaid
mindmap
  root((your-skill-name))
    SKILL.md:::core
    .skillfish.json
    knowledge
      standards.md
      best-practices.md
      design-patterns.md
    scripts
      python
        analyzer.py
        validator.py
        generator.py
      javascript
        formatter.js
        mermaid-render.js
      bash
        scan-project.sh
        setup-env.sh
        export-diagram.sh
    templates
      sequence.mmd
      class.mmd
      activity.mmd
    data
      config.yaml
      schema.json
      seed-data.csv
    loop
      checklist.md
      tasks.md
      phase-verify.md
      final-verify.md
      test-cases
        login-flow.md
        order-flow.md
    assets
      icons
      fonts
      images

    classDef core fill:#f96
```


## 2.2. Chi tiáº¿t tá»«ng Zone

| ZONE | Má»¤C ÄÃCH | VÃ Dá»¤ Ná»˜I DUNG | KHI NÃ€O AI Äá»ŒC? |
| :--- | :--- | :--- | :--- |
| **SKILL.md (Core)** | Linh há»“n Ä‘iá»u khiá»ƒn | Persona, Steps, Guardrails | LUÃ”N LUÃ”N (khi skill Ä‘Æ°á»£c kÃ­ch hoáº¡t) |
| **knowledge/** | Tri thá»©c chuáº©n | UML rules, Design patterns | Khi cáº§n tham kháº£o quy táº¯c |
| **scripts/** | CÃ´ng cá»¥ tá»± Ä‘á»™ng hÃ³a | Python analyzer, Bash generator | Khi cáº§n thá»±c thi logic phá»©c táº¡p |
| **templates/** | Máº«u Ä‘áº§u ra | Mermaid templates, Code stubs | Khi cáº§n táº¡o output chuáº©n |
| **data/** | Cáº¥u hÃ¬nh & dá»¯ liá»‡u cá»©ng | YAML config, JSON schema | Khi cáº§n Ä‘á»c cáº¥u hÃ¬nh cá»‘ Ä‘á»‹nh |
| **loop/** | Kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng | Checklist, Tasks, Test cases | SAU má»—i phase Ä‘á»ƒ tá»± kiá»ƒm tra |
| **assets/** | TÃ i nguyÃªn tÄ©nh | Icons, Fonts, Images | Khi táº¡o output cÃ³ media |



================================================================================
                     PHáº¦N 3: WORKFLOW XÃ‚Y Dá»°NG SKILL
================================================================================

## 3.1. Quy trÃ¬nh 5 bÆ°á»›c

```mermaid
flowchart LR
    B1[BÆ¯á»šC 1: KHáº¢O SÃT<br/>Research] --> B2[BÆ¯á»šC 2: THIáº¾T Káº¾<br/>Design]
    B2 --> B3[BÆ¯á»šC 3: XÃ‚Y Dá»°NG<br/>Build]
    B3 --> B4[BÆ¯á»šC 4: KIá»‚M Äá»ŠNH<br/>Verify]
    B4 --> B5[BÆ¯á»šC 5: Báº¢O TRÃŒ<br/>Maintenance]

    subgraph Details [Chi tiáº¿t tá»«ng bÆ°á»›c]
        direction TB
        D1["- XÃ¡c Ä‘á»‹nh Pain Point<br/>- Thu tháº­p Use Cases<br/>- Liá»‡t kÃª Input/Output"]
        D2["- PhÃ¢n vÃ¹ng thÃ nh pháº§n<br/>- Váº½ sÆ¡ Ä‘á»“ kiáº¿n trÃºc<br/>- Äá»‹nh nghÄ©a luá»“ng lÃ m viá»‡c"]
        D3["- Táº¡o cáº¥u trÃºc thÆ° má»¥c<br/>- Náº¡p dá»¯ liá»‡u vÃ o cÃ¡c vÃ¹ng<br/>- Viáº¿t SKILL.md"]
        D4["- Cháº¡y Test Cases<br/>- Verify Checklist<br/>- Rollback náº¿u Fail"]
        D5["- Feedback Loop<br/>- Version Control<br/>- Cáº­p nháº­t Skill"]
    end

    B1 -.-> D1
    B2 -.-> D2
    B3 -.-> D3
    B4 -.-> D4
    B5 -.-> D5

    style B1 fill:#f9f,stroke:#333
    style B5 fill:#0ff,stroke:#333
```


## 3.2. Chi tiáº¿t tá»«ng bÆ°á»›c

### BÆ°á»›c 1: Kháº£o sÃ¡t (Research & Discovery)

    Má»¥c tiÃªu: Hiá»ƒu rÃµ "vÃ¹ng Ä‘áº¥t" mÃ¬nh Ä‘á»‹nh xÃ¢y.
    
    Viá»‡c cáº§n lÃ m:
    [1] XÃ¡c Ä‘á»‹nh Input: NgÆ°á»i dÃ¹ng sáº½ Ä‘Æ°a cÃ¡i gÃ¬? (RÃ¡c hay vÃ ng?)
    [2] XÃ¡c Ä‘á»‹nh Tools: AI sáº½ dÃ¹ng Terminal, Browser hay Library nÃ o?
    [3] TÃ¬m ra "Äiá»ƒm mÃ¹" cá»§a AI: AI thÆ°á»ng sai á»Ÿ Ä‘Ã¢u trong cÃ´ng viá»‡c nÃ y?

### BÆ°á»›c 2: Thiáº¿t káº¿ (System Design)

    Má»¥c tiÃªu: Táº¡o ra logic "tÆ°á»ng minh" cho AI.
    
    Viá»‡c cáº§n lÃ m:
    [1] XÃ¢y dá»±ng Quy trÃ¬nh logic (Flowchart): BÆ°á»›c A -> BÆ°á»›c B
    [2] XÃ¡c Ä‘á»‹nh Äiá»ƒm dá»«ng tÆ°Æ¡ng tÃ¡c: Khi nÃ o AI PHáº¢I há»i ngÆ°á»i dÃ¹ng?
    [3] Äá»‹nh nghÄ©a Äá»‹nh dáº¡ng Output: Mermaid, Markdown, hay Code?

### BÆ°á»›c 3: XÃ¢y dá»±ng (Build)

    Má»¥c tiÃªu: Viáº¿t file SKILL.md vÃ  náº¡p tÃ i nguyÃªn.
    
    Viá»‡c cáº§n lÃ m:
    [1] Persona: Äá»‹nh vá»‹ AI lÃ  Senior Architect hay Senior Coder
    [2] Phase-based Steps: Chia nhá» cÃ´ng viá»‡c thÃ nh cÃ¡c Pha
    [3] Táº¡o templates, scripts, knowledge files

### BÆ°á»›c 4: Kiá»ƒm Ä‘á»‹nh (Verify)

    Má»¥c tiÃªu: Äáº£m báº£o Skill hoáº¡t Ä‘á»™ng Ä‘Ãºng.
    
    Viá»‡c cáº§n lÃ m:
    [1] Cháº¡y Test Cases
    [2] Verify Checklist
    [3] Rollback náº¿u phÃ¡t hiá»‡n lá»—i

### BÆ°á»›c 5: Báº£o trÃ¬ (Maintenance)

    Má»¥c tiÃªu: Giá»¯ cho Skill khÃ´ng bá»‹ "lá»—i thá»i".
    
    Viá»‡c cáº§n lÃ m:
    [1] Feedback Loop: Ghi láº¡i chá»— AI lÃ m dá»Ÿ
    [2] Version Control: Cáº­p nháº­t khi mÃ´i trÆ°á»ng thay Ä‘á»•i


================================================================================
                   PHáº¦N 4: CÆ  CHáº¾ KIá»‚M SOÃT (LOOP/VERIFY)
================================================================================

## 4.1. Hai cháº¿ Ä‘á»™ kiá»ƒm soÃ¡t

```mermaid
flowchart TD
    subgraph LoopZone [VÃ™NG LOOP - KIá»‚M SOÃT CHáº¤T LÆ¯á»¢NG]
        direction TB
        Simple[SIMPLE MODE<br/>1 láº§n cuá»‘i]
        Phase[PHASE MODE<br/>Má»—i phase]
        
        SimpleCheck{Khi nÃ o dÃ¹ng?}
        PhaseCheck{Khi nÃ o dÃ¹ng?}
        
        SimpleFlow[Input -> Work -> Output<br/>-> VERIFY]
        PhaseFlow[Phase 1 -> V<br/>Phase 2 -> V<br/>Phase 3 -> V<br/>Final -> VV]

        Simple --> SimpleCheck
        Phase --> PhaseCheck
        
        SimpleCheck -->|YÃªu cáº§u Ä‘Æ¡n giáº£n| SimpleFlow
        PhaseCheck -->|YÃªu cáº§u phá»©c táº¡p| PhaseFlow
    end

    style Simple fill:#fff9c4,stroke:#fbc02d
    style Phase fill:#c8e6c9,stroke:#388e3c
```


## 4.2. Cáº¥u trÃºc thÆ° má»¥c loop/

```
loop/
+-- checklist.md            <-- Danh sÃ¡ch kiá»ƒm tra chung
+-- tasks.md                <-- CÃ´ng viá»‡c cáº§n hoÃ n thÃ nh
+-- phase-verify.md         <-- Checklist riÃªng cho tá»«ng Phase
+-- final-verify.md         <-- Checklist kiá»ƒm tra cuá»‘i cÃ¹ng
+-- test-cases/
    +-- login-flow.md
    +-- order-flow.md
```


================================================================================
                    PHáº¦N 5: VÃ™NG SCRIPTS (CÃ”NG Cá»¤)
================================================================================

## 5.1. Ba loáº¡i script

```mermaid
graph LR
    subgraph ScriptsZone [VÃ™NG SCRIPTS - CÃ”NG Cá»¤ THá»°C THI]
        direction TB
        Python[Python<br/>Xá»­ lÃ½ logic, phÃ¢n tÃ­ch text]
        JS[JavaScript<br/>Xá»­ lÃ½ frontend, JSON, DOM]
        Bash[Bash<br/>Lá»‡nh há»‡ thá»‘ng, file system]
        
        Python --- P1[analyzer.py<br/>validator.py<br/>generator.py]
        JS --- J1[formatter.js<br/>mermaid-render.js]
        Bash --- B1[scan-project.sh<br/>setup-env.sh<br/>export-diagram.sh]
    end

    style Python fill:#e3f2fd,stroke:#1e88e5
    style JS fill:#fffde7,stroke:#fdd835
    style Bash fill:#f5f5f5,stroke:#757575
```


## 5.2. Ma tráº­n chá»n script theo cÃ´ng viá»‡c

| LOáº I CÃ”NG VIá»†C | SCRIPT Æ¯U TIÃŠN |
| :--- | :--- |
| **PhÃ¢n tÃ­ch text, NLP** | Python |
| **Xá»­ lÃ½ JSON, format data** | JavaScript |
| **QuÃ©t thÆ° má»¥c, Ä‘á»c cáº¥u trÃºc** | Bash |
| **Validate syntax** | Python |
| **Render diagram** | JavaScript |
| **Táº¡o file, copy template** | Bash |
| **Gá»i API bÃªn ngoÃ i** | Python/JS |



================================================================================
               PHáº¦N 6: PROGRESSIVE DISCLOSURE (Náº P TÃ€I NGUYÃŠN)
================================================================================

## 6.1. Hai táº§ng náº¡p file

```mermaid
flowchart TD
    subgraph ProgressiveDisclosure [CÆ  CHáº¾ Náº P TÃ€I NGUYÃŠN]
        direction TB
        Mandatory[Táº¦NG 1: Báº®T BUá»˜C Äá»ŒC<br/>Mandatory Loading]
        Optional[Táº¦NG 2: Tá»° QUYáº¾T Äá»ŠNH<br/>Conditional Loading]
        
        Mandatory --- M1["- SKILL.md<br/>- knowledge/standards.md<br/>- loop/checklist.md"]
        Optional --- O1["- knowledge/design-patterns.md<br/>- templates/*.mmd<br/>- data/schema.json"]
        
        Mandatory -->|Sau khi Ä‘á»c xong| Optional
    end

    style Mandatory fill:#ffcdd2,stroke:#e53935
    style Optional fill:#c5cae9,stroke:#3f51b5
```



================================================================================
                  PHáº¦N 7: LUá»’NG HOáº T Äá»˜NG Cá»¦A AI AGENT
================================================================================

## 7.1. Execution Flow

```mermaid
sequenceDiagram
    participant U as USER
    participant A as AI AGENT
    participant K as Knowledge Zone
    participant S as Scripts Zone
    participant T as Templates Zone
    participant L as Loop Zone

    U->>A: Input "Váº½ sequence cho Login"
    A->>A: STEP 1: Äá»c SKILL.md (Persona & Steps)
    A->>A: STEP 2: PhÃ¢n tÃ­ch Input (Use Case)
    Note over A,U: [Interaction Point] Há»i náº¿u thiáº¿u thÃ´ng tin
    A->>K: STEP 3: Tham kháº£o standards.md, uml-rules.md
    A->>S: STEP 4: Cháº¡y analyzer.py (BÃ³c tÃ¡ch entities)
    A->>T: STEP 5: Ãp dá»¥ng seq.mmd lÃ m khung
    A->>A: STEP 6: Táº¡o Output (Mermaid code)
    A->>L: STEP 7: Tá»± kiá»ƒm tra vá»›i checklist.md
    alt Fail?
        L-->>A: Quay láº¡i Step tÆ°Æ¡ng á»©ng
    else Pass?
        A->>U: Tráº£ káº¿t quáº£ cuá»‘i cÃ¹ng
    end
```



================================================================================
                   PHáº¦N 8: KIáº¾N TRÃšC Tá»”NG Há»¢P (v2.0)
================================================================================

```mermaid
graph TD
    Skill((SKILL.md<br/>CORE))
    
    subgraph Tier1 [Táº¦NG 1: Báº®T BUá»˜C]
        K1[knowledge/standards]
        L1[loop/checklist]
    end
    
    subgraph Tier2 [Táº¦NG 2: Tá»° QUYáº¾T]
        S1[scripts/]
        T1[templates/]
        D1[data/]
        A1[assets/]
        K2[knowledge/patterns]
    end

    Skill --> Tier1
    Skill --> Tier2

    style Skill fill:#f96,stroke:#333,stroke-width:4px
    style Tier1 fill:#fff9c4,stroke:#fbc02d
    style Tier2 fill:#e1f5fe,stroke:#01579b
```



================================================================================
                            PHáº¦N 9: PHá»¤ Lá»¤C
================================================================================

## 9.1. NguyÃªn táº¯c viáº¿t SKILL.md

    [1] Imperative Form: LuÃ´n báº¯t Ä‘áº§u báº±ng Ä‘á»™ng tá»« máº¡nh
        VÃ­ dá»¥: "Analyze the input", "Generate the code"
        KHÃ”NG dÃ¹ng: "You should analyze"
    
    [2] Progressive Disclosure: Chá»‰ Ä‘á»ƒ nhá»¯ng gÃ¬ AI cáº§n lÃ m NGAY Láº¬P Tá»¨C
        trong SKILL.md. TÃ i liá»‡u tham kháº£o dÃ i Ä‘á»ƒ trong references/
    
    [3] Verified Steps: Má»—i giai Ä‘oáº¡n (Phase) pháº£i káº¿t thÃºc báº±ng:
        "Check the output against the checklist in loop/checklist.md"

## 9.2. Äiá»ƒm dá»«ng tÆ°Æ¡ng tÃ¡c (Interaction Points)

    AI PHáº¢I dá»«ng láº¡i vÃ  há»i ngÆ°á»i dÃ¹ng khi:
    [1] ThÃ´ng tin Ä‘áº§u vÃ o khÃ´ng Ä‘á»§ Ä‘á»ƒ xá»­ lÃ½
    [2] CÃ³ nhiá»u cÃ¡ch hiá»ƒu khÃ¡c nhau
    [3] Cáº§n xÃ¡c nháº­n trÆ°á»›c khi thá»±c hiá»‡n hÃ nh Ä‘á»™ng cÃ³ rá»§i ro
    [4] Confidence Score dÆ°á»›i 70%

## 9.3. CÆ¡ cháº¿ Rollback

    Náº¿u á»Ÿ Phase N phÃ¡t hiá»‡n lá»—i tá»« Phase M (M < N):
    [1] Ghi nháº­n lá»—i vÃ  nguyÃªn nhÃ¢n
    [2] ThÃ´ng bÃ¡o ngÆ°á»i dÃ¹ng vá» viá»‡c quay láº¡i
    [3] Quay láº¡i Phase M vÃ  sá»­a lá»—i
    [4] Tiáº¿p tá»¥c láº¡i tá»« Phase M

================================================================================
                               Káº¾T THÃšC TÃ€I LIá»†U
================================================================================
PhiÃªn báº£n: 2.0
NgÃ y táº¡o: 2026-02-09
TÃ¡c giáº£: VÅ© ThÆ°Æ¡ng Háº£i (vá»›i sá»± há»— trá»£ cá»§a AI Agent)
================================================================================

```
