# class-diagram-analyst â€” Implementation Plan

> Generated by: Skill Planner (skill-planner)
> Date: 2026-02-20
> Status: ğŸŸ¢ READY â€” Resources Ä‘áº§y Ä‘á»§, Builder cÃ³ thá»ƒ khá»Ÿi Ä‘á»™ng

---

## âš ï¸ RESOURCE GATE ALERT

## âœ… RESOURCE GATE: ÄÃƒ VÆ¯á»¢T QUA

**Audit ngÃ y 2026-02-20**: Sau quÃ¡ trÃ¬nh kiá»ƒm tra vÃ  bá»• sung:
- âœ… `resources/payload-types.md` â€” ÄÃ£ táº¡o (Ã³ whitelist, constraints, YAML examples)
- âœ… `resources/mermaid-rules.md` â€” ÄÃ£ táº¡o (syntax, arrows, anti-patterns)
- âœ… `resources/mongodb-patterns.md` â€” ÄÃ£ táº¡o (Decision Tree, Computed, Polymorphic)
- âœ… `Docs/life-2/diagrams/er-diagram.md` â€” ÄÃ£ xÃ¡c nháº­n tá»“n táº¡i vÃ  Ä‘áº§y Ä‘á»§
- âœ… `Docs/life-2/diagrams/UseCase/` â€” ÄÃ£ xÃ¡c nháº­n (8 files: m1â†’m6)
- âœ… `Docs/life-2/diagrams/activity-diagrams/` â€” ÄÃ£ xÃ¡c nháº­n (24+ files: m1â†’m6)

**Káº¿t luáº­n**: **Builder cÃ³ thá»ƒ khá»Ÿi Ä‘á»™ng ngay.** Táº¥t cáº£ tÃ i nguyÃªn Domain (â¬œ Critical) Ä‘á»u sáºµn sÃ ng.

---

## 1. Pre-requisites

| # | Knowledge / Resource | Tier | Má»¥c Ä‘Ã­ch | Trace | Status |
|---|---------------------|------|----------|-------|--------|
| P1 | `resources/payload-types.md` â€” Field type whitelist + allowed constraints + Payload config keys | Domain | Builder cáº§n biáº¿t type nÃ o há»£p lá»‡ trÆ°á»›c khi gÃ¡n type cho field trong YAML Contract | [Tá»ª DESIGN Â§2.1, Â§3] | âœ… Ready |
| P2 | `resources/mermaid-rules.md` â€” classDiagram syntax, arrow conventions, stereotype labels | Domain | Builder cáº§n gen Mermaid chÃ­nh xÃ¡c theo whitelist syntax, trÃ¡nh R4 (lá»—i syntax) | [Tá»ª DESIGN Â§2.1, Â§8 R4] | âœ… Ready |
| P3 | `resources/mongodb-patterns.md` â€” Aggregate Root decision, Embed vs Reference, Computed Pattern, Polymorphic Pattern | Domain | Builder cáº§n biáº¿t quyáº¿t Ä‘á»‹nh Aggregate Root / Embedded lÃ  cÃ³ nguyÃªn táº¯c rÃµ rÃ ng, trÃ¡nh R3 (nháº§m láº«n Embed vs Root) | [Tá»ª DESIGN Â§2.1, Â§5.3] | âœ… Ready |
| P4 | `Docs/life-2/diagrams/er-diagram.md` â€” Entity Dictionary Ä‘áº§y Ä‘á»§ cho 15 entities | Domain | Nguá»“n chÃ¢n lÃ½ (ground truth) cho má»i field â€” má»i field pháº£i cÃ³ `source:` trá» vá» file nÃ y | [Tá»ª DESIGN Â§1, Â§2.1, Appendix A] | âœ… Confirmed |
| P5 | `Docs/life-2/diagrams/UseCase/use-case-m*.md` â€” Access rules per actor (M1â†’M6, Ä‘á»§ 8 files) | Domain | Phase B Cross-Reference cáº§n grepping access rules (CRUD permissions) cho tá»«ng module | [Tá»ª DESIGN Â§2.1, Â§2.2 Phase B] | âœ… Confirmed (8 files: m1â†’m6) |
| P6 | `Docs/life-2/diagrams/activity-diagrams/m*-a*.md` â€” Behaviors, hooks, lifecycle (M1â†’M6, Ä‘á»§ 24 files + summaries) | Domain | Phase B Cross-Reference cáº§n tÃ¬m behaviors/hooks trong activity diagrams | [Tá»ª DESIGN Â§2.1, Â§2.2 Phase B] | âœ… Confirmed (24+ files: m1â†’m6) |
| P7 | Mermaid classDiagram Official Docs | Technical | Hiá»ƒu syntax há»£p lá»‡ Ä‘á»ƒ Builder viáº¿t mermaid-rules.md Ä‘Ãºng | [Tá»ª DESIGN Â§2.1] | â“ External source |
| P8 | PayloadCMS v3 Field Types Official Docs | Technical | Hiá»ƒu field types há»£p lá»‡ Ä‘á»ƒ Builder viáº¿t payload-types.md Ä‘Ãºng | [Tá»ª DESIGN Â§2.1] | â“ External source |
| P9 | MongoDB Design Patterns Reference | Technical | Hiá»ƒu Aggregate Root / Embedded patterns Ä‘á»ƒ Builder viáº¿t mongodb-patterns.md Ä‘Ãºng | [Tá»ª DESIGN Â§2.1, Â§5.3] | â“ External source |
| P10 | `data/module-map.yaml` â€” Entity list per module (M1â†’M6) | Packaging | Builder cáº§n data nÃ y Ä‘á»ƒ extract_entities.py biáº¿t module nÃ o cÃ³ entity nÃ o | [Tá»ª DESIGN Â§3, Â§7] | â¬œ Missing (cáº§n táº¡o tá»« Appendix A) |
| P11 | `data/allowed-types.json` â€” Whitelist field types | Packaging | validate_contract.py cáº§n file nÃ y Ä‘á»ƒ check type trong Phase F | [Tá»ª DESIGN Â§3, Â§7] | â¬œ Missing (cáº§n táº¡o tá»« resources/payload-types.md) |

---

## 2. Phase Breakdown

### â›” Phase 0: Chuáº©n bá»‹ TÃ i nguyÃªn (RESOURCE PREPARATION)
> **Äiá»u kiá»‡n**: PHáº¢I hoÃ n thÃ nh toÃ n bá»™ Phase nÃ y trÆ°á»›c khi khá»Ÿi Ä‘á»™ng Phase 1.
> Háº§u háº¿t tasks dÆ°á»›i Ä‘Ã¢y lÃ  **táº¡o/náº¡p tÃ i liá»‡u knowledge vÃ o `resources/`**.

- [x] **Task 0.1**: Soáº¡n tháº£o `resources/payload-types.md` â€” Ä‘Ã£ hoÃ n thÃ nh (whitelist, constraints, YAML snippets, anti-patterns). [Tá»ª AUDIT TÃ€I NGUYÃŠN]
- [x] **Task 0.2**: Soáº¡n tháº£o `resources/mermaid-rules.md` â€” Ä‘Ã£ hoÃ n thÃ nh (visibility, arrows, stereotypes, anti-patterns, v10+ features). [Tá»ª AUDIT TÃ€I NGUYÃŠN]
- [x] **Task 0.3**: Soáº¡n tháº£o `resources/mongodb-patterns.md` â€” Ä‘Ã£ hoÃ n thÃ nh (Decision Tree, Computed, Polymorphic, Unique, Append-Only, KLTN entity table). [Tá»ª AUDIT TÃ€I NGUYÃŠN]
- [x] **Task 0.4**: XÃ¡c nháº­n `Docs/life-2/diagrams/er-diagram.md` â€” âœ… Tá»“n táº¡i, cÃ³ Entity Dictionary Ä‘áº§y Ä‘á»§ cho toÃ n bá»™ entities (USERS, POSTS, COMMENTS, LIKES, SHARES, CONNECTIONS, TAGS, MEDIA, BOOKMARKS...). [Tá»ª DESIGN Â§1, Appendix A]
- [x] **Task 0.5**: XÃ¡c nháº­n tá»“n táº¡i cá»§a `UseCase/` (8 files m1â†’m6) vÃ  `activity-diagrams/` (24+ files m1â†’m6). âœ… Äáº§y Ä‘á»§. [Tá»ª DESIGN Â§2.1]

---

### Phase 1: Foundation â€” Cáº¥u trÃºc thÆ° má»¥c
> **Äiá»u kiá»‡n khá»Ÿi Ä‘á»™ng**: Phase 0 hoÃ n thÃ nh (resources/ Ä‘Ã£ Ä‘Æ°á»£c náº¡p Ä‘á»§ 3 files).

- [ ] **Task 1.1**: Táº¡o cáº¥u trÃºc thÆ° má»¥c Ä‘áº§y Ä‘á»§ theo design.md Â§3 vÃ  Â§4:
  ```
  .agent/skills/class-diagram-analyst/
  â”œâ”€â”€ SKILL.md
  â”œâ”€â”€ knowledge/
  â”œâ”€â”€ scripts/
  â”œâ”€â”€ templates/
  â”œâ”€â”€ data/
  â””â”€â”€ loop/
      â””â”€â”€ test-cases/
  ```
  [Tá»ª DESIGN Â§3, Â§4]

- [ ] **Task 1.2**: Táº¡o `data/module-map.yaml` â€” map Ä‘áº§y Ä‘á»§ 6 modules â†’ entities, láº¥y tá»« Appendix A cá»§a design.md. Cáº¥u trÃºc: `M1: {name: "Auth & Profile", entities: [users]}, M2: {entities: [posts, media, tags, post_tags, post_media]}, ...`.
  - Ghi chÃº Ä‘áº·c biá»‡t: **M3 = `FeedQuery` value object** (khÃ´ng pháº£i Root, khÃ´ng cÃ³ collection riÃªng â€” cháº¯t theo Q4 Option B). Module-map pháº£i cÃ³ field `type: value_object` cho M3.
  - `post_tags` vÃ  `post_media`: **Embedded trong Post** (cháº¯t theo Q5), ghi `embed_in: posts` trong module-map.
  - `shares`: provisional `[ASSUMPTION]`.
  [Tá»ª DESIGN Â§4 data/module-map.yaml, Appendix A] [CHá»T Q4-B] [CHá»T Q5]

- [x] **Task 1.3**: Táº¡o `data/default-types.json` â€” **built-in defaults bundled trong skill**, Ä‘áº£m báº£o skill hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p khi khÃ´ng cÃ³ `shared-types.json`. Ná»™i dung: `allowed_field_types`, `mermaid_type_map`, `aggregate_root_patterns`, `access_control_actors`, `lifecycle_hooks`. âœ… ÄÃ£ táº¡o táº¡i `.agent/skills/class-diagram-analyst/data/default-types.json`. [Gá»¢I Ã Bá»” SUNG] [CHá»T Q6-SHARED]

- [ ] **Task 1.4**: Táº¡o `scripts/type_resolver.py` â€” **Type Resolver vá»›i 3-layer fallback**: (Ä‘á»™c láº­p vá»›i má»i project)
  ```
  Layer 1 (Project-override): {project_root}/data/project-types.json   â† do tá»«ng dá»± Ã¡n tá»± Ä‘á»‹nh nghÄ©a
  Layer 2 (Shared-KLTN):      .skill-context/shared/shared-types.json  â† KLTN-specific
  Layer 3 (Built-in default): data/default-types.json                  â† luÃ´n cÃ³ trong skill
  ```
  Logic: Resolver kiá»ƒm tra tá»«ng layer theo thá»© tá»±. Náº¿u layer nÃ o tá»“n táº¡i â†’ dÃ¹ng vÃ  dá»«ng. Náº¿u khÃ´ng â†’ xuá»‘ng layer tiáº¿p theo. Layer 3 luÃ´n tá»“n táº¡i â†’ **khÃ´ng bao giá» bá»‹ lá»—i**.
  API: `resolve_types(project_root=None) -> dict` â€” dÃ¹ng cháº¿ bá»Ÿi cÃ¡c scripts khÃ¡c.
  [Gá»¢I Ã Bá»” SUNG] [PORTABLE]

---

### Phase 2: Core â€” SKILL.md
> **Äiá»u kiá»‡n**: Phase 1 hoÃ n thÃ nh.

- [ ] **Task 2.1**: Viáº¿t `SKILL.md` â€” Persona: **"Class Structure Analyst"** â€” TÃ´i lÃ  chuyÃªn gia phÃ¢n tÃ­ch cáº¥u trÃºc class diagram theo chuáº©n dual-format (Mermaid + YAML Contract) cho PayloadCMS / MongoDB. TÃ´i KHÃ”NG bao giá» tá»± bá»‹a field mÃ  khÃ´ng cÃ³ `source:` citation. [Tá»ª DESIGN Â§2.1 Persona, Â§2.3 Guardrails]

- [ ] **Task 2.2**: Viáº¿t **Mandatory Boot Sequence** vÃ o SKILL.md â€” liá»‡t kÃª 5 files báº¯t buá»™c Ä‘á»c khi khá»Ÿi Ä‘á»™ng theo design.md Â§7 (Progressive Disclosure Táº§ng 1):
  1. `SKILL.md` â€” luÃ´n Ä‘áº§u tiÃªn
  2. `knowledge/payload-types.md` â€” field type whitelist
  3. `knowledge/mongodb-patterns.md` â€” Aggregate Root rules
  4. `data/module-map.yaml` â€” module â†’ entity mapping
  5. `loop/checklist.md` â€” validation rules
  [Tá»ª DESIGN Â§7 Táº§ng 1]

- [ ] **Task 2.3**: Viáº¿t **Phase 0 â€” Input Resolution** vÃ o SKILL.md â€” xá»­ lÃ½ 5 loáº¡i input (Â§0.1), Input Resolution Flowchart (Â§0.2), File Context Rules (Â§0.3), vÃ  IP0 Gate (Â§0.4). Builder pháº£i implement Ä‘áº§y Ä‘á»§ IP0 logic (phÃ¢n loáº¡i input trÆ°á»›c khi lÃ m báº¥t cá»© Ä‘iá»u gÃ¬ khÃ¡c). [Tá»ª DESIGN Â§0]

- [ ] **Task 2.4**: Viáº¿t **Phase A â†’ Phase F** vÃ o SKILL.md â€” 6 phases vá»›i Ä‘áº§y Ä‘á»§ trigger, action, vÃ  gate conditions. Má»—i phase pháº£i cÃ³: (a) Ä‘iá»u kiá»‡n Ä‘áº§u vÃ o (input), (b) action tÆ°á»ng minh, (c) Ä‘iá»u kiá»‡n chuyá»ƒn phase. Äáº·c biá»‡t chÃº Ã½ gating: IP1 sau Phase C, IP2 sau Phase D, IP3 sau Phase F. [Tá»ª DESIGN Â§2.2, Â§5.1, Â§5.2]

- [ ] **Task 2.5**: Viáº¿t **7 Guardrails** vÃ o SKILL.md â€” compile tá»« design.md Â§2.3, Ä‘áº£m báº£o má»—i guardrail cÃ³: (a) rule rÃµ rÃ ng, (b) hÃ nh Ä‘á»™ng vi pháº¡m, (c) consequence (BLOCK hoáº·c Alert). [Tá»ª DESIGN Â§2.3]

- [ ] **Task 2.6**: Viáº¿t **Interaction Points specification** vÃ o SKILL.md â€” IP0, IP1, IP2, IP3 theo design.md Â§6. Má»—i IP pháº£i ghi rÃµ: thá»i Ä‘iá»ƒm kÃ­ch hoáº¡t, ná»™i dung trÃ¬nh bÃ y cho user, vÃ  hÃ nh Ä‘á»™ng káº¿ tiáº¿p theo tá»«ng káº¿t quáº£ (confirm/adjust). Bá»• sung rule báº¥t biáº¿n: "KhÃ´ng bá» qua Interaction Point". [Tá»ª DESIGN Â§6]

---

### Phase 3: Knowledge â€” Táº§ng tri thá»©c
> **Äiá»u kiá»‡n**: Phase 2 hoÃ n thÃ nh. Resources/ Ä‘Ã£ Ä‘Æ°á»£c náº¡p á»Ÿ Phase 0.

- [ ] **Task 3.1**: Táº¡o `knowledge/payload-types.md` â€” **Transform 100%** ná»™i dung tá»« `resources/payload-types.md`. File pháº£i bao gá»“m: (a) báº£ng field types whitelist kÃ¨m kÃ½ hiá»‡u Mermaid tÆ°Æ¡ng Ä‘Æ°Æ¡ng, (b) constraint rules (unique, indexed, required), (c) vÃ­ dá»¥ YAML Contract snippet cho tá»«ng type. KhÃ´ng Ä‘Æ°á»£c tÃ³m táº¯t hoáº·c lÆ°á»£c bá». [Tá»ª DESIGN Â§3 knowledge/]

- [ ] **Task 3.2**: Táº¡o `knowledge/mermaid-rules.md` â€” **Transform 100%** ná»™i dung tá»« `resources/mermaid-rules.md`. File pháº£i bao gá»“m: (a) classDiagram declaration syntax, (b) visibility modifiers (`+`, `-`, `#`, `~`), (c) relationship arrows vÃ  Ã½ nghÄ©a tá»«ng loáº¡i, (d) stereotype labels, (e) danh sÃ¡ch syntax PHáº¢I TRÃNH (unsupported). [Tá»ª DESIGN Â§3 knowledge/]

- [ ] **Task 3.3**: Táº¡o `knowledge/mongodb-patterns.md` â€” **Transform 100%** ná»™i dung tá»« `resources/mongodb-patterns.md`. File pháº£i bao gá»“m: (a) Decision Tree Ä‘áº§y Ä‘á»§ 4 cÃ¢u há»i (y/n) Ä‘á»ƒ phÃ¢n loáº¡i Root vs Embedded, (b) khi nÃ o dÃ¹ng Computed Pattern (counter denormalization), (c) Polymorphic Pattern vá»›i vÃ­ dá»¥ tá»« `notifications` entity. [Tá»ª DESIGN Â§3 knowledge/]

---

### Phase 4: Scripts â€” CÃ´ng cá»¥ tá»± Ä‘á»™ng
> **Äiá»u kiá»‡n**: Phase 3 hoÃ n thÃ nh.

- [ ] **Task 4.1**: Táº¡o `scripts/extract_entities.py` â€” script nháº­n `--module M1` (hoáº·c tÃªn module), Ä‘á»c `data/module-map.yaml` Ä‘á»ƒ láº¥y entity list, sau Ä‘Ã³ parse `er-diagram.md` Ä‘á»ƒ extract Ä‘áº§y Ä‘á»§: entity name, fields (name + type + constraints), relationships. **DÃ¹ng `re` module (built-in Python)** Ä‘á»ƒ parse Markdown â€” khÃ´ng cáº§n install thÆ° viá»‡n ngoÃ i. **Import `type_resolver.resolve_types()`** Ä‘á»ƒ láº¥y allowed types. Output: JSON hoáº·c YAML stdout. [Tá»ª DESIGN Â§4 scripts/extract_entities.py] [CHá»T SCRIPT] [PORTABLE]

- [ ] **Task 4.2**: Táº¡o `scripts/validate_contract.py` â€” script nháº­n Ä‘Æ°á»ng dáº«n YAML Contract + tÃ¹y chá»n `--project-root`. **Import `type_resolver.resolve_types(project_root)`** Ä‘á»ƒ láº¥y whitelist â€” hoáº¡t Ä‘á»™ng á»Ÿ má»i project. Kiá»ƒm tra 3 Ä‘iá»u kiá»‡n: (a) má»i field cÃ³ `source:` khÃ´ng rá»—ng, (b) field type náº±m trong whitelist, (c) khÃ´ng cÃ³ duplicate `slug`. **DÃ¹ng `PyYAML`**. Output: PASS/FAIL + violations. [Tá»ª DESIGN Â§4] [CHá»T SCRIPT] [PORTABLE]

- [ ] **Task 4.3**: Táº¡o `scripts/generate_yaml.py` â€” script Ä‘á»c `class-mX.md` (Mermaid + Traceability Table) vÃ  convert sang YAML Contract format theo `templates/contract.yaml.template`. **DÃ¹ng `PyYAML`** (`yaml.dump()`) Ä‘á»ƒ serialize output â€” Ä‘áº£m báº£o `default_flow_style=False` Ä‘á»ƒ giá»¯ block style. Ghi header comment `âš ï¸ LOCKED CONTRACT`. [Tá»ª DESIGN Â§4 scripts/generate_yaml.py, Appendix B] [CHá»T SCRIPT]

- [ ] **Task 4.4**: ThÃªm `scripts/requirements.txt` â€” liá»‡t kÃª dependency cáº§n thiáº¿t:
  ```
  pyyaml>=6.0
  ```
  vÃ  ghi hÆ°á»›ng dáº«n install vÃ o README hoáº·c comment Ä‘áº§u má»i script. [Gá»¢I Ã Bá»” SUNG] [CHá»T SCRIPT]

---

### Phase 5: Templates â€” KhuÃ´n máº«u output
> **Äiá»u kiá»‡n**: Phase 4 hoÃ n thÃ nh (scripts/ Ä‘Ã£ cÃ³).

- [ ] **Task 5.1**: Táº¡o `templates/class-module.md.template` â€” template Ä‘áº§y Ä‘á»§ cho file Markdown output, gá»“m: (a) Mermaid `classDiagram` block vá»›i placeholder entities, (b) Traceability Table (field â†’ source citation â†’ assumption flag), (c) Assumption Register section. Template pháº£i cÃ³ placeholder markers rÃµ rÃ ng (e.g., `{{MODULE_NAME}}`, `{{ENTITY_SLUG}}`). [Tá»ª DESIGN Â§4 templates/, Appendix B]

- [ ] **Task 5.2**: Táº¡o `templates/contract.yaml.template` â€” template YAML Contract theo format chuáº©n trong design.md Appendix B Â§YAML Contract Format. Bao gá»“m Ä‘áº§y Ä‘á»§: `meta`, `entities`, `behaviors`, `access_control`, `validation_report`. [Tá»ª DESIGN Â§4 templates/, Appendix B]

---

### Phase 6: Loop â€” Kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng
> **Äiá»u kiá»‡n**: Phase 5 hoÃ n thÃ nh.

- [ ] **Task 6.1**: Táº¡o `loop/checklist.md` â€” danh sÃ¡ch validation rule cho Builder tá»± kiá»ƒm tra sau má»—i entity. Gá»“m: (a) Per-field citation check, (b) Type validity check (Ä‘á»‘i chiáº¿u allowed-types.json), (c) No duplicate slug, (d) Aggregate Root phÃ¢n loáº¡i Ä‘Ãºng decision tree, (e) YAML Contract header cÃ³ "LOCKED" comment. [Tá»ª DESIGN Â§3 loop/, Â§2.3]

- [ ] **Task 6.2**: Táº¡o `loop/phase-verify.md` â€” checklist per-phase cho Builder verify sau má»—i trong 7 phases (Phase 0â†’F). Má»—i phase cÃ³ checkbox riÃªng: "Phase A done? â†’ entity list extracted", "IP1 confirmed? â†’ user approved", v.v. [Tá»ª DESIGN Â§3 loop/, Â§4 loop/phase-verify.md]

- [ ] **Task 6.3**: Táº¡o `loop/test-cases/m1-test.md` â€” test case cá»¥ thá»ƒ cho Module M1 (Auth & Profile): (a) Input máº«u "Váº½ class diagram M1", (b) Expected entity list (users vá»›i cÃ¡c fields tá»« ER), (c) Expected YAML Contract snippet, (d) Expected Mermaid output snippet. [Tá»ª DESIGN Â§3 loop/test-cases/]

- [ ] **Task 6.4**: Táº¡o `loop/test-cases/validate-contract-test.md` â€” test case cho validate_contract.py: (a) YAML há»£p lá»‡ â†’ expected PASS, (b) YAML cÃ³ field thiáº¿u source â†’ expected FAIL with violation list, (c) YAML cÃ³ type khÃ´ng há»£p lá»‡ â†’ expected FAIL. [Tá»ª DESIGN Â§3 loop/test-cases/]

---

### Phase 7: Index & Output Setup â€” Chuáº©n bá»‹ output directory
> **Äiá»u kiá»‡n**: Phase 6 hoÃ n thÃ nh.

- [ ] **Task 7.1**: Táº¡o `Docs/life-2/diagrams/class-diagrams/index.md` theo format chuáº©n Appendix B Â§index.md Routing Table. Táº¥t cáº£ modules (M1â†’M6) Ä‘á»u á»Ÿ tráº¡ng thÃ¡i `â³ Pending`. [Tá»ª DESIGN Appendix B]

- [ ] **Task 7.2**: Táº¡o thÆ° má»¥c output per-module: `m1-auth-profile/`, `m2-content-engine/`, `m3-discovery-feed/`, `m4-engagement/`, `m5-bookmarking/`, `m6-notifications-moderation/`. Má»—i thÆ° má»¥c cÃ³ file placeholder `.gitkeep` hoáº·c README ngáº¯n mÃ´ táº£ má»¥c Ä‘Ã­ch. [Tá»ª DESIGN Appendix B]

---

## 3. Knowledge & Resources Needed

| # | TÃ i liá»‡u | Má»¥c Ä‘Ã­ch | Tráº¡ng thÃ¡i |
|---|----------|----------|-----------|
| K1 | `resources/payload-types.md` | Nguá»“n domain cho Builder viáº¿t `knowledge/payload-types.md` | âœ… Ready |
| K2 | `resources/mermaid-rules.md` | Nguá»“n domain cho Builder viáº¿t `knowledge/mermaid-rules.md` | âœ… Ready |
| K3 | `resources/mongodb-patterns.md` | Nguá»“n domain cho Builder viáº¿t `knowledge/mongodb-patterns.md` | âœ… Ready |
| K4 | `Docs/life-2/diagrams/er-diagram.md` | Primary input source â€” ground truth cho má»i entity/field | âœ… Confirmed |
| K5 | `Docs/life-2/diagrams/UseCase/use-case-m*.md` (8 files) | Cross-reference access rules cho Phase B | âœ… Confirmed |
| K6 | `Docs/life-2/diagrams/activity-diagrams/m*-a*.md` (24+ files) | Cross-reference behaviors/hooks cho Phase B | âœ… Confirmed |
| K7 | Mermaid classDiagram Docs (external) | Technical reference Ä‘á»ƒ soáº¡n mermaid-rules.md | â“ External |
| K8 | PayloadCMS v3 Official Docs (external) | Technical reference Ä‘á»ƒ soáº¡n payload-types.md | â“ External |
| K9 | MongoDB Design Patterns (external) | Technical reference Ä‘á»ƒ soáº¡n mongodb-patterns.md | â“ External |
| K10 | `design.md` Â§Appendix A â€” Entity Inventory | Pre-classified entity list dÃ¹ng Ä‘á»ƒ táº¡o module-map.yaml | âœ… Available |
| K11 | `design.md` Â§Appendix B â€” File Output Spec | YAML Contract format + index.md format | âœ… Available |

---

## 4. Definition of Done

### âœ… Resources Gate (PHáº¢I PASS trÆ°á»›c khi Builder cháº¡y)
- [ ] `resources/payload-types.md` tá»“n táº¡i vÃ  cÃ³ ná»™i dung Ä‘áº§y Ä‘á»§ (field types, constraints, examples)
- [ ] `resources/mermaid-rules.md` tá»“n táº¡i vÃ  cÃ³ ná»™i dung Ä‘áº§y Ä‘á»§ (syntax, arrows, anti-patterns)
- [ ] `resources/mongodb-patterns.md` tá»“n táº¡i vÃ  cÃ³ ná»™i dung Ä‘áº§y Ä‘á»§ (decision tree, Aggregate Root, Embedded)
- [ ] `Docs/life-2/diagrams/er-diagram.md` Ä‘Æ°á»£c xÃ¡c nháº­n tá»“n táº¡i vÃ  cÃ³ Entity Dictionary cho 15 entities
- [ ] `Docs/life-2/diagrams/UseCase/` vÃ  `activity-diagrams/` Ä‘Æ°á»£c xÃ¡c nháº­n tá»“n táº¡i

### âœ… Structure Gate (7-Zone Architecture)
- [ ] Cáº¥u trÃºc thÆ° má»¥c Ä‘Ãºng 7-Zone: `SKILL.md`, `knowledge/`, `scripts/`, `templates/`, `data/`, `loop/`
- [ ] `data/allowed-types.json` cÃ³ whitelist há»£p lá»‡
- [ ] `data/module-map.yaml` Ä‘á»§ 6 modules vá»›i entity list tá»« Appendix A

### âœ… Core Gate
- [ ] `SKILL.md` cÃ³ Ä‘áº§y Ä‘á»§: Persona, Phase 0 (Input Resolution), Phase Aâ†’F, 3 Interaction Points, 7 Guardrails, Progressive Disclosure plan
- [ ] IP0, IP1, IP2, IP3 Ä‘Æ°á»£c implement Ä‘Ãºng thá»© tá»± â€” khÃ´ng cÃ³ bÆ°á»›c nÃ o bá»‹ bá» qua

### âœ… Knowledge Gate
- [ ] `knowledge/payload-types.md` â€” transform 100% tá»« resources/ (khÃ´ng tÃ³m táº¯t)
- [ ] `knowledge/mermaid-rules.md` â€” transform 100% tá»« resources/ (khÃ´ng tÃ³m táº¯t)
- [ ] `knowledge/mongodb-patterns.md` â€” transform 100% tá»« resources/ (khÃ´ng tÃ³m táº¯t)

### âœ… Scripts Gate
- [ ] `extract_entities.py` cháº¡y Ä‘Æ°á»£c vá»›i `--module M1`, output entity list + fields
- [ ] `validate_contract.py` cháº¡y Ä‘Æ°á»£c vá»›i YAML path, output PASS/FAIL + violations
- [ ] `generate_yaml.py` cháº¡y Ä‘Æ°á»£c vá»›i `.md` path, output YAML Contract cÃ³ header comment

### âœ… Loop Gate
- [ ] `loop/checklist.md` cÃ³ Ä‘á»§ 5 checks (citation, type, slug, root-classification, header)
- [ ] `loop/phase-verify.md` cÃ³ checklist cho táº¥t cáº£ 7 phases
- [ ] `loop/test-cases/m1-test.md` cÃ³ test input + expected output
- [ ] `loop/test-cases/validate-contract-test.md` cÃ³ test PASS + FAIL cases

### âœ… Output Setup Gate
- [ ] `Docs/life-2/diagrams/class-diagrams/index.md` tá»“n táº¡i vá»›i 6 modules tráº¡ng thÃ¡i Pending
- [ ] 6 thÆ° má»¥c output per-module Ä‘Æ°á»£c táº¡o

---

## 5. Notes

### âœ… [CHá»T Q4] Q4 â€” M3 Discovery Feed: Chá»n Option B
`design.md Â§9 Q4`: **Quyáº¿t Ä‘á»‹nh chÃ­nh thá»©c: Option B â€” Táº¡o `FeedQuery` value object cho M3.**

- M3 khÃ´ng cÃ³ collection riÃªng trong MongoDB.
- `FeedQuery` lÃ  **value object** (khÃ´ng cÃ³ `id`, khÃ´ng pháº£i Aggregate Root) â€” chá»‰ mÃ´ táº£ query params vÃ  feed assembly logic.
- `class-m3-discovery-feed.md` váº«n Ä‘Æ°á»£c táº¡o nhÆ°ng stereotype lÃ  `<<ValueObject>>` thay vÃ¬ `<<Collection>>`.
- `module-map.yaml` ghi: `M3: {type: value_object, entities: [FeedQuery], note: "No MongoDB collection. Query strategy only."}`

**áº¢nh hÆ°á»Ÿng**: Task 1.2 Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»ƒ pháº£n Ã¡nh M3 = value_object. Template cho M3 sá»­ dá»¥ng snippet `<<ValueObject>>` Ä‘áº·c biá»‡t.

---

### âœ… [CHá»T Q5] Q5 â€” post_tags vÃ  post_media: Chá»n Embedded
`design.md Â§9 Q5`: **Quyáº¿t Ä‘á»‹nh chÃ­nh thá»©c: `post_tags` vÃ  `post_media` lÃ  Embedded Document trong `Post`.**

- `post_tags`: Liá»‡t kÃª dÆ°á»›i dáº¡ng `Post.tags[]` â€” lÆ°u ObjectId[] cá»§a `tags` collection.
- `post_media`: Liá»‡t kÃª dÆ°á»›i dáº¡ng `Post.mediaItems[]` â€” lÆ°u ObjectId[] cá»§a `media` collection.
- KhÃ´ng táº¡o Payload Collection riÃªng cho 2 entity nÃ y.

**áº¢nh hÆ°á»Ÿng**: Task 1.2 Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t: `post_tags`, `post_media` ghi `embed_in: posts` trong module-map.yaml. `extract_entities.py` sá»­ khÃ´ng kÃ­ch hoáº¡t Phase-A cho 2 entity nÃ y.

---

### âœ… [CHá»T Q6] Q6 â€” Shared knowledge giá»¯a Skill 2.5 vÃ  2.6: Chá»n **Shared**
`design.md Â§9 Q6`: **Quyáº¿t Ä‘á»‹nh chÃ­nh thá»©c: DÃ¹ng `shared-types.json` dÃ¹ng chung â€” Ä‘áº·t táº¡i `.skill-context/shared/shared-types.json`.**

- âœ… File Ä‘Ã£ Ä‘Æ°á»£c táº¡o táº¡i `.skill-context/shared/shared-types.json`
- Ná»™i dung: `allowed_field_types`, `mermaid_type_map`, `aggregate_root_patterns`, `access_control_actors`, `lifecycle_hooks`, `module_registry`
- `class-diagram-analyst`: cÃ¡c scripts Ä‘á»c `allowed_field_types` tá»« shared file
- `schema-design-analyst` (Skill 2.6): dÃ¹ng chung file nÃ y khi cáº§n validate types
- Task 1.3 Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t â€” khÃ´ng táº¡o `data/allowed-types.json` riÃªng ná»¯a.

---

### [GIá»¬ NGUYÃŠN] Thá»© tá»± náº¡p resources
Builder nÃªn thá»±c hiá»‡n Phase 0 theo thá»© tá»±: 0.3 (MongoDB) â†’ 0.2 (Mermaid) â†’ 0.1 (Payload) vÃ¬ MongoDB patterns lÃ  ná»n táº£ng Ä‘á»ƒ hiá»ƒu khi nÃ o cáº§n field type gÃ¬ trong Payload.

---

### âœ… [CHá»T SCRIPT] Script language choice â€” ÄÃ£ bá»• sung vÃ o Phase 4
Quyáº¿t Ä‘á»‹nh Ä‘Æ°á»£c cháº¯t vÃ  bá»• sung trá»±c tiáº¿p vÃ o cÃ¡c task:

| Script | ThÆ° viá»‡n | Ghi chÃº |
|--------|----------|--------|
| `extract_entities.py` | `re` (built-in) | Parse Markdown â€” khÃ´ng cáº§n install |
| `validate_contract.py` | `PyYAML` (`pip install pyyaml`) | Parse YAML Contract |
| `generate_yaml.py` | `PyYAML` (`yaml.dump(default_flow_style=False)`) | Generate block-style YAML |
| `requirements.txt` | `pyyaml>=6.0` | Task 4.4 Ä‘Ã£ bá»• sung |

---

**Tá»•ng sá»‘ tasks**: 21 tasks (Phase 0: 5 âœ”, Phase 1: 3, Phase 2: 6, Phase 3: 3, Phase 4: **4**, Phase 5: 2, Phase 6: 4, Phase 7: 2)
**Quyáº¿t Ä‘á»‹nh Ä‘Ã£ cháº¯t**: Q4 (Option B â€” FeedQuery), Q5 (Embedded), Q6 (Separate skills), Script (PyYAML + re)
**Blockers cÃ²n láº¡i**: KhÃ´ng cÃ³ â€” Builder cÃ³ thá»ƒ khá»Ÿi Ä‘á»™ng ngay tá»« Phase 1.
