# schema-design-analyst â€” Architecture Design

> Generated by Skill Architect | Date: 2026-02-20
> Status: ğŸ”µ IN PROGRESS

---

## 0. Input Mechanism

> **CÆ¡ cháº¿ Input Data**: Skill nháº­n yÃªu cáº§u thiáº¿t káº¿ Schema báº¥t ká»³ tá»« ngÆ°á»i dÃ¹ng, tá»± Ä‘á»™ng phÃ¢n tÃ­ch vÃ  tÃ¬m kiáº¿m file Contract YAML tÆ°Æ¡ng á»©ng (do Task 2.5 sinh ra) Ä‘á»ƒ lÃ m context tuyá»‡t Ä‘á»‘i.

### 0.1 Input Types Ä‘Æ°á»£c cháº¥p nháº­n

| Loáº¡i Input | VÃ­ dá»¥ | Skill xá»­ lÃ½ tháº¿ nÃ o |
|-----------|-------|--------------------|
| **YÃªu cáº§u module rÃµ rÃ ng** | "Thiáº¿t káº¿ schema cho M1 Auth" | Map sang YAML contract cá»§a M1 â†’ Äá»c vÃ  cháº¡y tháº³ng |
| **YÃªu cáº§u theo chá»©c nÄƒng chÆ°a rÃµ** | "Thiáº¿t káº¿ database cho pháº§n User Ä‘Äƒng nháº­p" | PhÃ¢n tÃ­ch chá»©c nÄƒng â†’ TrÃ­ch xuáº¥t module M1 â†’ TÃ¬m YAML M1 tÆ°Æ¡ng á»©ng â†’ Chá» Confirm |
| **YÃªu cáº§u mÆ¡ há»“** | "Cáº§n xÃ¢y dá»±ng data schema" | PhÃ¢n tÃ­ch intent â†’ Äá» xuáº¥t Scope module â†’ Äá»‹nh vá»‹ YAML file â†’ CHá»œ confirm trÆ°á»›c khi lÃ m |
| **YÃªu cáº§u + File tham chiáº¿u** | "Dá»±a vÃ o file activity nÃ y, lÃ m schema M2" | Váº«n Æ°u tiÃªn Ä‘á»c Contract YAML M2 trÆ°á»›c â†’ Cáº­p nháº­t báº±ng file Ä‘Ã­nh kÃ¨m náº¿u há»£p lá»‡ logic DB |

### 0.2 Input Resolution Flow

```mermaid
flowchart TD
    Input([User Input]) --> DetectType{PhÃ¢n tÃ­ch YÃªu cáº§u}
    
    DetectType -->|Module rÃµ rÃ ng| LinkYAML[Map trá»±c tiáº¿p vá»›i YAML contract cá»§a Module]
    DetectType -->|MÆ¡ há»“/Chá»©c nÄƒng| AnalyzeIntent[PhÃ¢n tÃ­ch chá»©c nÄƒng -> TÃ¬m kiáº¿m Module TÆ°Æ¡ng á»©ng]
    
    AnalyzeIntent --> ProposeModule[Äá» xuáº¥t Module Schema cáº§n lÃ m]
    ProposeModule --> IP0{IP0: Confirm Scope & Contract File}
    
    IP0 -->|Confirmed| LinkYAML
    IP0 -->|Denied| DetectType
    
    LinkYAML --> ReadContract[Äá»c file class-mX.yaml (CONTRACT) lÃ m Input]
    ReadContract --> Phase1[Tiáº¿n hÃ nh Phase 1: Translation & Strategy]
```

---

## 1. Problem Statement

**Váº¥n Ä‘á»**: Khi chuyá»ƒn giao tá»« mÃ´ hÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (Class Diagram) sang thá»±c táº¿ lÆ°u trá»¯ váº­t lÃ½ (MongoDB/PayloadCMS), AI Agent dá»… bá»‹ áº£o giÃ¡c (hallucination), thÃªu dá»‡t, tá»± sÃ¡ng táº¡o thÃªm cÃ¡c field hoáº·c xá»­ lÃ½ sai logic embed/reference dáº«n Ä‘áº¿n sá»¥p Ä‘á»• pipeline. Cáº§n má»™t "Kiáº¿n trÃºc sÆ° Data" tÃ n nháº«n, **CHá»ˆ lÃ m viá»‡c dá»±a trÃªn Contract YAML tá»« Skill 2.5** (cÃ¡i gÃ¬ tá»“n táº¡i) vÃ  cÃ¡c Flow Diagrams (dá»¯ liá»‡u Ä‘i tháº¿ nÃ o) Ä‘á»ƒ quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc schema mÃ  khÃ´ng Ä‘Æ°á»£c phÃ©p tá»± biÃªn tá»± diá»…n thÃªm.

**NgÆ°á»i dÃ¹ng**: AI Code Agent á»Ÿ giai Ä‘oáº¡n **Life-3** dÃ¹ng nÃ³ nhÆ° blueprint tuyá»‡t Ä‘á»‘i Ä‘á»ƒ viáº¿t code PayloadCMS collection & MongoDB rules.

**LÃ½ do cáº§n skill**: Äáº£m báº£o tÃ­nh chÃ­nh xÃ¡c, nháº¥t quÃ¡n vÃ  kháº£ nÄƒng truy xuáº¥t nguá»“n gá»‘c (traceability) tá»« requirement/diagrams sang physical database schema, loáº¡i bá» hoÃ n toÃ n kháº£ nÄƒng AI tá»± Ã½ váº½ thÃªm field khÃ´ng cÃ³ trong há»£p Ä‘á»“ng, lÃ  chá»‘t cháº·n cuá»‘i cÃ¹ng trÆ°á»›c khi AI sinh code.

---

## 2. Capability Map

### 2.1 Tri thá»©c (Knowledge â€” Pillar 1)
<!-- Skill cáº§n tri thá»©c gÃ¬? DÆ°á»›i dáº¡ng tÃ i liá»‡u nÃ o? -->

### 2.2 Quy trÃ¬nh (Process â€” Pillar 2)
<!-- Workflow logic: cÃ¡c bÆ°á»›c, thá»© tá»±, Ä‘iá»u kiá»‡n ráº½ nhÃ¡nh -->

### 2.3 Kiá»ƒm soÃ¡t (Guardrails â€” Pillar 3)
<!-- AI thÆ°á»ng sai á»Ÿ Ä‘Ã¢u? Cáº§n kiá»ƒm soÃ¡t gÃ¬? Checklist, verify rules? -->

---

## 3. Zone Mapping

> âš ï¸ Contract Section â€” Planner Ä‘á»c Â§3 Ä‘á»ƒ decompose thÃ nh Tasks.
> Má»i Zone PHáº¢I cÃ³ giÃ¡ trá»‹ trong cá»™t "Files cáº§n táº¡o". Zone khÃ´ng dÃ¹ng â†’ ghi "KhÃ´ng cáº§n".

| Zone | Files cáº§n táº¡o | Ná»™i dung | Báº¯t buá»™c? |
|------|--------------|----------|-----------|
| Core (SKILL.md) | `SKILL.md` | Persona, phases, guardrails | âœ… |
| Knowledge | `knowledge/payload-mongodb-patterns.md` | Quy Ä‘á»‹nh Embed/Ref, Metadata strategy | âœ… |
| Scripts | `scripts/validate_schema.py` | Kiá»ƒm tra field rÃ¡c/áº£o giÃ¡c so vá»›i há»£p Ä‘á»“ng | âœ… |
| Templates | `templates/schema-design.md.template`, `templates/schema-design.yaml.template` | Format xuáº¥t ra file thiáº¿t káº¿ (Markdown cho Human, YAML chuáº©n cáº¥u trÃºc cho AI sau) | âœ… |
| Data | `data/module-map.yaml` | Map routing cÃ¡c module | âœ… |
| Loop | `loop/schema-validation-checklist.md` | Checklist verify data rules | âœ… |
| Assets | KhÃ´ng cáº§n | N/A | âŒ |

---

## 4. Folder Structure

```mermaid
mindmap
  root((schema-design-analyst))
    SKILL.md
      Persona: Data Architect
      Phases & Interaction Points
      Guardrails
    knowledge
      payload-mongodb-patterns.md
    scripts
      validate_schema.py
    templates
      schema-design.md.template
      schema-design.yaml.template
    data
      module-map.yaml
    loop
      schema-validation-checklist.md
```

---

## 5. Execution Flow

```mermaid
sequenceDiagram
    participant U as User
    participant A as AI Agent
    participant YAML_IN as class-mX.yaml (CONTRACT)
    participant Flow as flow-diagrams/
    participant OUT_MD as schema-design/mX-schema.md
    participant OUT_YAML as schema-design/mX-schema.yaml
    participant L as loop/

    U->>A: YÃªu cáº§u thiáº¿t káº¿ schema cho chá»©c nÄƒng Y
    A->>A: Phase 0: PhÃ¢n tÃ­ch & Äá»‹nh vá»‹ Input Contract
    A->>YAML_IN: TÃ¬m kiáº¿m Module tÆ°Æ¡ng á»©ng vÃ  load YAML há»£p Ä‘á»“ng tá»« 2.5
    
    Note over A,U: [IP0] Gate 0: Confirm Target
    A->>U: "YÃªu cáº§u nÃ y thuá»™c Module X. Chuáº©n bá»‹ Ä‘á»c contract YAML cá»§a Module X. Äá»“ng Ã½?"
    U->>A: Confirm

    Note over A: Phase 1: TiÃªu thá»¥ Há»£p Äá»“ng (Contract Consumption)
    A->>YAML_IN: Äá»c data (Báº®T BUá»˜C)
    A->>Flow: Äá»c cÃ¡c flow diagrams liÃªn quan
    A->>A: Quyáº¿t Ä‘á»‹nh logic Embed/Ref, Map Payload types, Indexing

    Note over A: Phase 2: Generation (Dual Format)
    A->>OUT_MD: Sinh Markdown schema (Human Review)
    A->>OUT_YAML: Sinh YAML schema chuáº©n Ä‘á»‹nh dáº¡ng, cáº¥u trÃºc rÃµ rÃ ng logic (AI Input)
    
    Note over A,U: [IP1] Gate 1: Review Output
    A->>U: "Preview schema output. Approve Ä‘á»ƒ chá»‘t file YAML & MD?"
    U->>A: Approve

    Note over A: Phase 3: Self-Validation (Chá»‘ng áº¢o GiÃ¡c)
    A->>L: Äá»‘i chiáº¿u schema-validation-checklist.md
    A->>A: Cháº¡y validate_schema.py

    alt Validation PASS
        A->>U: "âœ… Schema design an toÃ n vÃ  hoÃ n táº¥t"
    else Validation FAIL
        A->>U: "ğŸ”´ BLOCK: CÃ³ rÃ¡c / sai Ä‘á»‹nh dáº¡ng. Cáº§n fix!"
    end
```

---

## 6. Interaction Points

| # | Thá»i Ä‘iá»ƒm | LÃ½ do dá»«ng | HÃ nh Ä‘á»™ng cá»§a AI |
|---|-----------|-----------|-----------------|
| 1 | TrÆ°á»›c Phase 2 (Sau khi Ä‘á»c Data) | BÃ¡o cÃ¡o tÃ¬nh tráº¡ng tiÃªu thá»¥ Contract YAML. Pháº£i Ä‘áº£m báº£o YAML khÃ´ng trá»‘ng vÃ  Ä‘Ã£ Ä‘Æ°á»£c lock tá»« Skill 2.5 | TrÃ¬nh bÃ y summary contract + chá» confirm |
| 2 | Sau Phase 3 (Gen MD) | Chá» user review báº£n Schema Markdown xem logic Payload/MongoDB Ä‘Ã£ há»£p lÃ½ chÆ°a | TrÃ¬nh bÃ y code schema + Cáº£nh bÃ¡o rá»§i ro vá» performance (náº¿u cÃ³) + Chá» approve |
| 3 | Cuá»‘i Phase 4 (Validation) | BÃ¡o cÃ¡o káº¿t quáº£ kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng chá»‘ng áº£o giÃ¡c. | Hiá»‡n Báº£ng Xanh (Pass) hoáº·c Äá» (Lá»—i). Báº¯t buá»™c pháº£i dá»«ng vÃ  tá»± sá»­a náº¿u Fail. |

---

## 7. Progressive Disclosure Plan

### Tier 1: Báº¯t buá»™c Ä‘á»c (Mandatory)
- `SKILL.md` (Persona / Flow / Guardrails)
- `knowledge/payload-mongodb-patterns.md` (CÃ¡ch quy hoáº¡ch Data)
- `data/module-map.yaml` (Biáº¿t file nÃ o á»Ÿ Ä‘Ã¢u)
- `Docs/life-2/diagrams/class-diagrams/index.md` (Äá»c Status Ä‘á»ƒ biáº¿t Ä‘Æ°á»£c phÃ©p lÃ m module nÃ o)

### Tier 2: Äá»c khi cáº§n (Conditional)
- `Docs/life-2/diagrams/class-diagrams/mX-*/class-mX.yaml` (Chá»‰ load file YAML Äáº¦U VÃ€O cá»§a module Ä‘ang lÃ m do Skill 2.5 xuáº¥t ra)
- `Docs/life-2/diagrams/flow-*/` (CÃ¡c file flow map theo module)
- `templates/schema-design.md.template` vÃ  `schema-design.yaml.template` (Äá»c khi báº¯t Ä‘áº§u sinh file)

---

## 8. Risks & Blind Spots

| # | Risk | Severity | Mitigation |
|---|------|----------|-----------|
| 1 | AI bá»‹a field khÃ´ng cÃ³ trong `class-mX.yaml` | P0 | Báº¯t buá»™c cháº¡y script `validate_schema.py` cuá»‘i má»—i workflow. Náº¿u phÃ¡t hiá»‡n field láº¡, throw `[BLOCK]`. |
| 2 | Chá»n sai Strategy (Embed lá»“ng sÃ¢u quÃ¡ 16MB) | P1 | Prompts trong SKILL.md yÃªu cáº§u AI suy diá»…n Data Size cá»§a Node khi thiáº¿t káº¿ MongoDB Array. Payload Array field khÃ´ng Ä‘Æ°á»£c lÆ°u trá»¯ quÃ¡ nhiá»u documents. |
| 3 | Context Overflow | P2 | Design báº¯t buá»™c Agent chá»‰ load 1 module YAML cho má»—i lÆ°á»£t lÃ m viá»‡c thÃ´ng qua `module-map.yaml`. |

---

## 9. Open Questions

| # | CÃ¢u há»i | Nguá»“n (Phase) | Tráº¡ng thÃ¡i |
|---|---------|--------------|-----------|
| 1 | CÃ³ cáº§n viáº¿t Validation Script cháº¡y báº±ng CI/CD hay Agent tá»± cháº¡y cá»¥c bá»™? | Phase 2 | â“ Má»Ÿ (Hiá»‡n táº¡i: Agent tá»± cháº¡y qua `scripts/validate_schema.py`) |

---

## 10. Metadata

- **Skill Name**: schema-design-analyst
- **Created**: 2026-02-20
- **Author**: Skill Architect
- **Framework**: architect.md v2.0
- **Status**: ğŸŸ¢ DESIGN COMPLETE
- **Handoff Checklist**:
  - [x] design.md hoÃ n thiá»‡n (checklist pass)
  - [x] Sáºµn sÃ ng cho skill-planner
