# ui-architecture-analyst — Implementation Plan

> Generated by Skill Planner (v2 — replan from design.md v2) | Date: 2026-02-21
> Design Source: `.skill-context/ui-architecture-analyst/design.md` (v2.0)
> Traceability: 100% items traced to design.md §N

---

## 1. Pre-requisites

> Audit thực tế `resources/` → **TRỐNG** (0 files). Các mục `⬜` sinh ra Phase 0 Tasks.

| #  | Tài liệu / Kiến thức | Tier | Mục đích | Trace | Status |
|----|----------------------|------|----------|-------|--------|
| P1 | `design.md` v2.0 — §2 Capability Map, §3 Zone Mapping, §6 IP, §7 PD, §8 Risks | Domain | Nguồn duy nhất cho Builder thực thi: phases, guardrails, file list | [TỪ DESIGN §3] | ✅ |
| P2 | `Docs/life-2/ui/specs/template-screen-spec.md` (đã tồn tại trong project) | Domain | Builder dùng làm gốc cho `templates/screen-spec.md.template` | [TỪ DESIGN §1] | ✅ |
| P3 | `Docs/life-2/ui/specs/m1-auth-ui-spec.md` — ví dụ spec thực tế | Domain | Giúp Builder hiểu output format thực tế đang dùng | [TỪ DESIGN §1] | ✅ |
| P4 | Quy tắc Atomic Design & mapping Payload field → UI Component | Domain | Nội dung cốt lõi của `knowledge/mapping-rules.md` | [TỪ DESIGN §3] | ✅ — Mô tả đầy đủ ở §3 Knowledge zone |
| P5 | **Danh sách shadcn/ui components** có trong tech stack project | Domain | Nội dung cốt lõi của `knowledge/ui-component-rules.md` | [TỪ DESIGN §3] | ✅ — Có trong `resources/design-research.md` (DESIGN.md) |
| P6 | **Module-to-file path mapping** (M1-M6 → schema paths, diagram paths) | Domain | `resource_scanner.py` cần biết path thực tế để resolve đúng files | [TỪ DESIGN §3 Scripts] | ⬜ Missing → Phase 0 |
| P7 | Python argparse, os.path, json stdlib | Technical | Viết `scripts/resource_scanner.py` | [TỪ DESIGN §3 Scripts] | ✅ |
| P8 | Markdown template format, Payload CMS field types | Technical | Viết knowledge files và templates | [TỪ DESIGN §2.1] | ✅ |

---

## 2. Phase Breakdown

### ⚠️ Phase 0: Resource Preparation (BLOCKING — phải hoàn thành trước Phase 1)

> Hai tài nguyên critical đang `⬜ Missing`. Builder KHÔNG THỂ tạo đúng `knowledge/ui-component-rules.md` và `scripts/resource_scanner.py` nếu chưa có dữ liệu này.

- [x] ~~Tạo `resources/radix-ui-palette.md`~~ → **Không cần**: Library là **shadcn/ui** (không phải Radix UI). Catalogue components shadcn đã có trong `resources/design-research.md`. [TỪ AUDIT TÀI NGUYÊN — ĐÃ CẬP NHẬT]
- [x] Tạo `resources/module-paths.md`: Document mapping từng module M1–M6 → danh sách path file thực tế: Schema YAML (`Docs/life-2/database/...`), Flow diagram (`Docs/life-2/diagrams/flow-diagram.md`), Sequence diagram (`Docs/life-2/diagrams/sequence-diagram.md`). Đây là input tĩnh cho `resource_scanner.py` [TỪ AUDIT TÀI NGUYÊN]
- [x] *(Optional)* Tạo `resources/references.md`: Trích dẫn hoặc link đến các file spec đã có (`m1-auth-ui-spec.md`, v.v.) để Builder có ví dụ hoàn chỉnh cho từng section [GỢI Ý BỔ SUNG]

---

### Phase 1: Core Zone — Tạo `SKILL.md`

> Source: design.md §2, §6, §7, §8

- [x] Viết `SKILL.md` với persona **"Senior UI Spec Analyst"** — AI nhận module ID làm input, output là UI Screen Spec [TỪ DESIGN §2.3, §10]
- [x] Embed 5-phase workflow vào SKILL.md (Phase 1→5 với Input/Output rõ ràng theo bảng §2.2): Context Discovery → Screen Identification → Data Mapping → Synthesis & Merge → Output Generation [TỪ DESIGN §2.2]
- [x] Embed 5 Guardrails (G1–G5) vào SKILL.md với hành động cụ thể khi vi phạm: G1 ghi `[SOURCE MISSING]`, G2 log gap → IP-3, G3 từ chối invoke, G4 trigger IP-2, G5 dừng và báo gap [TỪ DESIGN §2.3]
- [x] Embed **3 Interaction Points** vào luồng SKILL.md theo đúng thứ tự kích hoạt: IP-1 (sau Phase 2), IP-2 (khi file spec cũ tồn tại), IP-3 (khi diagram thiếu/trống) [TỪ DESIGN §6]
- [x] Embed Progressive Disclosure boot sequence vào SKILL.md: Tier 1 = 5 files bắt buộc đọc trước (`SKILL.md`, `knowledge/mapping-rules.md`, `knowledge/ui-component-rules.md`, `loop/design-checklist.md`, `templates/screen-spec.md.template`); Tier 2 = dynamic resources từ script [TỪ DESIGN §7]
- [x] Document invoke instruction trong SKILL.md: `--module M[X]` với X ∈ {1,2,3,4,5,6}, single-module-per-invocation rule (G3) [TỪ DESIGN §1, §2.3]

---

### Phase 2: Knowledge Zone — Tạo `knowledge/mapping-rules.md` & `knowledge/ui-component-rules.md`

> Source: design.md §3 (Knowledge rows), P4 (Pre-req ✅), P5 (Pre-req từ Phase 0)

- [x] Tạo `knowledge/mapping-rules.md`: Transform 100% bảng ánh xạ từ design.md §3 thành lookup table đầy đủ — Schema type (`text`, `email`, `select`, `richText`, `upload`, `relationship`, `checkbox`, `number`, `date`) → UI Component type, Required/Optional behavior, Validation constraint [TỪ DESIGN §3 Knowledge]
- [x] Tạo `knowledge/ui-component-rules.md` (từ `resources/design-research.md` + §3): Gồm 4 sections: (1) Screen ID convention (`SC-M[X]-0N`), (2) Element ID naming (`input-*`, `btn-*`, `select-*`, `link-*`, `label-*`), (3) **shadcn/ui component catalogue** — transform từ `resources/design-research.md` (Button, Input, Select, Dialog, Card, Textarea, Badge, Avatar, v.v.), (4) Cross-module component policy: Header/Nav/Sidebar → skip trong module spec, document 1 lần tại `Docs/life-2/ui/specs/index.md` [TỪ DESIGN §3 Knowledge, §9 Q1]

---

### Phase 3: Templates Zone — Tạo `templates/screen-spec.md.template`

> Source: design.md §3 (Templates row), P2 (`Docs/life-2/ui/specs/template-screen-spec.md`)

- [x] Tạo `templates/screen-spec.md.template`: Adapt từ `Docs/life-2/ui/specs/template-screen-spec.md` thành template chuẩn 3-section với placeholder variables: `{{MODULE_ID}}`, `{{SCREEN_ID}}`, `{{SCREEN_NAME}}`, `{{ACTOR}}`. Đảm bảo Section 2A có cột "Source Field" bắt buộc điền (phục vụ G1) [TỪ DESIGN §3 Templates, §8 R2]
- [x] Thêm Section C (States & Variations) vào template với sub-items: Loading, Empty, Success/Error Toast, và ghi chú policy về Error/Empty States per §9 Q2 [TỪ DESIGN §9 Q2]

---

### Phase 4: Loop Zone — Tạo `loop/design-checklist.md`

> Source: design.md §3 (Loop row), §8 R1–R5

- [x] Tạo `loop/design-checklist.md` với đúng 5 câu hỏi phản biện bắt buộc, mỗi câu kèm **hint mitigation** từ §8: (1) Mọi Source Field có trong Schema không? → R2, (2) Mọi Interaction Flow có trong Diagram không? → R4, (3) File spec cũ đã được Merge chưa (không Overwrite)? → R3, (4) Tất cả Screen ID đúng convention `SC-M[X]-0N` không? → R2, (5) Có component cross-module nào bị lặp lại trong spec này không? → Q1 [TỪ DESIGN §3 Loop, §8]
- [x] Bổ sung section "Severity Reference" vào checklist: liệt kê R1(P1)–R5(P2) từ §8 để AI có thể tham chiếu khi flag lỗi [TỪ DESIGN §8]

---

### Phase 5: Scripts Zone — Tạo `scripts/resource_scanner.py`

> Source: design.md §3 (Scripts row), P6 (`resources/module-paths.md` từ Phase 0), §8 R1

- [x] Viết `scripts/resource_scanner.py`: Nhận argument `--module M[X]` qua argparse → load module-paths từ `resources/module-paths.md` → trả về JSON `{"schema": ["path1",...], "diagrams": ["path1",...]}` stdout [TỪ DESIGN §3 Scripts]
- [x] Implement **context overflow guard** (R1 mitigation): Throw error với message rõ nếu `--module` argument bị thiếu hoặc giá trị không thuộc `{M1, M2, M3, M4, M5, M6}` [TỪ DESIGN §8 R1]
- [x] Implement **placeholder detection** (G5, Q3): Check nếu file tồn tại nhưng size < 200 bytes hoặc chứa keyword `TODO`/`placeholder`/`...` → đánh dấu file là "stub" và trả về trong JSON field `"stubs": ["path"]` riêng để AI biết kích hoạt IP-3 [TỪ DESIGN §9 Q3, §6 IP-3] — **Lưu ý**: Threshold 200 bytes là đề xuất, xem Notes §5

---

## 3. Knowledge & Resources Needed

| Loại tài nguyên | Nguồn / Nơi lưu | Cho Phase | Status |
|-----------------|-----------------|-----------|--------|
| design.md v2.0 (§2, §3, §6, §7, §8) | `.skill-context/ui-architecture-analyst/design.md` | Tất cả | ✅ |
| Existing screen spec template | `Docs/life-2/ui/specs/template-screen-spec.md` | Phase 3 | ✅ |
| Existing spec example (M1) | `Docs/life-2/ui/specs/m1-auth-ui-spec.md` | Phase 1, 3 | ✅ |
| shadcn/ui component list | `resources/design-research.md` (đã có — từ DESIGN.md) | Phase 2 | ✅ |
| Module-to-file path mapping | **`resources/module-paths.md`** (cần tạo Phase 0) | Phase 5 | ⬜ |
| Python 3 stdlib (argparse, json, os, pathlib) | Built-in | Phase 5 | ✅ |

---

## 4. Definition of Done

> Checklist dựa trên §3 Zone Mapping "Files cần tạo" — **tất cả 6 files phải tồn tại và có nội dung đầy đủ**.

- [x] `SKILL.md` — Có: persona, 5 phases, G1-G5, IP-1/IP-2/IP-3, Tier 1 boot sequence, invoke instructions [TỪ DESIGN §3 Core]
- [x] `knowledge/mapping-rules.md` — Có: lookup table đầy đủ 9+ Schema types → UI Components [TỪ DESIGN §3 Knowledge]
- [x] `knowledge/ui-component-rules.md` — Có: 4 sections (Screen ID, Element ID, Radix palette, Cross-module policy) [TỪ DESIGN §3 Knowledge]
- [x] `scripts/resource_scanner.py` — Có: argparse `--module`, JSON output, overflow guard, placeholder detection [TỪ DESIGN §3 Scripts]
- [x] `templates/screen-spec.md.template` — Có: 3 sections, placeholder variables, "Source Field" column mandatory [TỪ DESIGN §3 Templates]
- [x] `loop/design-checklist.md` — Có: 5 câu hỏi, mitigation hints từ R1-R5, Severity Reference [TỪ DESIGN §3 Loop]
- [x] Phase 0 resources hoàn thành: `resources/design-research.md` ✅ + `resources/module-paths.md` ⬜ [TỪ AUDIT TÀI NGUYÊN]
- [x] Tất cả files trong `knowledge/` có tên khớp với §3 và §4 Folder Structure [TỪ DESIGN §3]

---

## 5. Notes

### ✅ Resource Gate — RESOLVED

| Resource | Blocking | Trạng thái | Lý do |
|----------|---------|------------|-------|
| `resources/design-research.md` | Phase 2 | ✅ **Đã có** | Context shadcn/ui + design principles từ DESIGN.md |
| `resources/module-paths.md` | Phase 5 | ✅ **Đã có** | Auto-generated bởi `scripts/generate-module-paths.py` — mapping M1-M6 đầy đủ |

**Kết quả**: **Tất cả resource blocking đã resolved** ✅ — Builder có thể bắt đầu Phase 1 ngay.

---

### Open Questions từ design.md §9 (migrate)

**Q1** — Cross-module screens (Header, Sidebar): Đề xuất document ở `Docs/life-2/ui/specs/index.md`, module specs chỉ reference. **Builder nên implement policy này vào `knowledge/ui-component-rules.md` Section 4** [TỪ DESIGN §9 Q1]

**Q2** — Error/Empty States: Đề xuất dùng sub-section trong §2C, không tạo Screen ID riêng. **Builder nên ghi policy này vào `templates/screen-spec.md.template` Section C** [TỪ DESIGN §9 Q2]

**Q3** — Placeholder detection threshold trong `resource_scanner.py`: `[CẦN LÀM RÕ]` — Planner đề xuất threshold: file size < 200 bytes OR chứa keyword (`TODO`, `placeholder`, `...`). Builder cần xác nhận threshold này với user trước khi code [TỪ DESIGN §9 Q3]

---

### Gợi ý cho Builder

- **Thứ tự Phase không thể hoán đổi**: Phase 0 → 1 → 2 → 3 → 4 → 5. Phase 5 (script) phụ thuộc vào `resources/module-paths.md` từ Phase 0.
- **SKILL.md viết cuối cùng trong Phase 1 sau khi đã draft knowledge files**: Vì SKILL.md phải reference đúng tên files Tier 1.
- **Test script Phase 5**: Chạy `python3 scripts/resource_scanner.py --module M1` → verify JSON output. Chạy thiếu `--module` → verify error message. [GỢI Ý BỔ SUNG]
