# activity-diagram-design-analyst ‚Äî Architecture Design

> Generated by Skill Architect | Date: 2026-02-15
> Status: üîµ IN PROGRESS

---

## 1. Problem Statement

Skill n√†y gi·∫£i quy·∫øt b√†i to√°n ph√¢n t√≠ch v√† thi·∫øt k·∫ø s∆° ƒë·ªì Activity Diagram theo d·ªØ li·ªáu nghi·ªáp v·ª• th·ª±c t·∫ø, thay v√¨ v·∫Ω s∆° ƒë·ªì "happy path" ƒë∆°n gi·∫£n.

**V·∫•n ƒë·ªÅ c·∫ßn gi·∫£i quy·∫øt (Refactor v2.0):**
- **S·ª± m·∫•t m√°t tri th·ª©c (Knowledge Loss)**: C√°c phi√™n b·∫£n tr∆∞·ªõc th∆∞·ªùng t√≥m t·∫Øt (summarize) t√†i li·ªáu g·ªëc, d·∫´n ƒë·∫øn vi·ªác AI b·ªè s√≥t c√°c ti·ªÉu ti·∫øt k·ªπ thu·∫≠t quan tr·ªçng (Fork/Join, Object Flow, Flow Final).
- **Thi·∫øu t√≠nh ph·∫£n bi·ªán**: AI d·ªÖ d√†ng ch·∫•p nh·∫≠n logic c·ªßa ng∆∞·ªùi d√πng m√† kh√¥ng ki·ªÉm tra c√°c r·ªßi ro kinh ƒëi·ªÉn nh∆∞ Deadlock khi d√πng Fork/Join sai c√°ch.
- **T√≠nh ƒë√≥ng g√≥i**: C·∫ßn chu·∫©n h√≥a l·∫°i b·ªô tri th·ª©c Clean Architecture B-U-E ƒë·ªÉ √°p d·ª•ng v√†o modeling nghi·ªáp v·ª• m·ªôt c√°ch nh·∫•t qu√°n.

**Nh√≥m ng∆∞·ªùi d√πng ch√≠nh:**
- Analyst/BA c·∫ßn chuy·ªÉn h√≥a use case th√†nh lu·ªìng ho·∫°t ƒë·ªông r·∫°ng ng·ªùi tri th·ª©c.
- Senior Engineer c·∫ßn m·ªôt c√¥ng c·ª• review logic c√≥ kh·∫£ nƒÉng ph√°t hi·ªán l·ªói Semantic.
- Team Lead c·∫ßn audit thi·∫øt k·∫ø theo ti√™u chu·∫©n Clean Architecture.

**Hai t√¨nh hu·ªëng ƒë·∫ßu v√†o (Modes):**
1. **Mode A (Design V1)**: Ng∆∞·ªùi d√πng ch∆∞a c√≥ s∆° ƒë·ªì, skill ph·∫£i ph√¢n t√≠ch Context v√† t·∫°o b·∫£n Mermaid V1 v·ªõi ƒë·ªô chi ti·∫øt cao.
2. **Mode B (Refactor/Audit)**: Ng∆∞·ªùi d√πng ƒë√£ c√≥ s∆° ƒë·ªì, skill ph·∫£i ƒë√≥ng vai tr√≤ "K·ªπ s∆∞ Audit" ƒë·ªÉ ch·ªâ ra r·ªßi ro logic (CF-0x, DL-0x...) v√† ƒë·ªÅ xu·∫•t c·∫£i ti·∫øn.

**Gi√° tr·ªã c·ªët l√µi:**
- **High-Fidelity**: Chuy·ªÉn h√≥a 100% tri th·ª©c t·ª´ t√†i li·ªáu nghi√™n c·ª©u, kh√¥ng t√≥m t·∫Øt.
- **Traceability**: M·ªçi th√†nh ph·∫ßn s∆° ƒë·ªì ƒë·ªÅu ph·∫£i truy v·∫øt ƒë∆∞·ª£c ngu·ªìn t·ª´ Context.
- **Clean Architecture Lens**: √Åp d·ª•ng tri·ªát ƒë·ªÉ ph√¢n l·ªõp Boundary-UseCase-Entity v√†o Swimlane.

## 2. Capability Map

### 2.1 Tri th·ª©c (Knowledge) - T·∫ßm nh√¨n High-Fidelity
- **UML Activity Diagram Specialization**:
  - Kh√¥ng ch·ªâ c√°c node c∆° b·∫£n, m√† ph·∫£i n·∫Øm v·ªØng: Object Node, Pin, Expansion Region (n·∫øu c·∫ßn), c√°c c∆° ch·∫ø Token flow.
  - Ph√¢n bi·ªát r·∫°ch r√≤i gi·ªØa Fork/Join (Concurrency) v√† Decision/Merge (Choice).
- **Comprehensive Research (100% Transform)**:
  - T√†i nguy√™n g·ªëc: `resources/activity-diagram-research.md`.
  - Nhi·ªám v·ª•: Chuy·ªÉn h√≥a to√†n b·ªô quy t·∫Øc, k√Ω hi·ªáu, v√† c·∫°m b·∫´y logic v√†o skill. Tuy·ªát ƒë·ªëi kh√¥ng vi·∫øt ki·ªÉu "t√≥m t·∫Øt".
- **Clean Architecture B-U-E Lens**:
  - T∆∞ duy ph√¢n l·ªõp: Boundary (Giao di·ªán/T∆∞∆°ng t√°c), Use Case (Logic ph·ªëi h·ª£p), Entity (Lu·∫≠t nghi·ªáp v·ª• c·ªët l√µi).
  - Kh·∫£ nƒÉng √°nh x·∫° (Mapping) t·ª´ Use Case steps sang Swimlane t∆∞∆°ng ·ª©ng.

### 2.2 Quy tr√¨nh (Process) - Expert Persona
Workflow 4-Phase (Gate-based):
1. **Phase 1: Collect**: Nh·∫≠n d·∫°ng Mode A/B v√† th·∫©m ƒë·ªãnh Context.
2. **Phase 2: Analyze**: Tr√≠ch xu·∫•t Logical Baseline. ƒê√†o s√¢u c√°c "Edge cases" v√† "Exception flows".
3. **Phase 3: Design/Refactor**: T·∫°o Mermaid v·ªõi ƒë·ªô th·∫©m m·ªπ cao v√† b√°o c√°o Findings chuy√™n s√¢u.
4. **Phase 4: Explain**: Gi·∫£i th√≠ch l√Ω do thi·∫øt k·∫ø d·ª±a tr√™n Clean Architecture.

### 2.3 Ki·ªÉm so√°t (Guardrails) - Th·∫Øt ch·∫∑t k·ª∑ lu·∫≠t
- **G1: High-Fidelity**: Kh√¥ng summarize tri th·ª©c k·ªπ thu·∫≠t. N·∫øu t√†i nguy√™n n√≥i c√≥ 10 lo·∫°i l·ªói, skill ph·∫£i bi·∫øt 10 lo·∫°i l·ªói.
- **G2: Anti-Hallucination**: Kh√¥ng t·ª± b·ªãa nghi·ªáp v·ª•. D√πng `[MISSING_DOMAIN_DATA]` khi thi·∫øu context.
- **G3: Risk Focus**: Ph·∫£i ph√°t hi·ªán √≠t nh·∫•t m·ªôt r·ªßi ro ti·ªÅm ·∫©n (v√≠ d·ª•: thi·∫øu lu·ªìng l·ªói) n·∫øu nghi·ªáp v·ª• ph·ª©c t·∫°p.
- **G4: Interaction Gate**: Kh√¥ng t·ª± √Ω ho√†n thi·ªán n·∫øu ƒë·ªô tin c·∫≠y < 70%.
- **G5: Language Accuracy**: S·ª≠ d·ª•ng Ti·∫øng Vi·ªát chuy√™n nghi·ªáp, thu·∫≠t ng·ªØ Ti·∫øng Anh gi·ªØ nguy√™n (Swimlane, Fork, Join).

## 3. Zone Mapping

| Zone | N·ªôi dung | B·∫Øt bu·ªôc? |
|------|----------|----------|
| Core (`SKILL.md`) | Persona "Senior Activity Design Engineer", Quy tr√¨nh 4-Phase, High-Fidelity Guards | ‚úÖ |
| Knowledge | **100% Transform** t·ª´ `activity-diagram-research.md`, `refactor-risk-patterns.md`, `clean-architecture-lens.md` | ‚úÖ |
| Scripts | `scripts/validate_syntax.py`, `scripts/report_generator.py` (H·ªó tr·ª£ AI ki·ªÉm tra syntax v√† t·∫°o b√°o c√°o) | Optional |
| Templates | `templates/activity-mode-a.template.md`, `templates/activity-mode-b.template.md`, `templates/findings-report.template.md` | ‚úÖ |
| Data | `data/rules.yaml`, `data/severity-matrix.yaml` (D·ªØ li·ªáu c·ª©ng v·ªÅ ti√™u chu·∫©n) | ‚úÖ |
| Loop | `loop/checklist.md`, `loop/phase-verify.md`, `loop/final-verify.md` | ‚úÖ |
| Assets | `assets/symbols-cheatsheet.md` | Optional |

## 4. Folder Structure

Mermaid mindmap de xac dinh bo khung skill.

```mermaid
mindmap
  root((activity-diagram-design-analyst))
    SKILL.md
      Persona
      Two Modes A/B
      Guardrails
      Output Contract
    knowledge
      activity-uml-rules.md
      refactor-risk-patterns.md
      clean-architecture-lens.md
      source-prioritization.md
    scripts
      validate_syntax.py
      report_generator.py
    templates
      activity-mode-a.template.md
      activity-mode-b.template.md
      findings-report.template.md
    data
      rules.yaml
      severity-matrix.yaml
    loop
      checklist.md
      phase-verify.md
      final-verify.md
      test-cases
        mode-a-design-v1.md
        mode-b-refactor.md
    assets
      symbols-cheatsheet.md
```

## 5. Execution Flow

Sequence flow de mo ta luong runtime theo 2 mode.

```mermaid
sequenceDiagram
    participant U as User
    participant S as Skill
    participant K as Research Base
    participant V as Verify Loop

    U->>S: Context input + (optional) existing diagram
    S->>S: Detect Mode A or Mode B
    S->>K: Retrieve docs and references
    K-->>S: Evidence package
    S->>S: Synthesize business flow
    alt Mode A (no existing diagram)
        S->>S: Generate Mermaid V1
    else Mode B (diagram exists)
        S->>S: Audit and refactor Mermaid
    end
    S->>V: Structural + logic + traceability checks
    V-->>S: Findings + risk levels
    S->>U: Diagram + gaps + clean-architecture guidance
```

## 6. Interaction Points

| # | Thoi diem | Ly do |
|---|-----------|-------|
| 1 | Sau khi doc input ban dau | Xac nhan mode A/B va pham vi use case |
| 2 | Sau khi trich xuat actor + business rules | Xac nhan khong bo sot nghiep vu quan trong |
| 3 | Truoc khi chot diagram | Trinh bay assumptions va diem mo ho can user quyet dinh |
| 4 | Sau khi gap analysis | Xac nhan muc uu tien cho cac de xuat refactor |

## 7. Progressive Disclosure Plan

### Tang 1: Bat buoc doc (Mandatory)
- SKILL.md
- knowledge/activity-uml-rules.md
- knowledge/clean-architecture-lens.md
- loop/checklist.md
- Docs/diagram/activity-diagram-research.md (neu ton tai trong repo)

### Tang 2: Tu quyet dinh (Conditional)
- knowledge/refactor-risk-patterns.md (chi dung cho Mode B)
- templates/activity-mode-a.template.md (khi tao moi V1)
- templates/activity-mode-b.template.md (khi refactor)
- data/rules.yaml, data/severity-matrix.yaml (khi can danh gia dinh luong)
- Tai lieu user chi dinh them (spec/usecase/domain docs)

## 8. Risks & Blind Spots

| # | Risk | Mitigation |
|---|------|------------|
| 1 | Diagram dung ky hieu nhung sai logic nghiep vu | Bat buoc trace moi nhanh voi rule/context goc |
| 2 | Thieu luong ngoai le do context mo ta "happy path" | Checklist bat buoc co alternate/error path |
| 3 | Nham Swimlane (sai chu the thuc hien) | Mapping actor-action truoc khi ve diagram |
| 4 | Lam dung tu cua hinh thuc, thieu tinh clean architecture | Danh gia theo boundary/use-case separation checklist |
| 5 | Over-assumption khi context thieu | Bat buoc output section "Assumptions + Questions" |
| 6 | Refactor qua tay lam phuc tap hoa flow | Uu tien don gian, giam so node, giu traceability |

## 9. Open Questions

| # | Cau hoi | Trang thai |
|---|---------|-----------|
| 1 | Co can ho tro input anh/screenshot diagram hay chi markdown mermaid? | ‚ùì |
| 2 | Co can chuan hoa output song ngu (VI/EN) ngay tu V1? | ‚ùì |
| 3 | Muc do tu dong sua diagram den dau thi can dung va hoi user? | ‚ùì |
| 4 | Co can scoring dinh luong (0-100) cho quality diagram? | ‚ùì |

## 9.1 Workflow Phases (Gate-based)

```mermaid
flowchart LR
    P1[Phase 1 Collect<br/>Context + Mode Detection] -->|Gate 1| P2[Phase 2 Analyze<br/>Rules + Business Logic]
    P2 -->|Gate 2| P3[Phase 3 Design/Refactor<br/>Mermaid + Findings]
    P3 -->|Gate 3| P4[Phase 4 Explain<br/>Clean Architecture Guidance]

    P1 -.-> I1[Interaction: Confirm scope]
    P2 -.-> I2[Interaction: Confirm assumptions]
    P3 -.-> I3[Interaction: Prioritize fixes]
```

## 10. Metadata

- **Skill Name**: activity-diagram-design-analyst
- **Created**: 2026-02-15
- **Refactored**: 2026-02-16 (v2.0 - High-Fidelity Upgrade)
- **Author**: Anti-gravity (using Master Skill Suite)
- **Framework**: architect.md v2.0
- **Primary Use**: Ph√¢n t√≠ch, thi·∫øt k·∫ø v√† Audit Activity Diagram chuy√™n s√¢u.
- **Status**: ÔøΩ DESIGN REFACTORED - READY FOR PLANNING
