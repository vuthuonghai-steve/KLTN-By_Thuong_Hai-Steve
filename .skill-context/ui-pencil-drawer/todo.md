# ui-pencil-drawer â€” Implementation Plan

> Generated by Skill Planner | Date: 2026-02-21
> Input: design.md (v2 AGI philosophy) + pencil-mcp-agent-rules.md (Rich resource)
> Status: ğŸŸ¢ PHASE 0 COMPLETE â€” READY FOR BUILDER

---

## 1. Pre-requisites

> TÃ i liá»‡u vÃ  kiáº¿n thá»©c cáº§n chuáº©n bá»‹ TRÆ¯á»šC khi Builder báº¯t tay xÃ¢y dá»±ng.
> **Quy táº¯c Gatekeeper**: Builder KHÃ”NG Ä‘Æ°á»£c tiáº¿p tá»¥c khi cÃ²n Pre-req á»Ÿ tráº¡ng thÃ¡i â¬œ.

| # | TÃ i liá»‡u / Kiáº¿n thá»©c | Tier | Má»¥c Ä‘Ã­ch | Trace | Status |
|---|---------------------|------|---------|-------|--------|
| 1 | `pencil-mcp-agent-rules.md` (táº¡i `Docs/life-2/ui/`) | Domain | Resource chÃ­nh cho `knowledge/pencil-tools-ref.md` + `data/layout-rules.yaml` + `loop/checklist.md` â€” 6 Pencil MCP tools, layout rules, script patterns, Bounded Creativity zones | [Tá»ª DESIGN Â§2.1] | âœ… CÃ³ (cáº§n copy vÃ o resources/ â€” xem Phase 0) |
| 2 | Wireframe DOM Tree Format Standard | Domain | Source cho `knowledge/wireframe-format.md` vÃ  `templates/wireframe.md.template` â€” Ä‘á»‹nh nghÄ©a cÃº phÃ¡p phÃ¢n cáº¥p DOM Tree, component mapping, citation | [Tá»ª DESIGN Â§2.1] | â¬œ Missing â†’ Sinh Task 0.2 |
| 3 | `design.md Â§2.2` â€” 4-Phase Autonomous Workflow | Domain | Content gá»‘c Ä‘á»ƒ viáº¿t `SKILL.md` phases, Boot Sequence, Escalation rules | [Tá»ª DESIGN Â§2.2] | âœ… (design.md) |
| 4 | `design.md Â§2.3` â€” 5 Guardrails | Domain | G-Lib-Strict, G-Spec-Strict, G-Canvas-Space, G-One-Screen-Per-Call, G-Fail-Fast â†’ implement trong SKILL.md vÃ  `loop/checklist.md` | [Tá»ª DESIGN Â§2.3] | âœ… (design.md) |
| 5 | Project docs: `CLAUDE.md`, `check.list.md`, `Docs/life-2/ui/specs/` index | Domain | Source cho `knowledge/project-context.md` â€” module scope M1â€“M6, design aesthetic, naming conventions | [Tá»ª DESIGN Â§3] | âœ… (tá»“n táº¡i trong project) |
| 6 | `architect.md` â€” SKILL.md writing patterns | Technical | Format SKILL.md theo 7-Zone framework: Imperative form, Phase-based steps, Guardrails | [Gá»¢I Ã Bá»” SUNG] | âœ… (loaded) |

---

## 2. Phase Breakdown

> Má»—i task cÃ³ trace tag. Builder thá»±c thi tuáº§n tá»± Phase 0 â†’ Phase 7.
> **Autonomous Model**: Builder khÃ´ng cáº§n xin confirm giá»¯a cÃ¡c Phase (trá»« khi gáº·p hard blocker).

---

### Phase 0: Resource Preparation

> Má»¥c tiÃªu: Äáº£m báº£o `resources/` cÃ³ Ä‘á»§ domain knowledge trÆ°á»›c khi Builder viáº¿t báº¥t ká»³ file nÃ o.

- [x] **Task 0.1** â€” Copy `pencil-mcp-agent-rules.md` vÃ o resources/:
  ```bash
  cp Docs/life-2/ui/pencil-mcp-agent-rules.md .skill-context/ui-pencil-drawer/resources/pencil-mcp-agent-rules.md
  ```
  Builder xÃ¡c nháº­n file Ä‘Ã£ cÃ³ vá»›i Ä‘á»§ 6 sections (Iâ€“VI). [Tá»ª AUDIT TÃ€I NGUYÃŠN]

- [x] **Task 0.2** â€” Soáº¡n tháº£o `resources/wireframe-format-draft.md` â€” Ä‘á»‹nh nghÄ©a DOM Tree format chuáº©n:
  - Level 0 (Screen Frame): `# Screen: {screen-name}` â€” module, spec-source, layout-direction
  - Level 1 (Section): `## Section: {name}` â€” layout (vertical/horizontal), width, gap
  - Level 2 (Component Slot): `- comp: {name}` vá»›i `ref: {nodeId}`, `overrides: {fieldId: value}`, `spec-cite: Â§N.M`, `zone: strict|fluid`
  - Text override notation: `text@{fieldId}: "content"`
  - Source citation format báº¯t buá»™c: `[spec Â§N.M]` trÃªn má»—i component slot
  - States: `### State: default | loading | error | empty`
  [Tá»ª AUDIT TÃ€I NGUYÃŠN]

> âš ï¸ **Gate**: Builder pháº£i hoÃ n thÃ nh Task 0.1 vÃ  0.2 trÆ°á»›c khi sang Phase 1.
> Náº¿u format wireframe chÆ°a Ä‘á»§ chi tiáº¿t â†’ escalate, khÃ´ng tá»± Ä‘oÃ¡n.

---

### Phase 1: Foundation â€” SKILL.md

- [x] **Task 1.1** â€” Táº¡o `SKILL.md` vá»›i Ä‘áº§y Ä‘á»§:
  - **Persona**: "Autonomous UI Design Agent â€” AI tá»± thá»±c thi end-to-end, human chá»‰ cung cáº¥p spec path + pen file path. Escalate only when genuinely blocked."
  - **Boot Sequence** (Mandatory Tier 0 â†’ Tier 1):
    - Tier 0: Äá»c `SKILL.md` (self) â†’ `knowledge/project-context.md`
    - Tier 1: Äá»c `knowledge/pencil-tools-ref.md` â†’ `knowledge/wireframe-format.md`
    - Tier 2 (conditional): `templates/wireframe.md.template` khi Phase 2; `data/layout-rules.yaml` khi cáº§n spacing; `loop/checklist.md` khi self-verify
  - **Phase 0 â€” Context Boot**: `get_editor_state()` â†’ Ä‘á»c CLAUDE.md â†’ check.list.md â†’ scan Lib-Component qua `batch_get`
  - **Phase 1 â€” Spec Analyzer**: Parse spec file â†’ extract screens[], states, component_map â†’ self-verify â†’ auto-proceed
  - **Phase 2 â€” Wireframe Blueprint**: Load template + layout-rules â†’ generate DOM Tree per screen â†’ save â†’ self-verify â†’ auto-proceed
  - **Phase 3 â€” Pencil Drawer**: `batch_get` â†’ `find_empty_space_on_canvas` â†’ `batch_design` (1 screen/call) â†’ `get_screenshot` â†’ self-verify checklist â†’ next screen / fix (max 2 retry) / escalate
  - **5 Guardrails**: G-Lib-Strict, G-Spec-Strict, G-Canvas-Space, G-One-Screen-Per-Call, G-Fail-Fast
  - **Trigger flags**: `--use-lib`, `--wireframe`, `--strict-layout`, `--component-mode`, `--creative`
  - **Escalation rules** (chá»‰ 2 cases): pen file khÃ´ng tÃ¬m tháº¥y; component missing khÃ´ng cÃ³ fallback
  [Tá»ª DESIGN Â§2.2, Â§2.3, Â§6, Â§7]

---

### Phase 2: Knowledge Zone

- [x] **Task 2.1** â€” Táº¡o `knowledge/pencil-tools-ref.md` â€” Transform 100% tá»« `resources/pencil-mcp-agent-rules.md`:
  - **Section I â€” Tool API Reference**: `get_editor_state`, `batch_get` (patterns, readDepth, resolveInstances), `batch_design` (I/C/U/R/D/G syntax vá»›i examples), `find_empty_space_on_canvas`, `get_screenshot`, `snapshot_layout`
  - **Section II â€” Layout Rules**: Flexbox tuyá»‡t Ä‘á»‘i (vertical/horizontal, fill_container, fit_content, anti-patterns), TextGrowth (fixed-width rule), Variables/Design Tokens ($--primary notation)
  - **Section III â€” Script Patterns**: Binding & Reference pattern, Copy "C" trap + descendants solution, Placeholder `placeholder: true` pattern
  - **Section IV â€” Bounded Creativity**: Strict Zones (Forms, Tables, Nav, Data Cards â€” 100% Lib-Component) vs Fluid Zones (Hero, Empty States â€” creative vá»›i G())
  - **Section V â€” Self-Critique**: Screenshot check points (Typography, White Space, rÃ¡c elements)
  - **Section VI â€” Trigger Flags**: Báº£ng `--use-lib`, `--wireframe`, `--strict-layout`, `--component-mode`, `--creative`
  [Tá»ª DESIGN Â§3]

- [x] **Task 2.2** â€” Táº¡o `knowledge/wireframe-format.md` â€” Transform 100% tá»« `resources/wireframe-format-draft.md`:
  - DOM Tree hierarchy chuáº©n (Level 0â€“2)
  - Component mapping syntax Ä‘áº§y Ä‘á»§
  - Text override notation
  - Source citation format báº¯t buá»™c
  - VÃ­ dá»¥ minh há»a: 1 mÃ n hÃ¬nh máº«u hoÃ n chá»‰nh Ä‘Ãºng format
  [Tá»ª DESIGN Â§3]

- [x] **Task 2.3** â€” Táº¡o `knowledge/project-context.md` â€” HÆ°á»›ng dáº«n AI self-orient:
  - Thá»© tá»± Ä‘á»c project docs: `CLAUDE.md` â†’ `check.list.md` â†’ `Docs/life-2/ui/specs/` index
  - Module scope: M1=Auth/Profile, M2=Content, M3=Feed, M4=Engagement, M5=Bookmarking, M6=Notifications â€” file spec tÆ°Æ¡ng á»©ng
  - Design aesthetic: Neobrutalism + Pink primary, bold black borders (`border-2 border-black`), offset box shadows (`shadow-[4px_4px_0px_black]`), high contrast
  - Frame naming convention: `{module-code}/{screen-name}` (vd: `m1/login`, `m2/create-post`)
  - CÃ¡ch tÃ¬m Lib-Component: `batch_get` vá»›i `{patterns: [{name: "Lib-Component"}]}`
  [Tá»ª DESIGN Â§3]

---

### Phase 3: Scripts Zone

- [x] **Task 3.1** â€” Táº¡o `scripts/scan_lib_components.py` â€” Reference/companion script (khÃ´ng gá»i MCP trá»±c tiáº¿p):
  - Header docstring giáº£i thÃ­ch: "Script nÃ y KHÃ”NG tá»± cháº¡y. AI thá»±c hiá»‡n logic nÃ y qua batch_get trong Phase 0."
  - Document logic conceptual dáº¡ng pseudocode + Python: (1) Input: lib_frame_id; (2) Gá»i batch_get readDepth=3; (3) Parse reusable nodes; (4) Output JSON map `{componentName: nodeId}`
  - Pháº§n 2: Post-processing helper â€” parse output batch_get thÃ nh component_map dict
  - Comment rÃµ: dÃ¹ng káº¿t quáº£ Ä‘á»ƒ populate `project_context.component_map`
  [Tá»ª DESIGN Â§3, Â§9 â€” Open Question #4 âœ… Resolved]

---

### Phase 4: Templates Zone

- [x] **Task 4.1** â€” Táº¡o `templates/wireframe.md.template` â€” Template markdown cho 1 mÃ n hÃ¬nh:
  ```markdown
  # Screen: {SCREEN_NAME}
  > Module: {MODULE_CODE} | Spec: {SPEC_FILE} Â§{SECTION}
  > Layout: vertical | Width: {375|768|1440}px | State: default

  ## Section: {SECTION_NAME}
  > layout: horizontal | gap: 24 | padding: 16

  - comp: {COMPONENT_NAME}
    ref: {NODE_ID_FROM_LIB}
    overrides:
      {FIELD_ID}: {VALUE}
    text@{LABEL_FIELD_ID}: "{DISPLAY_TEXT}"
    spec-cite: [spec Â§{N}.{M}]
    zone: strict | fluid

  ## States
  - default: [mÃ´ táº£]
  - loading?: [mÃ´ táº£ náº¿u cÃ³ trong spec]
  - error?: [mÃ´ táº£ náº¿u cÃ³ trong spec]
  - empty?: [mÃ´ táº£ náº¿u cÃ³ trong spec]

  ## Notes
  - [Ghi chÃº gap, open items]
  ```
  [Tá»ª DESIGN Â§3]

---

### Phase 5: Data Zone

- [x] **Task 5.1** â€” Táº¡o `data/layout-rules.yaml`:
  ```yaml
  # Layout Rules â€” ui-pencil-drawer
  # Source: pencil-mcp-agent-rules.md Â§III + design.md Â§3

  layout:
    gap_default: 24
    gap_tight: 8
    gap_loose: 40
    padding_sm: 16
    padding_md: 24
    padding_lg: 32

  screens:
    mobile: 375
    tablet: 768
    desktop: 1440

  naming:
    frame_pattern: "{module}/{screen-name}"
    lib_frame_name: "Lib-Component"
    placeholder_suffix: "-placeholder"

  limits:
    batch_ops_max: 25
    retry_max: 2
    fail_consecutive_before_escalate: 2

  default_state_only: true  # Váº½ default state, váº½ thÃªm náº¿u spec Ä‘á» cáº­p
  ```
  [Tá»ª DESIGN Â§3]

---

### Phase 6: Loop Zone

- [x] **Task 6.1** â€” Táº¡o `loop/checklist.md` â€” Autonomous self-verify checklist vá»›i pass/fail threshold:

  **Phase 0 Checklist** (before proceeding to P1):
  - [ ] `get_editor_state()` tráº£ vá» STi.pen Ä‘ang má»Ÿ?
  - [ ] CLAUDE.md + check.list.md Ä‘Ã£ Ä‘á»c â†’ module scope xÃ¡c Ä‘á»‹nh?
  - [ ] `batch_get` Lib-Component tráº£ vá» â‰¥1 reusable component?
  - [ ] `project_context.component_map` Ä‘Ã£ build?
  - Threshold: ALL pass â†’ proceed. ANY fail â†’ escalate vá»›i message cá»¥ thá»ƒ.

  **Phase 1 Checklist** (after spec parse):
  - [ ] `screens[]` khÃ´ng rá»—ng?
  - [ ] Má»—i screen cÃ³ Ã­t nháº¥t 1 component mapping?
  - [ ] KhÃ´ng cÃ³ field nÃ o bá»‹a (má»i entry trace vá» spec section)?
  - [ ] Spec file tá»“n táº¡i vÃ  readable?
  - Threshold: ALL pass â†’ auto-proceed. Fail â†’ self-fix hoáº·c escalate náº¿u spec missing.

  **Phase 2 Checklist** (after blueprint generated):
  - [ ] Má»—i screen trong `screens[]` Ä‘á»u cÃ³ blueprint entry?
  - [ ] Má»—i component slot cÃ³ `spec-cite`?
  - [ ] KhÃ´ng cÃ³ component nÃ o cÃ³ `ref: undefined` hoáº·c `ref: "unknown"`?
  - [ ] Layout direction Ä‘Ã£ chá»‰ Ä‘á»‹nh (vertical/horizontal)?
  - Threshold: ALL pass â†’ save + auto-proceed. Fail fixable â†’ self-correct. Fail blocked â†’ escalate.

  **Phase 3 Per-Screen Checklist** (after each `batch_design` + screenshot):
  - [ ] Screenshot hiá»ƒn thá»‹ Ä‘Æ°á»£c (khÃ´ng tráº¯ng xÃ³a)?
  - [ ] KhÃ´ng cÃ³ overlap vá»›i Lib-Component frame (`snapshot_layout` verify)?
  - [ ] Táº¥t cáº£ component IDs khá»›p vá»›i `component_map` (khÃ´ng pháº£i hardcoded)?
  - [ ] Typography rÃµ rÃ ng (Visual Hierarchy)?
  - [ ] White space Ä‘á»§ thoÃ¡ng?
  - [ ] KhÃ´ng cÃ³ orphan element (element rÃ¡c khÃ´ng thuá»™c screen)?
  - [ ] Sá»‘ components váº½ = sá»‘ component slots trong blueprint?
  - Threshold: â‰¥6/7 pass â†’ proceed to next screen. Fail fixable â†’ retry (max 2). Fail 2 consecutive â†’ escalate vá»›i screenshot + error description.

  [Tá»ª DESIGN Â§3, Â§8]

---

### Phase 7: Quality Gate

- [x] **Task 7.1** â€” Verify Zone Contract: Äá»‘i chiáº¿u `design.md Â§3 Files cáº§n táº¡o` vá»›i thá»±c táº¿ â€” táº¥t cáº£ 8 files pháº£i tá»“n táº¡i:
  ```
  âœ“ SKILL.md
  âœ“ knowledge/pencil-tools-ref.md
  âœ“ knowledge/wireframe-format.md
  âœ“ knowledge/project-context.md
  âœ“ scripts/scan_lib_components.py
  âœ“ templates/wireframe.md.template
  âœ“ data/layout-rules.yaml
  âœ“ loop/checklist.md
  ```
  [Tá»ª DESIGN Â§3]

- [x] **Task 7.2** â€” Cáº­p nháº­t `build-log.md`: Ghi Resource Usage Matrix â€” má»—i file output â†’ trace vá» source resource. [Gá»¢I Ã Bá»” SUNG]

---

## 3. Knowledge & Resources Needed

| # | TÃ i liá»‡u / Tool | Tier | Má»¥c Ä‘Ã­ch | Tráº¡ng thÃ¡i |
|---|----------------|------|---------|-----------|
| 1 | `resources/pencil-mcp-agent-rules.md` (sau khi copy) | Domain | Primary source cho knowledge/pencil-tools-ref.md, layout-rules.yaml, loop/checklist.md | âœ… 9.9K â€” done |
| 2 | `resources/wireframe-format-draft.md` | Domain | Source cho knowledge/wireframe-format.md, templates/wireframe.md.template | âœ… 8.5K â€” done |
| 3 | `design.md` | Domain | Blueprint cho SKILL.md phases, guardrails, escalation rules | âœ… |
| 4 | `CLAUDE.md` (project root) | Domain | Content cho knowledge/project-context.md â€” module scope, design rules | âœ… |
| 5 | `architect.md` (knowledge zone) | Technical | SKILL.md writing patterns (imperative, phase-based, verified steps) | âœ… |
| 6 | Pencil MCP tool documentation | Technical | Syntax examples cho knowledge/pencil-tools-ref.md â€” Ä‘Ã£ cover bá»Ÿi pencil-mcp-agent-rules.md | âœ… |

---

## 4. Definition of Done

- [ ] Phase 0: `resources/` cÃ³ Ä‘á»§ 2 files (`pencil-mcp-agent-rules.md` + `wireframe-format-draft.md`)
- [ ] `SKILL.md` tá»“n táº¡i, cÃ³ Ä‘á»§ Persona + 4 Phases + 5 Guardrails + Boot Sequence + Trigger Flags
- [ ] `knowledge/pencil-tools-ref.md` transform 100% tá»« `pencil-mcp-agent-rules.md` (6 sections)
- [ ] `knowledge/wireframe-format.md` transform 100% tá»« `wireframe-format-draft.md` + cÃ³ vÃ­ dá»¥ minh há»a
- [ ] `knowledge/project-context.md` hÆ°á»›ng dáº«n Ä‘á»c project docs theo thá»© tá»± + naming conventions
- [ ] `scripts/scan_lib_components.py` cÃ³ docstring giáº£i thÃ­ch rÃµ "khÃ´ng gá»i MCP" + pseudocode logic
- [ ] `templates/wireframe.md.template` cÃ³ Ä‘á»§ 5 sections (header, section, comp, states, notes)
- [ ] `data/layout-rules.yaml` cÃ³ Ä‘á»§ 5 groups (layout, screens, naming, limits, default_state_only)
- [ ] `loop/checklist.md` cÃ³ checklist cho 4 phases vá»›i pass/fail threshold rÃµ rÃ ng
- [ ] Zone Contract: Táº¥t cáº£ 8 files trong `design.md Â§3` Ä‘á»u tá»“n táº¡i (Task 7.1 pass)
- [ ] `build-log.md` cÃ³ Resource Usage Matrix

---

## 5. Notes

### Quyáº¿t Ä‘á»‹nh ká»¹ thuáº­t quan trá»ng

- **`scan_lib_components.py` khÃ´ng gá»i MCP trá»±c tiáº¿p** â€” Script lÃ  companion doc. AI thá»±c hiá»‡n `batch_get` trong Phase 0. Script chá»©a pseudocode + output format Ä‘á»ƒ Builder hiá»ƒu data structure cáº§n dÃ¹ng. [Tá»ª DESIGN Â§9 Q4 âœ… Resolved]

- **Wireframe format chÆ°a Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c** â€” ÄÃ¢y lÃ  Gap duy nháº¥t cÃ²n láº¡i. Task 0.2 pháº£i hoÃ n thÃ nh trÆ°á»›c Phase 2. Builder cáº§n soáº¡n tháº£o draft theo schema Ä‘á» xuáº¥t trong task, khÃ´ng tá»± sÃ¡ng tÃ¡c. [Tá»ª AUDIT TÃ€I NGUYÃŠN]

- **`pencil-mcp-agent-rules.md` lÃ  tÃ i nguyÃªn RICH** â€” Document nÃ y má»™t mÃ¬nh cover Ä‘Æ°á»£c ná»™i dung cho 3 files output: `pencil-tools-ref.md`, `layout-rules.yaml`, vÃ  pháº§n lá»›n `loop/checklist.md`. Builder khÃ´ng cáº§n tÃ¬m thÃªm nguá»“n ngoÃ i.

### Cáº£nh bÃ¡o tá»« Â§8 Risks

- **Risk P0 #1 (AI bá»‹a component IDs)**: Builder PHáº¢I Ä‘áº£m báº£o `loop/checklist.md` Phase 3 cÃ³ check "component IDs khá»›p vá»›i component_map" â€” khÃ´ng Ä‘Æ°á»£c bá» qua.
- **Risk P0 #2 (váº½ Ä‘Ã¨ canvas)**: Builder PHáº¢I Ä‘Æ°a `find_empty_space_on_canvas` vÃ o SKILL.md Phase 3 nhÆ° mandatory step, khÃ´ng optional.
- **Risk P1 #5 (Fail-Fast)**: `loop/checklist.md` PHáº¢I cÃ³ rule "fail 2 consecutive â†’ escalate" â€” Ä‘Ã¢y lÃ  G-Fail-Fast guardrail cá»‘t lÃµi.

### Tráº¡ng thÃ¡i Káº¿ hoáº¡ch

> ğŸŸ¡ **Báº¯t Ä‘áº§u tá»« Phase 0** â€” cáº§n chuáº©n bá»‹ tÃ i nguyÃªn trÆ°á»›c.
> Sau Phase 0 â†’ Builder tá»± tiáº¿n Phase 1â€“7 theo Autonomous Model.
> Káº¿ hoáº¡ch sáº½ update lÃªn ğŸŸ¢ khi Task 0.1 vÃ  0.2 hoÃ n thÃ nh.
