# ⚠️ LOCKED CONTRACT — DO NOT EDIT MANUALLY.
# Generated by Skill 2.5 (class-diagram-analyst). Last updated: 2026-02-20
# To update: re-run generate_yaml.py after editing class-m5-bookmarking.md and re-approval at IP2.

meta:
  module: "M5"
  module_name: "Bookmarking"
  skill_version: "2.5"
  generated_at: "2026-02-20"
  sources_consumed:
    - "Docs/life-2/diagrams/er-diagram.md"
    - "Docs/life-2/diagrams/UseCase/use-case-m5-bookmarking.md"
    - "Docs/life-2/diagrams/activity-diagrams/m5-a1-bookmark-persistence.md"
    - "Docs/life-2/diagrams/activity-diagrams/m5-a2-collection-orchestrator.md"

entities:
  - slug: "bookmarkCollections"
    display_name: "BookmarkCollection"
    payload_collection: "bookmark-collections"
    aggregate_root: true
    fields:
      - name: "ownerId"
        type: "relationship"
        relationTo: "users"
        required: true
        indexed: true
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.owner_id"

      - name: "name"
        type: "text"
        required: true
        indexed: true
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.name"

      - name: "isDefault"
        type: "boolean"
        required: true
        defaultValue: false
        note: "true = 'Tất cả' collection — tạo tự động khi user đăng ký"
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.is_default"

      - name: "createdAt"
        type: "date"
        required: true
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.created_at"

      - name: "updatedAt"
        type: "date"
        required: true
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.updated_at"

    behaviors:
      - lifecycle: "beforeChange"
        trigger: "validateDefaultLimit"
        description: "Đảm bảo mỗi user chỉ có 1 collection với isDefault=true"
        source: "er-diagram.md#BOOKMARK_COLLECTIONS.is_default + activity-diagrams/m5-a2-collection-orchestrator.md"

    access_control:
      create: ["member"]
      read: ["owner"]
      update: ["owner"]
      delete: ["owner"]
      note: "Cannot delete isDefault=true collection"
      source: "UseCase/use-case-m5-bookmarking.md#UC20"

    assumptions: []

  - slug: "bookmarks"
    display_name: "Bookmark"
    payload_collection: "bookmarks"
    aggregate_root: true
    fields:
      - name: "userId"
        type: "relationship"
        relationTo: "users"
        required: true
        indexed: true
        source: "er-diagram.md#BOOKMARKS.user_id"

      - name: "postId"
        type: "relationship"
        relationTo: "posts"
        required: true
        indexed: true
        source: "er-diagram.md#BOOKMARKS.post_id"

      - name: "collectionId"
        type: "relationship"
        relationTo: "bookmark-collections"
        required: true
        indexed: true
        source: "er-diagram.md#BOOKMARKS.collection_id"

      - name: "savedAt"
        type: "date"
        required: true
        indexed: true
        note: "Sort field for bookmark list (newest first)"
        source: "er-diagram.md#BOOKMARKS.saved_at"

    behaviors:
      - lifecycle: "beforeChange"
        trigger: "checkUniqueBookmark"
        description: "Kiểm tra (userId, postId) chưa tồn tại trước khi tạo — enforce unique constraint"
        source: "er-diagram.md (Unique key: user_id, post_id) + activity-diagrams/m5-a1-bookmark-persistence.md"

    access_control:
      create: ["member"]
      read: ["owner"]
      update: []
      delete: ["owner"]
      source: "UseCase/use-case-m5-bookmarking.md#UC19"

    compound_indexes:
      - fields: ["userId", "postId"]
        unique: true
        note: "Unique constraint — không bookmark cùng bài 2 lần"

    assumptions: []

validation_report:
  total_fields: 9
  fields_with_source: 9
  fields_as_assumption: 0
  unresolved: []
