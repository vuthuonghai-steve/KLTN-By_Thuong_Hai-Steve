# ⚠️ LOCKED CONTRACT — DO NOT EDIT MANUALLY.
# Generated by Skill 2.5 (class-diagram-analyst). Last updated: 2026-02-20
# To update: re-run generate_yaml.py after editing class-m3-discovery-feed.md and re-approval at IP2.
# NOTE: M3 has NO MongoDB collection. FeedQuery is a ValueObject (cross-module query strategy).

meta:
  module: "M3"
  module_name: "Discovery Feed"
  skill_version: "2.5"
  generated_at: "2026-02-20"
  module_note: "No MongoDB collection for M3. Cross-module query strategy only."
  sources_consumed:
    - "Docs/life-2/diagrams/er-diagram.md"
    - "Docs/life-2/diagrams/UseCase/use-case-m3-discovery-feed.md"
    - "Docs/life-2/diagrams/activity-diagrams/m3-a1-feed-assembler.md"
    - "Docs/life-2/diagrams/activity-diagrams/m3-a2-search-engine.md"
    - "Docs/life-2/diagrams/activity-diagrams/m3-a3-discovery-recommendation.md"

entities:
  - slug: "feedQuery"
    display_name: "FeedQuery"
    payload_collection: null
    aggregate_root: false
    stereotype: "ValueObject"
    note: "NOT a MongoDB collection. Represents query parameters and feed assembly logic only."
    fields:
      - name: "userId"
        type: "text"
        required: true
        note: "ObjectId of the requesting user"
        source: "activity-diagrams/m3-a1-feed-assembler.md"

      - name: "followingIds"
        type: "array"
        required: false
        note: "List of ObjectIds the user follows — loaded from CONNECTIONS collection"
        source: "er-diagram.md (CONNECTIONS.following_id FK) + activity-diagrams/m3-a1-feed-assembler.md"

      - name: "feedType"
        type: "select"
        required: true
        options: ["chronological", "ranked", "discover"]
        defaultValue: "chronological"
        source: "activity-diagrams/m3-a1-feed-assembler.md"

      - name: "sortStrategy"
        type: "select"
        required: true
        options: ["createdAt_desc", "rankingScore_desc", "mixed"]
        defaultValue: "createdAt_desc"
        source: "er-diagram.md#POSTS.ranking_score + activity-diagrams/m3-a1-feed-assembler.md"

      - name: "page"
        type: "number"
        required: false
        defaultValue: 1
        source: "activity-diagrams/m3-a1-feed-assembler.md (pagination)"

      - name: "limit"
        type: "number"
        required: false
        defaultValue: 20
        source: "activity-diagrams/m3-a1-feed-assembler.md (pagination)"

      - name: "statusFilter"
        type: "array"
        required: false
        note: "Default: ['published'] — filter posts by status"
        source: "er-diagram.md#POSTS.status + activity-diagrams/m3-a1-feed-assembler.md"

      - name: "visibilityFilter"
        type: "array"
        required: false
        note: "Derived from user's connections — ['public', 'friends'] or ['public']"
        source: "er-diagram.md#POSTS.visibility + activity-diagrams/m3-a1-feed-assembler.md"

      - name: "cursorTimestamp"
        type: "date"
        required: false
        note: "Cursor for cursor-based pagination — last seen post createdAt"
        source: "er-diagram.md#POSTS.created_at (index, feed sort)"

    behaviors:
      - name: "assemble"
        description: "Tổng hợp posts từ followingIds, áp dụng filter và sort"
        source: "activity-diagrams/m3-a1-feed-assembler.md"

      - name: "applyVisibilityFilter"
        description: "Lọc posts theo visibility (public/friends/private) dựa trên connections của user"
        source: "activity-diagrams/m3-a1-feed-assembler.md + er-diagram.md#POSTS.visibility"

      - name: "rankByScore"
        description: "Sort posts theo rankingScore DESC cho ranked feed"
        source: "er-diagram.md#POSTS.ranking_score"

    access_control:
      read: ["member"]
      note: "Feed assembly chỉ cho authenticated members"
      source: "UseCase/use-case-m3-discovery-feed.md"

    assumptions: []

validation_report:
  total_fields: 9
  fields_with_source: 9
  fields_as_assumption: 0
  unresolved: []
  special_note: "FeedQuery is a ValueObject — no payload_collection. Fields represent query params, not DB columns."
