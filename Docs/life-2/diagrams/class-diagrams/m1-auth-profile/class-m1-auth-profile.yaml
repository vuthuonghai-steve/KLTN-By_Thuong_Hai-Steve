# ⚠️ LOCKED CONTRACT — DO NOT EDIT MANUALLY.
# Generated by Skill 2.5 (class-diagram-analyst). Last updated: 2026-02-20
# To update: re-run generate_yaml.py after editing class-m1-auth-profile.md and re-approval at IP2.

meta:
  module: "M1"
  module_name: "Auth & Profile"
  skill_version: "2.5"
  generated_at: "2026-02-20"
  sources_consumed:
    - "Docs/life-2/diagrams/er-diagram.md"
    - "Docs/life-2/diagrams/UseCase/use-case-m1-auth-profile.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a1-registration.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a2-login.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a3-verification.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a4-recovery.md"
    - "Docs/life-2/diagrams/activity-diagrams/m1-a5-onboarding.md"

entities:
  - slug: "users"
    display_name: "User"
    payload_collection: "users"
    aggregate_root: true
    fields:
      - name: "email"
        type: "email"
        required: true
        unique: true
        indexed: truetạo shared-types.jsontạo shared-types.json
        source: "er-diagram.md#USERS.email"

      - name: "username"
        type: "text"
        required: true
        unique: true
        indexed: true
        constraints:
          minLength: 3
          maxLength: 50
        source: "er-diagram.md#USERS.username"

      - name: "passwordHash"
        type: "text"
        required: true
        unique: false
        indexed: false
        admin:
          readOnly: false
        note: "bcrypt hash — visibility: private, never expose via API"
        source: "er-diagram.md#USERS.password_hash"

      - name: "verified"
        type: "boolean"
        required: true
        defaultValue: false
        source: "er-diagram.md#USERS.verified"
        note: "false khi đăng ký (UC01), chuyển true sau xác thực email (M1-A3)"

      - name: "role"
        type: "select"
        required: true
        options: ["member", "admin"]
        defaultValue: "member"
        source: "er-diagram.md#USERS.role"

      - name: "status"
        type: "select"
        required: true
        options: ["active", "inactive", "banned"]
        defaultValue: "active"
        source: "er-diagram.md#USERS.status"

      - name: "profileVisibility"
        type: "select"
        required: true
        options: ["public", "followers", "private"]
        defaultValue: "public"
        source: "er-diagram.md#USERS.profile_visibility"

      - name: "followerCount"
        type: "number"
        required: true
        defaultValue: 0
        admin:
          readOnly: true
        pattern: "Computed Pattern — updated by Connections afterChange hook"
        source: "er-diagram.md#USERS.follower_count"

      - name: "followingCount"
        type: "number"
        required: true
        defaultValue: 0
        admin:
          readOnly: true
        pattern: "Computed Pattern — updated by Connections afterChange hook"
        source: "er-diagram.md#USERS.following_count"

      - name: "createdAt"
        type: "date"
        required: true
        indexed: true
        source: "er-diagram.md#USERS.created_at"

      - name: "updatedAt"
        type: "date"
        required: true
        source: "er-diagram.md#USERS.updated_at"

    behaviors:
      - lifecycle: "beforeChange"
        trigger: "sanitizeInput"
        description: "Sanitize email, username input trước khi lưu"
        source: "activity-diagrams/m1-a1-registration.md (C2: Sanitize Input)"

      - lifecycle: "afterChange"
        trigger: "sendVerificationEmail"
        description: "Gửi email xác nhận sau khi tạo tài khoản mới (operation=create)"
        source: "activity-diagrams/m1-a1-registration.md (C5: Tạo Activation Token)"

    access_control:
      create: ["guest", "anyone"]
      read: ["owner", "member", "admin"]
      update: ["owner", "admin"]
      delete: ["admin"]
      source: "UseCase/use-case-m1-auth-profile.md#UC01,UC06,UC07"

    assumptions: []

validation_report:
  total_fields: 11
  fields_with_source: 11
  fields_as_assumption: 0
  unresolved: []
