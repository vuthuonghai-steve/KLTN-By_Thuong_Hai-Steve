# Content Engine - Schema Design

> Data Architect Schema cho PayloadCMS/MongoDB từ Contract `Docs/life-2/diagrams/class-diagrams/m2-content-engine/class-m2-content-engine.yaml`.

## 1. Module Overview
- **Mã hệ thống**: `M2`
- **Mô tả ngắn**: Quản lý Content, Upload Media và Tags của tin bài.

## 2. Database Design (Collections)

### 2.1 Collection: `posts`
- **Type**: `Aggregate Root (Reference)`
- **Reason**: Aggregate độc lập với lượng tăng trưởng dữ liệu không giới hạn nên cần tách biệt, các relations dạng N:N như Tags và Media được tối ưu dạng mảng IDs (`hasMany: true`) để tiết kiệm không gian Join-table ẩn. Computed pattern dùng cho các biến Count.
- **Fields List**:
| Field Name | Payload Type | Mongo Entity | Index? | Mô tả / Range | Note |
|------------|--------------|--------------|--------|---------------|------|
| `authorId` | `relationship` | `ObjectId` | `true` | Tham chiếu tới users | |
| `title` | `text` | `String` | `true` | Tiêu đề | Tùy chọn, indexed |
| `content` | `richText` | `Object` | `true` | Lexical JSON content | |
| `status` | `select` | `String` | `true` | draft, published, banned, archived | |
| `visibility` | `select` | `String` | `true` | public, friends, private | |
| `rankingScore` | `number` | `Number` | `true` | Điểm xếp hạng feed | Async updated |
| `likesCount` | `number` | `Number` | `false` | Số like | Computed Pattern |
| `commentsCount` | `number` | `Number` | `false` | Số bình luận | Computed Pattern |
| `sharesCount` | `number` | `Number` | `false` | Số chia sẻ | Computed Pattern |
| `publishedAt` | `date` | `ISODate` | `true` | Ngày publish | |
| `createdAt` | `date` | `ISODate` | `true` | Ngày tạo | |
| `updatedAt` | `date` | `ISODate` | `false` | Lần cuối cập nhật | |
| `tags` | `relationship` | `ObjectId[]` | `false` | Danh sách tag | hasMany: true |
| `mediaItems`| `relationship` | `ObjectId[]` | `false` | Danh sách media files| hasMany: true |

### 2.2 Collection: `media`
- **Type**: `Aggregate Root (Reference)`
- **Reason**: File hệ thống (Upload collection) theo chuẩn PayloadCMS nên bắt buộc cấu hình ở root level để endpoint `/media` có thể trả về public asset url độc lập.
- **Fields List**:
| Field Name | Payload Type | Mongo Entity | Index? | Mô tả / Range | Note |
|------------|--------------|--------------|--------|---------------|------|
| `filename` | `text` | `String` | `false` | Tên tệp | |
| `mimeType` | `text` | `String` | `false` | Định dạng | |
| `filesize` | `number` | `Number` | `false` | Kích thước byte | |
| `url` | `text` | `String` | `false` | Đường dẫn trả về | |
| `createdAt` | `date` | `ISODate` | `false` | Ngày tạo | |
| `updatedAt` | `date` | `ISODate` | `false` | Lần cuối cập nhật | |

### 2.3 Collection: `tags`
- **Type**: `Aggregate Root (Reference)`
- **Reason**: Taxonomy dùng lại chia sẻ giữa hàng ngàn bài viết thay vì lặp lại text trong từng doc. Thiết kế N:N reference tới Posts.
- **Fields List**:
| Field Name | Payload Type | Mongo Entity | Index? | Mô tả / Range | Note |
|------------|--------------|--------------|--------|---------------|------|
| `name` | `text` | `String` | `true` | Tên hashtag | Unique |
| `slug` | `text` | `String` | `true` | Normalized ID | Unique |
| `createdAt` | `date` | `ISODate` | `false` | Ngày tạo | |

---
*Generated by schema-design-analyst AI Agent.*
