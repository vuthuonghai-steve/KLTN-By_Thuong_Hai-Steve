# Auth & Profile - Schema Design

> Data Architect Schema cho PayloadCMS/MongoDB từ Contract `Docs/life-2/diagrams/class-diagrams/m1-auth-profile/class-m1-auth-profile.yaml`.

## 1. Module Overview
- **Mã hệ thống**: `M1`
- **Mô tả ngắn**: Quản lý Xác thực và Hồ sơ Người dùng (Auth & Profile), tập trung vào định nghĩa Entity Users, access control và computed hook.

## 2. Database Design (Collections)

### 2.1 Collection: `users`
- **Type**: `Aggregate Root (Reference)`
- **Reason**: Bảng người dùng cốt lõi cần truy cập độc lập từ mọi module khác trong hệ thống. Dữ liệu có thể tiếp tục tăng và số lượng sẽ vô hạn theo thời gian. Các trường dễ phát sinh Array limit (như Follower List) được thiết kế theo `Computed Pattern` (với 2 biến count) nhằm 100% đảm bảo giới hạn 16MB document của MongoDB.
- **Fields List**:
| Field Name | Payload Type | Mongo Entity | Index? | Mô tả / Range | Note |
|------------|--------------|--------------|--------|---------------|------|
| `email` | `email` | `String` | `true` | User's email | Unique, Validated by Payload |
| `username` | `text` | `String` | `true` | Unique username | minLength: 3, maxLength: 50 |
| `passwordHash` | `text` | `String` | `false` | bcrypt hash | readOnly: false, visibility: private |
| `verified` | `checkbox` | `Boolean` | `false` | Trạng thái xác minh | default: false |
| `role` | `select` | `String` | `false` | Role authorization | member, admin (default: member) |
| `status` | `select` | `String` | `false` | Account status | active, inactive, banned (default: active)|
| `profileVisibility` | `select` | `String` | `false` | Ai xem được profile | public, followers, private |
| `displayName` | `text` | `String` | `false` | Tên hiển thị người dùng | Required |
| `bio` | `text` | `String` | `false` | Tiểu sử ngắn | Optional, Max 160 chars |
| `avatar` | `text` | `String` | `false` | Ảnh đại diện | Optional, URL hoặc Media ID |
| `bookmarkCollections` | `join` | `Array` | `false` | Bộ sưu tập bookmark (M5) | Virtual Join Field |
| `notifications` | `join` | `Array` | `false` | Danh sách thông báo (M6) | Virtual Join Field |
| `unreadNotificationsCount` | `number` | `Number` | `false` | Số thông báo chưa đọc | Computed M6 |
| `followerCount` | `number` | `Number` | `false` | Số người theo dõi | Computed Pattern (readOnly: true) |
| `followingCount` | `number` | `Number` | `false` | Số người đang theo | Computed Pattern (readOnly: true) |
| `createdAt` | `date` | `ISODate` | `true` | Ngày tạo | Tự sinh, indexed |
| `updatedAt` | `date` | `ISODate` | `false` | Lần cuối update | Tự sinh |

---
*Generated by schema-design-analyst AI Agent.*
